class AccessibilityEnhancer{constructor(){this.focusableElements=["a[href]","button:not([disabled])","input:not([disabled])","select:not([disabled])","textarea:not([disabled])",'[tabindex]:not([tabindex="-1"])','[contenteditable="true"]'].join(", "),this.currentFocusIndex=-1,this.focusableElementsList=[],this.announcements=[],this.reducedMotion=window.matchMedia("(prefers-reduced-motion: reduce)").matches,this.highContrast=window.matchMedia("(prefers-contrast: high)").matches,this.init()}init(){console.log("♿ Initializing accessibility enhancements..."),this.initializeKeyboardNavigation(),this.initializeScreenReaderSupport(),this.initializeARIAEnhancements(),this.initializeFocusManagement(),this.initializeColorContrastSupport(),this.initializeCrossBrowserSupport(),console.log("✅ Accessibility enhancements initialized")}initializeKeyboardNavigation(){document.addEventListener("keydown",this.handleKeyboardNavigation.bind(this)),this.initializeSkipLinks(),this.initializeEscapeKeyHandling()}handleKeyboardNavigation(e){const{key:t,ctrlKey:n,altKey:i,shiftKey:a}=e;if(n||i)this.handleGlobalShortcuts(e);else switch(t){case"Tab":this.handleTabNavigation(e);break;case"Enter":case" ":this.handleActivation(e);break;case"Escape":this.handleEscape(e);break;case"ArrowUp":case"ArrowDown":case"ArrowLeft":case"ArrowRight":this.handleArrowNavigation(e)}}handleGlobalShortcuts(e){const{key:t,ctrlKey:n,altKey:i}=e;return(n||i)&&"/"===t?(e.preventDefault(),void this.showKeyboardShortcutsHelp()):n&&"k"===t?(e.preventDefault(),void this.focusSearch()):void 0}handleTabNavigation(e){this.isModalOpen()&&this.trapFocusInModal(e),setTimeout(()=>{this.announceFocusChange()},100)}handleActivation(e){const t=e.target;if(t.hasAttribute("role")){switch(t.getAttribute("role")){case"button":case"tab":case"menuitem":e.preventDefault(),t.click()}}}handleEscape(e){const t=document.querySelector(".modal.visible, .palmon-detail-modal.modal-visible");if(t){const e=t.querySelector(".modal-close-btn, .close-btn");return void(e&&e.click())}const n=document.querySelector(".dropdown.open, .context-menu.visible");n&&n.classList.remove("open","visible")}handleArrowNavigation(e){e.target.closest('[role="grid"], [role="listbox"], [role="menu"]')&&this.handleGridNavigation(e)}handleGridNavigation(e){const t=e.target.closest('[role="grid"]');if(!t)return;const n=Array.from(t.querySelectorAll('[role="gridcell"]')),i=n.indexOf(e.target);if(-1===i)return;const a=this.calculateGridWidth(t);let s;switch(e.key){case"ArrowUp":s=i-a;break;case"ArrowDown":s=i+a;break;case"ArrowLeft":s=i-1;break;case"ArrowRight":s=i+1}s>=0&&s<n.length&&(e.preventDefault(),n[s].focus())}calculateGridWidth(e){const t=e.querySelector('[role="gridcell"]');if(!t)return 1;const n=e.getBoundingClientRect(),i=t.getBoundingClientRect();return Math.floor(n.width/i.width)}initializeSkipLinks(){const e=document.createElement("div");e.className="skip-links",e.innerHTML='\n      <a href="#main-content" class="skip-link">Skip to main content</a>\n      <a href="#navigation" class="skip-link">Skip to navigation</a>\n      <a href="#search" class="skip-link">Skip to search</a>\n    ',document.body.insertBefore(e,document.body.firstChild),this.addSkipLinkStyles()}addSkipLinkStyles(){const e=document.createElement("style");e.textContent="\n      .skip-links {\n        position: absolute;\n        top: -100px;\n        left: 0;\n        z-index: 10000;\n      }\n      \n      .skip-link {\n        position: absolute;\n        top: -100px;\n        left: 0;\n        background: var(--text-accent);\n        color: var(--text-inverse);\n        padding: 8px 16px;\n        text-decoration: none;\n        font-weight: bold;\n        border-radius: 0 0 4px 0;\n        transition: top 0.2s ease;\n      }\n      \n      .skip-link:focus {\n        top: 0;\n      }\n    ",document.head.appendChild(e)}initializeEscapeKeyHandling(){document.addEventListener("keydown",e=>{"Escape"===e.key&&this.handleEscape(e)})}initializeScreenReaderSupport(){this.createLiveRegion(),this.initializeDynamicAnnouncements()}createLiveRegion(){const e=document.createElement("div");e.id="live-region",e.setAttribute("aria-live","polite"),e.setAttribute("aria-atomic","true"),e.className="sr-only",document.body.appendChild(e);const t=document.createElement("div");t.id="assertive-live-region",t.setAttribute("aria-live","assertive"),t.setAttribute("aria-atomic","true"),t.className="sr-only",document.body.appendChild(t)}announce(e,t="polite"){const n="assertive"===t?"assertive-live-region":"live-region",i=document.getElementById(n);i&&(i.textContent="",setTimeout(()=>{i.textContent=e},100),setTimeout(()=>{i.textContent=""},5e3)),console.log(`📢 Screen reader announcement (${t}): ${e}`)}initializeDynamicAnnouncements(){new MutationObserver(e=>{e.forEach(e=>{if("childList"===e.type&&e.addedNodes.length>0){Array.from(e.addedNodes).filter(e=>1===e.nodeType).forEach(e=>{e.classList.contains("palmon-card")?this.announce("New Palmon card loaded"):e.classList.contains("tier-section")&&this.announce("Tier list updated")})}})}).observe(document.body,{childList:!0,subtree:!0})}initializeARIAEnhancements(){this.addMissingARIALabels(),this.initializeLandmarkRoles(),this.initializeFormAccessibility()}addMissingARIALabels(){document.querySelectorAll("button:not([aria-label]):not([aria-labelledby])").forEach(e=>{if(e.querySelector('.icon, [class*="icon"]')&&!e.textContent.trim()){const t=this.inferButtonLabel(e);t&&e.setAttribute("aria-label",t)}});document.querySelectorAll("input:not([aria-label]):not([aria-labelledby])").forEach(e=>{const t=e.getAttribute("placeholder");t&&e.setAttribute("aria-label",t)})}inferButtonLabel(e){const t=Array.from(e.classList);return t.includes("close")||t.includes("close-btn")?"Close":t.includes("menu")||t.includes("menu-toggle")?"Menu":t.includes("search")?"Search":null}initializeLandmarkRoles(){const e=document.querySelector("header, .main-header");e&&!e.hasAttribute("role")&&e.setAttribute("role","banner");const t=document.querySelector("nav, .main-nav");t&&!t.hasAttribute("role")&&(t.setAttribute("role","navigation"),t.hasAttribute("aria-label")||t.setAttribute("aria-label","Main navigation"));const n=document.querySelector("main, .main-content");n&&!n.hasAttribute("role")&&(n.setAttribute("role","main"),n.id="main-content");const i=document.querySelector("footer, .main-footer");i&&!i.hasAttribute("role")&&i.setAttribute("role","contentinfo")}initializeFormAccessibility(){document.querySelectorAll("form").forEach(e=>{e.querySelectorAll("input, select, textarea").forEach(e=>{e.hasAttribute("required")&&e.setAttribute("aria-required","true"),e.addEventListener("invalid",e=>{const t=e.target.validationMessage;this.announce(`Error: ${t}`,"assertive")})})})}initializeFocusManagement(){this.initializeFocusIndicators(),this.initializeFocusTrapping(),this.initializeFocusAnnouncements()}initializeFocusIndicators(){const e=document.createElement("style");e.textContent='\n      /* Enhanced focus indicators */\n      :focus {\n        outline: 3px solid var(--text-accent);\n        outline-offset: 2px;\n      }\n      \n      /* High contrast focus indicators */\n      @media (prefers-contrast: high) {\n        :focus {\n          outline: 3px solid #000000;\n          outline-offset: 2px;\n        }\n      }\n      \n      /* Focus indicators for custom elements */\n      [role="button"]:focus,\n      [role="tab"]:focus,\n      [role="menuitem"]:focus {\n        outline: 3px solid var(--text-accent);\n        outline-offset: 2px;\n      }\n    ',document.head.appendChild(e)}initializeFocusTrapping(){document.addEventListener("keydown",e=>{"Tab"===e.key&&this.isModalOpen()&&this.trapFocusInModal(e)})}trapFocusInModal(e){const t=document.querySelector(".modal.visible, .palmon-detail-modal.modal-visible");if(!t)return;const n=t.querySelectorAll(this.focusableElements),i=n[0],a=n[n.length-1];e.shiftKey?document.activeElement===i&&(e.preventDefault(),a.focus()):document.activeElement===a&&(e.preventDefault(),i.focus())}initializeFocusAnnouncements(){let e=null;document.addEventListener("focusin",t=>{const n=t.target;n!==e&&(setTimeout(()=>{this.announceFocusChange(n)},100),e=n)})}announceFocusChange(e){e||(e=document.activeElement);const t=e.getAttribute("role");let n=e.getAttribute("aria-label")||e.textContent?.trim()||e.getAttribute("placeholder")||e.tagName.toLowerCase();t&&(n+=`, ${t}`),(t||e.hasAttribute("aria-label")||"BUTTON"===e.tagName)&&this.announce(n)}initializeColorContrastSupport(){this.initializeHighContrastMode()}initializeHighContrastMode(){const e=window.matchMedia("(prefers-contrast: high)"),t=e=>{document.documentElement.classList.toggle("high-contrast",e),e&&this.announce("High contrast mode enabled")};t(e.matches),e.addEventListener("change",e=>t(e.matches))}initializeCrossBrowserSupport(){this.initializePolyfills(),this.initializeBrowserFixes(),this.initializeFeatureDetection()}initializePolyfills(){"IntersectionObserver"in window||this.intersectionObserverFallback()}intersectionObserverFallback(){window.IntersectionObserver=class{constructor(e,t={}){this.callback=e,this.options=t,this.elements=new Set}observe(e){this.elements.add(e),this.callback([{target:e,isIntersecting:!0,intersectionRatio:1}])}unobserve(e){this.elements.delete(e)}disconnect(){this.elements.clear()}}}initializeBrowserFixes(){this.isIE()&&this.applyIEFixes(),this.isSafari()&&this.applySafariFixes()}isIE(){return/MSIE|Trident/.test(navigator.userAgent)}isSafari(){return/Safari/.test(navigator.userAgent)&&!/Chrome/.test(navigator.userAgent)}applyIEFixes(){console.log("Applying Internet Explorer fixes"),document.documentElement.classList.add("ie")}applySafariFixes(){console.log("Applying Safari fixes"),document.documentElement.classList.add("safari"),this.fixSafariViewport()}fixSafariViewport(){const e=()=>{const e=.01*window.innerHeight;document.documentElement.style.setProperty("--vh",`${e}px`)};e(),window.addEventListener("resize",e),window.addEventListener("orientationchange",()=>{setTimeout(e,100)})}initializeFeatureDetection(){const e={"css-grid":CSS.supports("display","grid"),"css-flexbox":CSS.supports("display","flex"),"css-custom-properties":CSS.supports("color","var(--test)"),"intersection-observer":"IntersectionObserver"in window,"service-worker":"serviceWorker"in navigator,"local-storage":this.testLocalStorage()};Object.entries(e).forEach(([e,t])=>{const n=t?`supports-${e}`:`no-${e}`;document.documentElement.classList.add(n)}),console.log("Feature detection completed:",e)}testLocalStorage(){try{const e="__test__";return localStorage.setItem(e,e),localStorage.removeItem(e),!0}catch(e){return!1}}isModalOpen(){return null!==document.querySelector(".modal.visible, .palmon-detail-modal.modal-visible")}showKeyboardShortcutsHelp(){const e=document.createElement("div");e.className="keyboard-shortcuts-modal modal",e.innerHTML='\n      <div class="modal-backdrop"></div>\n      <div class="modal-container">\n        <div class="modal-header">\n          <h2>Keyboard Shortcuts</h2>\n          <button class="modal-close-btn" aria-label="Close">×</button>\n        </div>\n        <div class="modal-body">\n          <div class="shortcuts-grid">\n            <div class="shortcut-group">\n              <h3>Navigation</h3>\n              <dl>\n                <dt>Tab</dt><dd>Move to next element</dd>\n                <dt>Shift + Tab</dt><dd>Move to previous element</dd>\n                <dt>Ctrl + K</dt><dd>Focus search</dd>\n              </dl>\n            </div>\n            <div class="shortcut-group">\n              <h3>Actions</h3>\n              <dl>\n                <dt>Enter / Space</dt><dd>Activate element</dd>\n                <dt>Escape</dt><dd>Close modal/dropdown</dd>\n                <dt>Arrow Keys</dt><dd>Navigate within components</dd>\n              </dl>\n            </div>\n          </div>\n        </div>\n      </div>\n    ',document.body.appendChild(e),requestAnimationFrame(()=>{e.classList.add("visible"),e.querySelector(".modal-close-btn").focus()});const t=()=>{e.classList.remove("visible"),setTimeout(()=>e.remove(),300)};e.querySelector(".modal-close-btn").addEventListener("click",t),e.querySelector(".modal-backdrop").addEventListener("click",t),e.addEventListener("keydown",e=>{"Escape"===e.key&&t()})}focusSearch(){const e=document.querySelector('input[type="search"], .search-input');e&&(e.focus(),this.announce("Search focused"))}announceToScreenReader(e,t="polite"){this.announce(e,t)}focusElement(e){const t=document.querySelector(e);return!!t&&(t.focus(),!0)}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.accessibilityEnhancer=new AccessibilityEnhancer}):window.accessibilityEnhancer=new AccessibilityEnhancer,"undefined"!=typeof module&&module.exports&&(module.exports={AccessibilityEnhancer:AccessibilityEnhancer});let appState={initialized:!1,palmonData:null,currentView:"home"};const samplePalmon=[{name:"Barkplug",tier:"S",element:"Electric",role:"Support"},{name:"Statchew",tier:"S",element:"Earth",role:"Tank"},{name:"Snowkami",tier:"A",element:"Water",role:"DPS"},{name:"Wyvierno",tier:"A",element:"Fire",role:"DPS"},{name:"Kilohopp",tier:"B",element:"Electric",role:"Support"},{name:"Graffitty",tier:"Economy",element:"Earth",role:"Support"}];async function initApp(){try{console.log("🚀 Initializing Palmon Masters..."),await new Promise(e=>setTimeout(e,1500));try{const e=await fetch("./palmon.json");e.ok&&(appState.palmonData=await e.json(),console.log("✅ Palmon data loaded:",appState.palmonData.length,"entries"))}catch(e){console.log("ℹ️ Using sample data for demonstration"),appState.palmonData=samplePalmon}document.getElementById("loading-screen").style.display="none",document.getElementById("app").style.display="block",animateStats(),appState.initialized=!0,console.log("✅ App initialized successfully")}catch(e){console.error("❌ App initialization failed:",e),showError("Failed to initialize application. Please refresh the page.")}}function animateStats(){[{id:"total-palmon",target:appState.palmonData?appState.palmonData.length:767},{id:"tier-s-count",target:3},{id:"synergy-combos",target:1150}].forEach(e=>{const t=document.getElementById(e.id);t&&animateCounter(t,e.target)})}function animateCounter(e,t,n=2e3){const i=t/(n/16);let a=0;const s=setInterval(()=>{a+=i,a>=t&&(a=t,clearInterval(s)),e.textContent=Math.floor(a)},16)}function showError(e){document.getElementById("loading-screen").innerHTML=`\n    <div class="card" style="max-width: 500px; text-align: center;">\n      <h2 style="color: var(--tier-s); margin-bottom: var(--spacing-md);">❌ Error</h2>\n      <p style="color: var(--text-secondary); margin-bottom: var(--spacing-lg);">${e}</p>\n      <button class="btn btn-primary" onclick="location.reload()">\n        🔄 Refresh Page\n      </button>\n    </div>\n  `}function showImplementation(){appState.currentView="implementation",document.getElementById("content-area").innerHTML=`\n    <div class="card">\n      <h2 class="card-title">📊 Interactive Tier List Implementation</h2>\n      <p class="card-description">\n        The tier list interface has been fully implemented with modern web technologies and best practices.\n      </p>\n      <h3 style="color: var(--text-accent); margin: var(--spacing-lg) 0 var(--spacing-md) 0;">Technical Architecture</h3>\n      <ul class="feature-list">\n        <li><strong>Modular JavaScript:</strong> Component-based architecture with PalmonCard and TierGridSystem classes</li>\n        <li><strong>CSS Custom Properties:</strong> Consistent theming and responsive design system</li>\n        <li><strong>Drag & Drop API:</strong> Native HTML5 drag-and-drop with visual feedback</li>\n        <li><strong>Local Storage:</strong> Persistent tier configurations and user preferences</li>\n        <li><strong>Performance Optimized:</strong> Efficient rendering and filtering algorithms</li>\n        <li><strong>Accessibility:</strong> Keyboard navigation and screen reader support</li>\n      </ul>\n      <h3 style="color: var(--text-accent); margin: var(--spacing-lg) 0 var(--spacing-md) 0;">Core Features</h3>\n      <ul class="feature-list">\n        <li><strong>Interactive Cards:</strong> Hover effects, tier indicators, element icons, and detailed modals</li>\n        <li><strong>Drag & Drop:</strong> Smooth tier reorganization with visual feedback and animations</li>\n        <li><strong>Advanced Filtering:</strong> Multi-criteria filtering by element, role, tier, and search</li>\n        <li><strong>Real-time Search:</strong> Instant results with highlighting and auto-complete</li>\n        <li><strong>Multiple Sorting:</strong> Sort by name, tier, element, or role with ascending/descending options</li>\n        <li><strong>Responsive Design:</strong> Optimized for desktop, tablet, and mobile devices</li>\n      </ul>\n      <div class="demo-section">\n        <h3 class="demo-title">Data Processing</h3>\n        <p class="demo-description">\n          The system processes ${appState.palmonData?appState.palmonData.length:767} Palmon entries with comprehensive metadata including:\n        </p>\n        <ul class="feature-list" style="text-align: left; max-width: 600px; margin: 0 auto;">\n          <li>Tier classifications (S, A, B, C, Economy)</li>\n          <li>Element types (Fire, Water, Earth, Electric)</li>\n          <li>Role assignments (Tank, DPS, Support, Control)</li>\n          <li>Skill descriptions and passive abilities</li>\n          <li>Evolution paths and synergy data</li>\n        </ul>\n      </div>\n    </div>\n  `}function showFeatures(){appState.currentView="features",document.getElementById("content-area").innerHTML='\n    <div class="card">\n      <h2 class="card-title">⚔️ Feature Showcase</h2>\n      <p class="card-description">\n        Explore the comprehensive feature set of the Palmon Masters tier list interface.\n      </p>\n      <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(300px, 1fr)); gap: var(--spacing-lg); margin: var(--spacing-xl) 0;">\n        <div class="card" style="margin: 0;">\n          <h3 style="color: var(--tier-s); margin-bottom: var(--spacing-md);">🎯 Task 4.1: Palmon Cards</h3>\n          <ul class="feature-list">\n            <li>Compact card components with portraits</li>\n            <li>Tier indicator badges with color coding</li>\n            <li>Element type icons (🔥🌱💧⚡)</li>\n            <li>Hover effects and click interactions</li>\n            <li>Expandable detail modals</li>\n            <li>Role and skill information display</li>\n          </ul>\n        </div>\n        <div class="card" style="margin: 0;">\n          <h3 style="color: var(--tier-a); margin-bottom: var(--spacing-md);">🎯 Task 4.2: Tier Grid</h3>\n          <ul class="feature-list">\n            <li>Responsive tier grid layout</li>\n            <li>Drag-and-drop functionality</li>\n            <li>Visual separators and tier labels</li>\n            <li>Smooth animations and transitions</li>\n            <li>Save/reset tier configurations</li>\n            <li>Mobile-friendly touch support</li>\n          </ul>\n        </div>\n        <div class="card" style="margin: 0;">\n          <h3 style="color: var(--tier-b); margin-bottom: var(--spacing-md);">🎯 Task 4.3: Filtering</h3>\n          <ul class="feature-list">\n            <li>Multi-criteria filter panel</li>\n            <li>Real-time search functionality</li>\n            <li>Element, role, and tier filters</li>\n            <li>Active filter tags with removal</li>\n            <li>Sort by multiple criteria</li>\n            <li>Collapsible filter interface</li>\n          </ul>\n        </div>\n      </div>\n      <div class="demo-section">\n        <h3 class="demo-title">User Experience Highlights</h3>\n        <div style="display: grid; grid-template-columns: repeat(auto-fit, minmax(250px, 1fr)); gap: var(--spacing-md); margin: var(--spacing-lg) 0;">\n          <div style="text-align: center; padding: var(--spacing-md);">\n            <div style="font-size: 3rem; margin-bottom: var(--spacing-sm);">🎨</div>\n            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-xs);">Visual Design</h4>\n            <p style="color: var(--text-secondary); font-size: var(--font-size-sm);">Modern dark theme with accent colors and smooth animations</p>\n          </div>\n          <div style="text-align: center; padding: var(--spacing-md);">\n            <div style="font-size: 3rem; margin-bottom: var(--spacing-sm);">📱</div>\n            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-xs);">Responsive</h4>\n            <p style="color: var(--text-secondary); font-size: var(--font-size-sm);">Optimized for all screen sizes and touch devices</p>\n          </div>\n          <div style="text-align: center; padding: var(--spacing-md);">\n            <div style="font-size: 3rem; margin-bottom: var(--spacing-sm);">⚡</div>\n            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-xs);">Performance</h4>\n            <p style="color: var(--text-secondary); font-size: var(--font-size-sm);">Fast filtering and smooth interactions</p>\n          </div>\n          <div style="text-align: center; padding: var(--spacing-md);">\n            <div style="font-size: 3rem; margin-bottom: var(--spacing-sm);">♿</div>\n            <h4 style="color: var(--text-primary); margin-bottom: var(--spacing-xs);">Accessible</h4>\n            <p style="color: var(--text-secondary); font-size: var(--font-size-sm);">Keyboard navigation and screen reader support</p>\n          </div>\n        </div>\n      </div>\n    </div>\n  '}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",initApp):initApp(),document.addEventListener("click",function(e){e.target.matches(".stat-card")&&(e.target.style.transform="scale(1.05)",setTimeout(()=>{e.target.style.transform=""},200))});import PalmonDataProcessor from"./palmon-data.js";import DataUtils from"../utils/data-utils.js";class DataLoader{constructor(){this.processor=new PalmonDataProcessor,this.dataUtils=null,this.isLoaded=!1,this.loadPromise=null}async loadFromFile(e="/palmon.json"){return this.loadPromise||(this.loadPromise=this._performLoad(e)),this.loadPromise}async loadFromData(e){if(this.isLoaded&&this.dataUtils)return this.dataUtils;try{const t=await this.processor.loadData(e),n=this.processor.getSearchIndex();return this.dataUtils=new DataUtils(t,n),this.isLoaded=!0,this.dataUtils}catch(e){throw console.error("Error loading Palmon data:",e),new Error(`Failed to load Palmon data: ${e.message}`)}}async _performLoad(e){if(this.isLoaded&&this.dataUtils)return this.dataUtils;try{const t=await fetch(e);if(!t.ok)throw new Error(`HTTP error! status: ${t.status}`);const n=await t.json();if(!Array.isArray(n))throw new Error("Invalid JSON format: expected array");return await this.loadFromData(n)}catch(e){console.error("Error loading Palmon data from file:",e);const t=this.loadFromCache();if(t)return console.log("Loaded Palmon data from cache as fallback"),await this.loadFromData(t);throw new Error(`Failed to load Palmon data: ${e.message}`)}}cacheData(e){try{const t={data:e,timestamp:Date.now(),version:"1.0"};localStorage.setItem("palmon_data_cache",JSON.stringify(t)),console.log("Palmon data cached successfully")}catch(e){console.warn("Failed to cache Palmon data:",e)}}loadFromCache(){try{const e=localStorage.getItem("palmon_data_cache");if(!e)return null;const t=JSON.parse(e),n=864e5;return Date.now()-t.timestamp>n?(localStorage.removeItem("palmon_data_cache"),null):t.data.palmon}catch(e){return console.warn("Failed to load cached data:",e),localStorage.removeItem("palmon_data_cache"),null}}getDataUtils(){return this.dataUtils}isDataLoaded(){return this.isLoaded}getLoadingProgress(){return{isLoading:!!this.loadPromise&&!this.isLoaded,isLoaded:this.isLoaded,hasError:!1}}async preloadData(e="/palmon.json"){try{const t=await this.loadFromFile(e),n=this.processor.getData();return this.cacheData(n),console.log("Palmon data preloaded and cached successfully"),t}catch(e){throw console.warn("Failed to preload data:",e),e}}clearCache(){try{localStorage.removeItem("palmon_data_cache"),console.log("Palmon data cache cleared")}catch(e){console.warn("Failed to clear cache:",e)}}getCacheInfo(){try{const e=localStorage.getItem("palmon_data_cache");if(!e)return null;const t=JSON.parse(e);return{timestamp:new Date(t.timestamp),version:t.version,size:e.length,palmonCount:t.data.palmon.length}}catch(e){return null}}}const dataLoader=new DataLoader;export default dataLoader;export{DataLoader};class PalmonDataProcessor{constructor(){this.rawData=null,this.processedData=null,this.searchIndex=null}async loadData(e){return this.rawData=e,this.processedData=this.transformData(e),this.searchIndex=this.buildSearchIndex(this.processedData),this.processedData}transformData(e){const t=new Map,n=new Set,i=new Set;return e.forEach(e=>{const a=e["Hero ID"],s=e["Hero Key"];if(t.has(a))return;const o=this.determineElement(e["Hero Name"],s),r=this.determineTier(e["Hero Name"]),l=this.determineRole(e);n.add(o),i.add(r);const c={id:a,name:e["Hero Name"],heroKey:s,element:o,tier:r,role:l,skills:{skill1:{name:e["Skill 1 Name"],description:e["Skill 1 Description"],type:"Active"},skill2:{name:e["Skill 2 Name"],description:e["Skill 2 Description"],type:"Active"},passive:{name:e["Skill 3 (Passive) Name"],description:e["Skill 3 Description"],type:"Passive"}},...e["Evolve Skill Name"]&&{evolveSkill:{name:e["Evolve Skill Name"],description:e["Evolve Skill Description"],type:"Evolve"}},stats:{utility:this.calculateUtilityScore(e),synergy:this.calculateSynergyScore(e),damage:this.calculateDamageScore(e),durability:this.calculateDurabilityScore(e),economy:this.calculateEconomyScore(e)}};t.set(a,c)}),{palmon:Array.from(t.values()),metadata:{totalCount:t.size,elements:Array.from(n).sort(),tiers:Array.from(i).sort(),lastUpdated:(new Date).toISOString()}}}determineElement(e,t){const n=e.toLowerCase()+" "+t.toLowerCase();if(["fire","flame","burn","blaze","heat","ember","magma","lava","vulcan","inciner"].some(e=>n.includes(e)))return"Fire";if(["water","aqua","ocean","sea","wave","splash","hydro","marine","dolphin","whale"].some(e=>n.includes(e)))return"Water";if(["earth","stone","rock","ground","terra","forest","nature","plant","leaf","tree"].some(e=>n.includes(e)))return"Earth";if(["electric","thunder","lightning","volt","spark","storm","charge","ion"].some(e=>n.includes(e)))return"Electric";const i=parseInt(t.split("_").pop());return i>=3201&&i<=3300?"Earth":i>=4001&&i<=4100?"Fire":i>=5001&&i<=5100?"Water":"Electric"}determineTier(e){if(["Barkplug","Statchew","Escarffier"].includes(e))return"S";if(["Snowkami","Hoofrit","Lucidina","Battereina","Ninjump"].includes(e))return"A";const t=e.match(/\d+/);if(t){const e=parseInt(t[0]);if(e>=5e3)return"A";if(e>=4e3)return"B";if(e>=3e3)return"C"}return"B"}determineRole(e){const t=[e["Skill 1 Description"],e["Skill 2 Description"],e["Skill 3 Description"]].join(" ").toLowerCase();return t.includes("shield")||t.includes("defense")||t.includes("protect")||t.includes("hp")||t.includes("damage reduction")?"Tank":t.includes("heal")||t.includes("buff")||t.includes("ally")||t.includes("blessing")||t.includes("restore")?"Support":t.includes("stun")||t.includes("paralyze")||t.includes("freeze")||t.includes("slow")||t.includes("disable")?"Control":"DPS"}calculateUtilityScore(e){let t=50;const n=[e["Skill 1 Description"],e["Skill 2 Description"],e["Skill 3 Description"]].join(" ").toLowerCase();return n.includes("heal")&&(t+=20),n.includes("shield")&&(t+=15),n.includes("buff")&&(t+=15),n.includes("debuff")&&(t+=10),(n.includes("stun")||n.includes("paralyze"))&&(t+=10),Math.min(100,t)}calculateSynergyScore(e){let t=30;const n=e["Skill 3 Description"]?.toLowerCase()||"";return n.includes("all")&&(n.includes("palmon")||n.includes("allies"))&&(t+=40),n.includes("lineup")&&(t+=30),n.includes("when this palmon is in")&&(t+=25),Math.min(100,t)}calculateDamageScore(e){let t=40;const n=[e["Skill 1 Description"],e["Skill 2 Description"]].join(" ").toLowerCase();return n.includes("damage to all")&&(t+=25),n.includes("multiple times")&&(t+=20),(n.includes("critical")||n.includes("crit"))&&(t+=15),n.includes("attack")&&(t+=10),Math.min(100,t)}calculateDurabilityScore(e){let t=40;const n=[e["Skill 1 Description"],e["Skill 2 Description"],e["Skill 3 Description"]].join(" ").toLowerCase();return n.includes("hp")&&(t+=20),(n.includes("defense")||n.includes("def"))&&(t+=15),n.includes("shield")&&(t+=15),n.includes("resist")&&(t+=10),Math.min(100,t)}calculateEconomyScore(e){let t=20;const n=[e["Skill 1 Description"],e["Skill 2 Description"],e["Skill 3 Description"]].join(" ").toLowerCase();return(n.includes("gold")||n.includes("lumber")||n.includes("steel"))&&(t+=40),n.includes("treasure")&&(t+=30),n.includes("reward")&&(t+=25),(n.includes("quick build")||n.includes("quick train"))&&(t+=20),Math.min(100,t)}buildSearchIndex(e){const t={byName:new Map,byElement:new Map,byTier:new Map,byRole:new Map,bySkill:new Map};return e.palmon.forEach(e=>{const n=e.name.toLowerCase();t.byName.set(n,e),t.byElement.has(e.element)||t.byElement.set(e.element,[]),t.byElement.get(e.element).push(e),t.byTier.has(e.tier)||t.byTier.set(e.tier,[]),t.byTier.get(e.tier).push(e),t.byRole.has(e.role)||t.byRole.set(e.role,[]),t.byRole.get(e.role).push(e);[e.skills.skill1.name,e.skills.skill2.name,e.skills.passive.name,e.skills.skill1.description,e.skills.skill2.description,e.skills.passive.description].join(" ").toLowerCase().split(/\s+/).filter(e=>e.length>2).forEach(n=>{t.bySkill.has(n)||t.bySkill.set(n,new Set),t.bySkill.get(n).add(e)})}),t}getData(){return this.processedData}getSearchIndex(){return this.searchIndex}validatePalmon(e){const t=["id","name","heroKey","element","tier","role","skills"].filter(t=>!e.hasOwnProperty(t));if(t.length>0)throw new Error(`Invalid Palmon object: missing fields ${t.join(", ")}`);if(!e.skills.skill1||!e.skills.skill2||!e.skills.passive)throw new Error("Invalid Palmon object: incomplete skills structure");return!0}}export default PalmonDataProcessor;class FilterEngine{constructor(e){this.dataUtils=e,this.activeFilters=new Map,this.filterHistory=[],this.maxHistorySize=10}setFilter(e,t,n,i={}){const a=`${e}:${t}`;null!=n&&"All"!==n?(this.activeFilters.set(a,{type:e,key:t,value:n,options:i,timestamp:Date.now()}),this.saveToHistory()):this.removeFilter(a)}removeFilter(e){this.activeFilters.has(e)&&(this.activeFilters.delete(e),this.saveToHistory())}clearAllFilters(){this.activeFilters.clear(),this.saveToHistory()}applyFilters(e=null){let t=e||this.dataUtils.getAllPalmon();if(0===this.activeFilters.size)return t;for(const[e,n]of this.activeFilters)t=this.applySingleFilter(t,n);return t}applySingleFilter(e,t){switch(t.type){case"element":return this.filterByElement(e,t.value);case"tier":return this.filterByTier(e,t.value);case"role":return this.filterByRole(e,t.value);case"stat":return this.filterByStat(e,t.key,t.value,t.options);case"skill":return this.filterBySkill(e,t.key,t.value,t.options);case"custom":return this.filterByCustom(e,t.key,t.value,t.options);default:return e}}filterByElement(e,t){const n=Array.isArray(t)?t:[t];return e.filter(e=>n.includes(e.element))}filterByTier(e,t){const n=Array.isArray(t)?t:[t];return e.filter(e=>n.includes(e.tier))}filterByRole(e,t){const n=Array.isArray(t)?t:[t];return e.filter(e=>n.includes(e.role))}filterByStat(e,t,n,i={}){return e.filter(e=>{const a=e.stats[t];if(void 0===a)return!1;if("number"==typeof n){switch(i.operator||">="){case">=":default:return a>=n;case"<=":return a<=n;case">":return a>n;case"<":return a<n;case"=":return a===n}}else if("object"==typeof n&&void 0!==n.min&&void 0!==n.max)return a>=n.min&&a<=n.max;return!1})}filterBySkill(e,t,n,i={}){const a=i.caseSensitive||!1,s=i.exact||!1,o=a?n:n.toLowerCase();return e.filter(e=>{const n=[e.skills.skill1,e.skills.skill2,e.skills.passive];return e.evolveSkill&&n.push(e.evolveSkill),n.some(e=>{const n=e[t];if(!n)return!1;const i=a?n:n.toLowerCase();return s?i===o:i.includes(o)})})}filterByCustom(e,t,n,i={}){return"function"!=typeof i.filterFunction?(console.warn(`Custom filter "${t}" missing filter function`),e):e.filter(e=>i.filterFunction(e,n,i))}applyComplexFilter(e,t="AND"){let n=this.dataUtils.getAllPalmon();if("AND"===t)e.forEach(e=>{n=this.applySingleFilter(n,e)});else if("OR"===t){const t=new Set;e.forEach(e=>{this.applySingleFilter(this.dataUtils.getAllPalmon(),e).forEach(e=>t.add(e))}),n=Array.from(t)}return n}getFilterSuggestions(e,t=null){const n=t||this.dataUtils.getAllPalmon(),i=new Set;switch(e){case"element":n.forEach(e=>i.add(e.element));break;case"tier":n.forEach(e=>i.add(e.tier));break;case"role":n.forEach(e=>i.add(e.role));break;case"skillName":n.forEach(e=>{i.add(e.skills.skill1.name),i.add(e.skills.skill2.name),i.add(e.skills.passive.name),e.evolveSkill&&i.add(e.evolveSkill.name)})}return Array.from(i).sort()}getActiveFilters(){return new Map(this.activeFilters)}getFilterSummary(){const e={totalFilters:this.activeFilters.size,filterTypes:{},appliedAt:null};let t=0;for(const[n,i]of this.activeFilters)e.filterTypes[i.type]=(e.filterTypes[i.type]||0)+1,t=Math.max(t,i.timestamp);return t>0&&(e.appliedAt=new Date(t)),e}saveToHistory(){const e={filters:new Map(this.activeFilters),timestamp:Date.now()};this.filterHistory.unshift(e),this.filterHistory.length>this.maxHistorySize&&(this.filterHistory=this.filterHistory.slice(0,this.maxHistorySize))}restoreFromHistory(e=0){if(e>=0&&e<this.filterHistory.length){const t=this.filterHistory[e];this.activeFilters=new Map(t.filters)}}getFilterHistory(){return this.filterHistory.map((e,t)=>({index:t,timestamp:new Date(e.timestamp),filterCount:e.filters.size,filters:Array.from(e.filters.keys())}))}createPreset(e,t){const n={name:e,filters:t,created:Date.now()};try{const t=this.getPresets();t[e]=n,localStorage.setItem("palmon_filter_presets",JSON.stringify(t))}catch(e){console.warn("Failed to save filter preset:",e)}}applyPreset(e){const t=this.getPresets()[e];t?(this.clearAllFilters(),t.filters.forEach(e=>{this.setFilter(e.type,e.key,e.value,e.options)})):console.warn(`Filter preset "${e}" not found`)}getPresets(){try{const e=localStorage.getItem("palmon_filter_presets");return e?JSON.parse(e):{}}catch(e){return console.warn("Failed to load filter presets:",e),{}}}deletePreset(e){try{const t=this.getPresets();delete t[e],localStorage.setItem("palmon_filter_presets",JSON.stringify(t))}catch(e){console.warn("Failed to delete filter preset:",e)}}exportFilters(){return{filters:Array.from(this.activeFilters.entries()),timestamp:Date.now(),version:"1.0"}}importFilters(e){if(!e.filters||!Array.isArray(e.filters))throw new Error("Invalid filter configuration");this.clearAllFilters(),e.filters.forEach(([e,t])=>{this.activeFilters.set(e,t)})}getPerformanceStats(){const e=this.dataUtils.getAllPalmon().length,t=this.applyFilters().length;return{totalPalmon:e,filteredPalmon:t,filterEfficiency:e>0?t/e:0,activeFilters:this.activeFilters.size,historySize:this.filterHistory.length}}}export default FilterEngine;import DataUtils from"./utils/data-utils.js";import TeamManager from"./team/team-manager.js";import PalmonSelectionPanel from"./team/palmon-selection-panel.js";import TeamSaveShareUI from"./team/team-save-share-ui.js";class PalmonApp{constructor(){this.palmonData=null,this.processedPalmonData=null,this.tierData=this.initializeTierData(),this.dataUtils=new DataUtils,this.teamManager=null,this.palmonSelectionPanel=null,this.teamSaveShareUI=null,this.init()}async init(){try{await this.dataUtils.loadPalmonData(),this.processedPalmonData=this.dataUtils.getAllPalmon(),this.teamManager=new TeamManager(this.dataUtils),this.teamManager.loadFromStorage(),this.initializeComponents(),this.setupEventListeners(),console.log("Palmon App initialized successfully")}catch(e){console.error("Failed to initialize Palmon App:",e),this.showError("Failed to load application. Please refresh the page.")}}async loadPalmonData(){try{const e=await fetch("./palmon.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);this.palmonData=await e.json(),this.processedPalmonData=this.processPalmonData(this.palmonData)}catch(e){throw console.error("Error loading Palmon data:",e),e}}initializeTierData(){return{Barkplug:{tier:"S",element:"Electric",role:"Support"},Statchew:{tier:"S",element:"Earth",role:"Tank"},Escarffier:{tier:"S",element:"Fire",role:"DPS"},Snowkami:{tier:"A",element:"Water",role:"DPS"},Hoofrit:{tier:"A",element:"Earth",role:"Tank"},Lucidina:{tier:"A",element:"Electric",role:"Support"},Battereina:{tier:"A",element:"Electric",role:"DPS"},Ninjump:{tier:"A",element:"Water",role:"DPS"},Wyvierno:{tier:"A",element:"Fire",role:"DPS"},Kilohopp:{tier:"B",element:"Electric",role:"Support"},Thunderclawd:{tier:"B",element:"Electric",role:"DPS"},Terrastudo:{tier:"B",element:"Earth",role:"Tank"},Incineraptor:{tier:"B",element:"Fire",role:"DPS"},Maximito:{tier:"B",element:"Earth",role:"Support"},Bruiseberry:{tier:"B",element:"Water",role:"Tank"},Lendanear:{tier:"B",element:"Water",role:"Support"},Rotorlotor:{tier:"B",element:"Electric",role:"DPS"},Cerverdant:{tier:"B",element:"Earth",role:"Support"},Vulcanid:{tier:"B",element:"Fire",role:"Support"},Herculeaf:{tier:"B",element:"Water",role:"DPS"},Voltbolt:{tier:"B",element:"Electric",role:"DPS"},Axollium:{tier:"B",element:"Earth",role:"DPS"},Meowdame:{tier:"C",element:"Electric",role:"Support"},Platyputz:{tier:"C",element:"Water",role:"Tank"},Baboom:{tier:"C",element:"Earth",role:"DPS"},Magmolin:{tier:"C",element:"Fire",role:"DPS"},Surveilynx:{tier:"C",element:"Earth",role:"Support"},Fingenue:{tier:"C",element:"Water",role:"Support"},Woozard:{tier:"C",element:"Earth",role:"Support"},Salamantis:{tier:"C",element:"Earth",role:"DPS"},Ghillant:{tier:"C",element:"Water",role:"DPS"},Dolphriend:{tier:"C",element:"Water",role:"Tank"},Abuzzinian:{tier:"C",element:"Electric",role:"Support"},Blazeal:{tier:"C",element:"Fire",role:"Tank"},Mantleray:{tier:"C",element:"Electric",role:"DPS"},Graffitty:{tier:"Economy",element:"Earth",role:"Support"},Squeezel:{tier:"Economy",element:"Water",role:"DPS"},Flouffant:{tier:"Economy",element:"Earth",role:"Support"},Spinchilla:{tier:"Economy",element:"Earth",role:"Support"},Emboa:{tier:"Economy",element:"Fire",role:"DPS"},Auktyke:{tier:"Economy",element:"Water",role:"Tank"}}}processPalmonData(e){return e.map(e=>{const t=e["Hero Name"],n=this.tierData[t]||{tier:"C",element:"Earth",role:"DPS"};return{id:e["Hero ID"],name:t,heroKey:e["Hero Key"],tier:n.tier,element:n.element,role:n.role,skills:{skill1:{name:e["Skill 1 Name"],description:e["Skill 1 Description"]},skill2:{name:e["Skill 2 Name"],description:e["Skill 2 Description"]},passive:{name:e["Skill 3 (Passive) Name"],description:e["Skill 3 Description"]},evolve:e["Evolve Skill Name"]?{name:e["Evolve Skill Name"],description:e["Evolve Skill Description"]}:null}}})}initializeComponents(){this.initializeNavigation(),this.initializeThemeToggle(),this.initializeHeroSection(),this.initializeFeaturedContent(),this.initializeTierListPreview(),this.initializeTeamBuilder(),this.initializeMetaAnalysis(),this.initializeTutorialSystem(),this.initializeSharingSystem()}initializeNavigation(){const e=document.getElementById("mobile-nav-toggle"),t=document.getElementById("nav-menu");e&&t&&(e.addEventListener("click",()=>{t.classList.toggle("active"),e.classList.toggle("active")}),document.addEventListener("click",n=>{e.contains(n.target)||t.contains(n.target)||(t.classList.remove("active"),e.classList.remove("active"))}));const n=document.querySelectorAll(".nav-link");n.forEach(i=>{i.addEventListener("click",a=>{a.preventDefault(),n.forEach(e=>e.classList.remove("active")),i.classList.add("active");const s=i.dataset.nav;s&&this.navigateTo(s),t.classList.remove("active"),e.classList.remove("active")})}),this.initializeSearch()}initializeThemeToggle(){const e=document.getElementById("theme-toggle"),t=e?.querySelector(".theme-icon");e&&e.addEventListener("click",()=>{document.body.classList.toggle("light-theme");const e=document.body.classList.contains("light-theme");t&&(t.textContent=e?"☀️":"🌙"),localStorage.setItem("theme",e?"light":"dark")});"light"===localStorage.getItem("theme")&&(document.body.classList.add("light-theme"),t&&(t.textContent="☀️"))}initializeSearch(){const e=document.getElementById("global-search"),t=document.querySelector(".search-btn");e&&(e.addEventListener("input",e=>{const t=e.target.value.trim();t.length>2&&this.performSearch(t)}),t&&t.addEventListener("click",()=>{const t=e.value.trim();t&&this.performSearch(t)}),e.addEventListener("keypress",t=>{if("Enter"===t.key){const t=e.value.trim();t&&this.performSearch(t)}}))}performSearch(e){console.log("Searching for:",e),this.showNotification(`Searching for "${e}"... (Search functionality will be implemented in upcoming tasks)`)}setupEventListeners(){document.addEventListener("DOMContentLoaded",()=>{this.hideLoadingScreen(),this.initializeFooter()}),window.addEventListener("hashchange",()=>{const e=window.location.hash.slice(1);e&&(this.showSection(e),this.updateActiveNavLink(e))});const e=window.location.hash.slice(1)||"home";this.showSection(e),this.updateActiveNavLink(e)}updateActiveNavLink(e){document.querySelectorAll(".nav-link").forEach(t=>{t.classList.remove("active"),t.dataset.nav===e&&t.classList.add("active")})}initializeHeroSection(){this.animateStats();const e=document.getElementById("random-palmon");e&&e.addEventListener("click",e=>{e.preventDefault(),this.showRandomPalmon()})}animateStats(){if(!this.processedPalmonData)return;const e={"total-palmon":this.processedPalmonData.length||0,"tier-s-count":this.processedPalmonData.filter(e=>"S"===e.tier).length||0,"synergy-combos":Math.floor(1.5*this.processedPalmonData.length)||0};Object.entries(e).forEach(([e,t])=>{const n=document.getElementById(e);n&&this.animateCounter(n,t)})}animateCounter(e,t,n=2e3){const i=t/(n/16);let a=0;const s=setInterval(()=>{a+=i,a>=t&&(a=t,clearInterval(s)),e.textContent=Math.floor(a)},16);e.style.animation="countUp 0.6s ease-out"}initializeTierListPreview(){console.log("Tier list preview initialization placeholder")}initializeFeaturedContent(){this.updateFeaturedPalmon();const e=document.getElementById("updates-date");if(e){const t=new Date;e.textContent=t.toLocaleDateString("en-US",{year:"numeric",month:"long",day:"numeric"})}setTimeout(()=>{this.animateTrendBars()},1e3)}updateFeaturedPalmon(){if(!this.processedPalmonData||0===this.processedPalmonData.length)return;const e=this.processedPalmonData.filter(e=>"S"===e.tier),t=e.length>0?e[Math.floor(Math.random()*e.length)]:this.processedPalmonData[Math.floor(Math.random()*this.processedPalmonData.length)],n=document.getElementById("featured-palmon");if(n&&t){const e=new PalmonCard(t,{compact:!0,showDetails:!1,clickable:!0});n.innerHTML="",n.appendChild(e.createElement())}}animateTrendBars(){document.querySelectorAll(".trend-fill").forEach((e,t)=>{setTimeout(()=>{const t=e.style.width;e.style.width="0%",setTimeout(()=>{e.style.width=t},100)},200*t)})}showRandomPalmon(){if(!this.processedPalmonData||0===this.processedPalmonData.length)return void this.showNotification("Palmon data not loaded yet!","warning");const e=this.processedPalmonData[Math.floor(Math.random()*this.processedPalmonData.length)];this.showNotification(`Random Palmon: ${e.name} (${e.tier}-Tier ${e.element})`,"info")}initializeFooter(){const e=document.getElementById("last-updated");if(e){const t=new Date;e.textContent=t.toLocaleDateString()}document.querySelectorAll(".footer-link").forEach(e=>{e.addEventListener("click",t=>{const n=e.getAttribute("href");if(n&&n.startsWith("#")){t.preventDefault();const e=n.slice(1);this.navigateTo(e)}})})}navigateTo(e){window.location.hash=e,this.showSection(e)}showSection(e){document.querySelectorAll(".page-section").forEach(e=>{e.classList.remove("active")});const t=document.querySelector(`#${e}`);t&&t.classList.add("active"),"meta-analysis"===e&&this.metaAnalyzer&&this.metaAnalyzer.renderMetaDashboard(),this.updatePageTitle(e)}updatePageTitle(e){document.title={home:"Palmon Masters - Ultimate Strategy Hub","tier-list":"Tier List - Palmon Masters","team-builder":"Team Builder - Palmon Masters","meta-analysis":"Meta Analysis - Palmon Masters",guides:"Strategy Guides - Palmon Masters"}[e]||"Palmon Masters"}hideLoadingScreen(){const e=document.querySelector(".loading-screen");e&&(e.style.display="none")}showError(e){this.showNotification(e,"error")}initializeMetaAnalysis(){console.log("Meta analysis initialization placeholder")}initializeTeamBuilder(){const e=document.getElementById("team-builder-container");if(e){const t=e.querySelector("#palmon-selection-panel");t&&(this.palmonSelectionPanel=new PalmonSelectionPanel(this.dataUtils,this.teamManager),this.palmonSelectionPanel.initialize(t));const n=e.querySelector("#synergy-analyzer-container");n&&import("./team/synergy-analyzer.js").then(({default:e})=>{this.synergyAnalyzer=new e(this.teamManager,this.dataUtils),this.synergyAnalyzer.initialize(n)}).catch(e=>{console.error("Failed to load synergy analyzer:",e)});const i=e.querySelector("#team-save-share-container");i&&(this.teamSaveShareUI=new TeamSaveShareUI(this.teamManager,this.dataUtils),this.teamSaveShareUI.initialize(i),document.addEventListener("teamChanged",()=>{this.teamSaveShareUI&&this.teamSaveShareUI.onTeamChange()}))}}initializeTutorialSystem(){console.log("Tutorial system initialization placeholder")}initializeSharingSystem(){console.log("Sharing system initialization placeholder")}setupMetaAnalysisNavigation(){const e=document.getElementById("nav-menu");if(e){const t=document.createElement("a");t.href="#meta-analysis",t.className="nav-link",t.dataset.nav="meta-analysis",t.innerHTML='\n        <span class="nav-icon">📈</span>\n        <span class="nav-text">Meta Analysis</span>\n      ';const n=e.querySelector('[data-nav="guides"]');n?e.insertBefore(t,n):e.appendChild(t)}}showNotification(e,t="info"){const n=document.createElement("div");n.className=`notification notification-${t}`,n.textContent=e;const i={info:"var(--text-accent)",error:"var(--tier-s)",success:"var(--tier-economy)",warning:"var(--tier-a)"};n.style.cssText=`\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: ${i[t]||i.info};\n      color: white;\n      padding: var(--spacing-md) var(--spacing-lg);\n      border-radius: var(--radius-md);\n      box-shadow: var(--shadow-lg);\n      z-index: var(--z-tooltip);\n      max-width: 300px;\n      font-size: var(--font-size-sm);\n      font-weight: var(--font-weight-medium);\n      animation: slideInRight 0.3s ease-out;\n    `,document.body.appendChild(n),setTimeout(()=>{n.style.animation="slideOutRight 0.3s ease-in",setTimeout(()=>{n.remove()},300)},5e3)}}class PalmonDetailModal{constructor(e){this.palmon=e,this.modal=null,this.isVisible=!1}show(){this.isVisible||(this.createModal(),document.body.appendChild(this.modal),requestAnimationFrame(()=>{this.modal.classList.add("modal-visible"),this.isVisible=!0}),this.attachEventListeners(),document.body.style.overflow="hidden")}hide(){this.isVisible&&this.modal&&(this.modal.classList.remove("modal-visible"),setTimeout(()=>{this.modal&&this.modal.parentNode&&this.modal.parentNode.removeChild(this.modal),this.modal=null,this.isVisible=!1,document.body.style.overflow=""},300))}createModal(){this.modal=document.createElement("div"),this.modal.className="palmon-detail-modal",this.modal.innerHTML=this.generateModalHTML()}generateModalHTML(){const e=this.palmon.tier.toLowerCase(),t=this.palmon.element.toLowerCase();return`\n      <div class="modal-backdrop"></div>\n      <div class="modal-container">\n        <div class="modal-header">\n          <div class="modal-header-content">\n            <div class="palmon-portrait-large">\n              <div class="palmon-portrait-placeholder-large">\n                <span class="palmon-element-icon-large" data-element="${t}">\n                  ${this.getElementIcon(this.palmon.element)}\n                </span>\n              </div>\n              <div class="palmon-tier-indicator-large">\n                <span class="badge badge-tier-${"economy"===e?"economy":e} tier-badge-xl">\n                  ${this.palmon.tier}\n                </span>\n              </div>\n            </div>\n            <div class="palmon-header-info">\n              <h1 class="palmon-detail-name">${this.palmon.name}</h1>\n              <div class="palmon-detail-meta">\n                <span class="badge badge-${t} element-badge-large">\n                  ${this.getElementIcon(this.palmon.element)} ${this.palmon.element}\n                </span>\n                <span class="palmon-role-large">${this.getRoleIcon(this.palmon.role)} ${this.palmon.role}</span>\n              </div>\n              <div class="palmon-detail-id">\n                <span class="detail-label">ID:</span>\n                <span class="detail-value">${this.palmon.id}</span>\n              </div>\n            </div>\n          </div>\n          <button class="modal-close-btn" title="Close">\n            <span class="close-icon">✕</span>\n          </button>\n        </div>\n\n        <div class="modal-body">\n          <div class="modal-content-grid">\n            \x3c!-- Skills Section --\x3e\n            <div class="modal-section skills-section">\n              <h2 class="section-title">\n                <span class="section-icon">⚡</span>\n                Skills & Abilities\n              </h2>\n              <div class="skills-container">\n                ${this.generateSkillHTML(this.palmon.skills.skill1,"skill1","Active Skill 1")}\n                ${this.generateSkillHTML(this.palmon.skills.skill2,"skill2","Active Skill 2")}\n                ${this.generateSkillHTML(this.palmon.skills.passive,"passive","Passive Skill")}\n                ${this.palmon.skills.evolve?this.generateSkillHTML(this.palmon.skills.evolve,"evolve","Evolution Skill"):""}\n              </div>\n            </div>\n\n            \x3c!-- Strategic Analysis Section --\x3e\n            <div class="modal-section analysis-section">\n              <h2 class="section-title">\n                <span class="section-icon">📊</span>\n                Strategic Analysis\n              </h2>\n              <div class="analysis-container">\n                ${this.generateAnalysisHTML()}\n              </div>\n            </div>\n\n            \x3c!-- Synergy & Counters Section --\x3e\n            <div class="modal-section synergy-section">\n              <h2 class="section-title">\n                <span class="section-icon">🤝</span>\n                Synergies & Counters\n              </h2>\n              <div class="synergy-container">\n                ${this.generateSynergyHTML()}\n              </div>\n            </div>\n\n            \x3c!-- Usage Guide Section --\x3e\n            <div class="modal-section usage-section">\n              <h2 class="section-title">\n                <span class="section-icon">📚</span>\n                Usage Guide\n              </h2>\n              <div class="usage-container">\n                ${this.generateUsageHTML()}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        <div class="modal-footer">\n          <div class="modal-actions">\n            <button class="btn btn-secondary modal-action-btn" id="add-to-team-btn">\n              <span class="btn-icon">➕</span>\n              Add to Team\n            </button>\n            <button class="btn btn-ghost modal-action-btn" id="compare-btn">\n              <span class="btn-icon">⚖️</span>\n              Compare\n            </button>\n            <button class="btn btn-ghost modal-action-btn" id="share-btn">\n              <span class="btn-icon">🔗</span>\n              Share\n            </button>\n            <button class="btn btn-primary modal-action-btn" id="view-tier-btn">\n              <span class="btn-icon">📊</span>\n              View in Tier List\n            </button>\n          </div>\n        </div>\n      </div>\n    `}generateSkillHTML(e,t,n){if(!e||!e.name)return"";return`\n      <div class="skill-card ${"passive"===t?"passive":"evolve"===t?"evolve":"active"}">\n        <div class="skill-header">\n          <div class="skill-icon-container">\n            <span class="skill-icon">${this.getSkillIcon(t)}</span>\n          </div>\n          <div class="skill-info">\n            <h3 class="skill-name">${e.name}</h3>\n            <span class="skill-type">${n}</span>\n          </div>\n        </div>\n        <div class="skill-description">\n          <p>${this.formatSkillDescription(e.description)}</p>\n        </div>\n        ${this.generateSkillEffectsHTML(e)}\n      </div>\n    `}generateSkillEffectsHTML(e){const t=this.extractSkillEffects(e.description);return 0===t.length?"":`\n      <div class="skill-effects">\n        <h4 class="effects-title">Key Effects:</h4>\n        <ul class="effects-list">\n          ${t.map(e=>`<li class="effect-item">${e}</li>`).join("")}\n        </ul>\n      </div>\n    `}generateAnalysisHTML(){const e=this.generateStrategicAnalysis();return`\n      <div class="analysis-grid">\n        <div class="rating-section">\n          <h3 class="analysis-subtitle">Performance Ratings</h3>\n          <div class="rating-bars">\n            ${this.generateRatingBar("Damage Output",e.ratings.damage)}\n            ${this.generateRatingBar("Survivability",e.ratings.survivability)}\n            ${this.generateRatingBar("Utility",e.ratings.utility)}\n            ${this.generateRatingBar("Synergy Potential",e.ratings.synergy)}\n            ${this.generateRatingBar("Economy Value",e.ratings.economy)}\n          </div>\n        </div>\n        \n        <div class="strengths-weaknesses">\n          <div class="strengths">\n            <h4 class="analysis-subtitle">\n              <span class="strength-icon">💪</span>\n              Strengths\n            </h4>\n            <ul class="analysis-list">\n              ${e.strengths.map(e=>`<li class="analysis-item strength-item">${e}</li>`).join("")}\n            </ul>\n          </div>\n          \n          <div class="weaknesses">\n            <h4 class="analysis-subtitle">\n              <span class="weakness-icon">⚠️</span>\n              Weaknesses\n            </h4>\n            <ul class="analysis-list">\n              ${e.weaknesses.map(e=>`<li class="analysis-item weakness-item">${e}</li>`).join("")}\n            </ul>\n          </div>\n        </div>\n      </div>\n      \n      <div class="tier-justification">\n        <h3 class="analysis-subtitle">Tier Placement Justification</h3>\n        <p class="tier-explanation">${e.tierJustification}</p>\n      </div>\n    `}generateSynergyHTML(){const e=this.generateSynergyData();return`\n      <div class="synergy-grid">\n        <div class="synergy-partners">\n          <h3 class="synergy-subtitle">\n            <span class="synergy-icon">🤝</span>\n            Best Partners\n          </h3>\n          <div class="partner-list">\n            ${e.partners.map(e=>this.generatePartnerHTML(e)).join("")}\n          </div>\n        </div>\n        \n        <div class="counters">\n          <h3 class="synergy-subtitle">\n            <span class="counter-icon">⚔️</span>\n            Counters & Threats\n          </h3>\n          <div class="counter-list">\n            ${e.counters.map(e=>this.generateCounterHTML(e)).join("")}\n          </div>\n        </div>\n        \n        <div class="element-synergies">\n          <h3 class="synergy-subtitle">\n            <span class="element-icon">${this.getElementIcon(this.palmon.element)}</span>\n            ${this.palmon.element} Element Synergies\n          </h3>\n          <div class="element-synergy-info">\n            ${this.generateElementSynergyHTML()}\n          </div>\n        </div>\n      </div>\n    `}generateUsageHTML(){const e=this.generateUsageGuide();return`\n      <div class="usage-guide">\n        <div class="positioning-guide">\n          <h3 class="usage-subtitle">\n            <span class="position-icon">📍</span>\n            Optimal Positioning\n          </h3>\n          <p class="usage-text">${e.positioning}</p>\n        </div>\n        \n        <div class="timing-guide">\n          <h3 class="usage-subtitle">\n            <span class="timing-icon">⏰</span>\n            Skill Timing\n          </h3>\n          <p class="usage-text">${e.timing}</p>\n        </div>\n        \n        <div class="team-role">\n          <h3 class="usage-subtitle">\n            <span class="role-icon">${this.getRoleIcon(this.palmon.role)}</span>\n            Team Role\n          </h3>\n          <p class="usage-text">${e.teamRole}</p>\n        </div>\n        \n        <div class="matchup-tips">\n          <h3 class="usage-subtitle">\n            <span class="tips-icon">💡</span>\n            Pro Tips\n          </h3>\n          <ul class="tips-list">\n            ${e.tips.map(e=>`<li class="tip-item">${e}</li>`).join("")}\n          </ul>\n        </div>\n      </div>\n    `}getElementIcon(e){return{Fire:"🔥",Water:"💧",Earth:"🌱",Electric:"⚡"}[e]||"❓"}getRoleIcon(e){return{Tank:"🛡️",DPS:"⚔️",Support:"💚",Control:"🎯"}[e]||"❓"}getSkillIcon(e){return{skill1:"🎯",skill2:"💥",passive:"🔄",evolve:"⭐"}[e]||"⚡"}formatSkillDescription(e){return e?e.replace(/(\d+)%/g,'<span class="skill-value">$1%</span>').replace(/(\d+) times?/g,'<span class="skill-count">$1 times</span>').replace(/(\d+) damage/g,'<span class="skill-damage">$1 damage</span>'):"No description available."}extractSkillEffects(e){const t=[];return e.includes("damage")&&t.push("Deals damage to enemies"),e.includes("heal")&&t.push("Provides healing effects"),(e.includes("buff")||e.includes("enhance"))&&t.push("Buffs allies or self"),(e.includes("debuff")||e.includes("reduce"))&&t.push("Applies debuffs to enemies"),e.includes("chance")&&t.push("Has probability-based activation"),t}generateRatingBar(e,t){return`\n      <div class="rating-item">\n        <div class="rating-label">${e}</div>\n        <div class="rating-bar">\n          <div class="rating-fill ${t>=4?"excellent":t>=3?"good":t>=2?"average":"poor"}" style="width: ${Math.min(100,Math.max(0,20*t))}%"></div>\n        </div>\n        <div class="rating-value">${t}/5</div>\n      </div>\n    `}generateStrategicAnalysis(){const e={S:{damage:5,survivability:5,utility:5,synergy:5,economy:3},A:{damage:4,survivability:4,utility:4,synergy:4,economy:4},B:{damage:3,survivability:3,utility:3,synergy:3,economy:4},C:{damage:2,survivability:2,utility:2,synergy:2,economy:4},Economy:{damage:2,survivability:2,utility:2,synergy:2,economy:5}},t=e[this.palmon.tier]||e.C,n={Tank:{survivability:1,damage:-1},DPS:{damage:1,survivability:-1},Support:{utility:1,synergy:1,damage:-1},Control:{utility:1,synergy:1,survivability:-1}}[this.palmon.role]||{},i={...t};return Object.keys(n).forEach(e=>{i[e]=Math.min(5,Math.max(1,i[e]+n[e]))}),{ratings:i,strengths:this.generateStrengths(),weaknesses:this.generateWeaknesses(),tierJustification:this.generateTierJustification()}}generateStrengths(){const e=[];return"S"===this.palmon.tier&&(e.push("Exceptional performance in current meta"),e.push("High impact in team compositions")),"Tank"===this.palmon.role?(e.push("Strong defensive capabilities"),e.push("Excellent frontline presence")):"DPS"===this.palmon.role?(e.push("High damage output potential"),e.push("Strong offensive capabilities")):"Support"===this.palmon.role&&(e.push("Valuable team utility"),e.push("Strong synergy enabler")),"Fire"===this.palmon.element?e.push("Aggressive playstyle synergy"):"Water"===this.palmon.element?e.push("Balanced offensive/defensive options"):"Earth"===this.palmon.element?e.push("Solid defensive foundation"):"Electric"===this.palmon.element&&e.push("High-speed combat effectiveness"),e.slice(0,4)}generateWeaknesses(){const e=[];return"C"!==this.palmon.tier&&"Economy"!==this.palmon.tier||(e.push("Limited late-game scaling"),e.push("Outclassed by higher-tier alternatives")),"Tank"===this.palmon.role?e.push("Lower damage output"):"DPS"===this.palmon.role?e.push("Vulnerable to focused fire"):"Support"===this.palmon.role&&e.push("Dependent on team coordination"),e.push("Requires specific team compositions for optimal performance"),e.slice(0,3)}generateTierJustification(){const e={S:`${this.palmon.name} earns its S-tier placement through exceptional performance across multiple metrics. Its combination of powerful abilities, strong synergies, and meta relevance makes it a top-tier choice for competitive play.`,A:`${this.palmon.name} is a solid A-tier performer with strong capabilities in its role. While not quite reaching S-tier dominance, it offers reliable performance and good synergy potential in most team compositions.`,B:`${this.palmon.name} represents a balanced B-tier choice with decent performance in its designated role. It may require more specific team setups to shine but can be effective in the right circumstances.`,C:`${this.palmon.name} is placed in C-tier due to limited impact compared to higher-tier alternatives. While still usable, it may struggle in competitive environments without significant support.`,Economy:`${this.palmon.name} excels in its Economy tier role, providing excellent value for resource management and early-game progression. While not a late-game powerhouse, it serves its purpose effectively.`};return e[this.palmon.tier]||e.C}generateSynergyData(){const e=window.palmonApp,t=e?.processedPalmonData||[],n=this.getElementSynergyPartners(t),i=this.getRoleSynergyPartners(t),a=this.getSpecificSynergyPartners(t),s=this.getElementCounters(t),o=this.getRoleCounters(t),r=this.getSpecificCounters(t);return{partners:[...n,...i,...a].slice(0,6),counters:[...s,...o,...r].slice(0,6)}}getElementSynergyPartners(e){return e.filter(e=>e.element===this.palmon.element&&e.id!==this.palmon.id&&("S"===e.tier||"A"===e.tier||"B"===this.palmon.tier&&"B"===e.tier)).slice(0,3).map(e=>({name:e.name,id:e.id,tier:e.tier,element:e.element,role:e.role,type:"element",description:`Strong ${this.palmon.element} element synergy. ${this.getElementSynergyExplanation(e)}`,synergyStrength:this.calculateSynergyStrength(e,"element"),clickable:!0}))}getRoleSynergyPartners(e){const t=this.getComplementaryRoles(this.palmon.role);return e.filter(e=>t.includes(e.role)&&e.id!==this.palmon.id&&("S"===e.tier||"A"===e.tier||"Economy"!==this.palmon.tier&&"B"===e.tier)).slice(0,2).map(e=>({name:e.name,id:e.id,tier:e.tier,element:e.element,role:e.role,type:"role",description:`Excellent ${this.palmon.role}-${e.role} synergy. ${this.getRoleSynergyExplanation(e)}`,synergyStrength:this.calculateSynergyStrength(e,"role"),clickable:!0}))}getSpecificSynergyPartners(e){const t=this.getSpecificSynergyMappings()[this.palmon.name]||[];return e.filter(e=>t.includes(e.name)&&e.id!==this.palmon.id).map(e=>({name:e.name,id:e.id,tier:e.tier,element:e.element,role:e.role,type:"specific",description:`Unique synergy combination. ${this.getSpecificSynergyExplanation(e)}`,synergyStrength:this.calculateSynergyStrength(e,"specific"),clickable:!0}))}getElementCounters(e){const t=this.getCounterElements(this.palmon.element);return e.filter(e=>t.includes(e.element)&&e.id!==this.palmon.id&&("S"===e.tier||"A"===e.tier)).slice(0,2).map(e=>({name:e.name,id:e.id,tier:e.tier,element:e.element,role:e.role,type:"element",description:`${e.element} element advantage. ${this.getElementCounterExplanation(e)}`,threatLevel:this.calculateThreatLevel(e,"element"),clickable:!0}))}getRoleCounters(e){const t=this.getCounterRoles(this.palmon.role);return e.filter(e=>t.includes(e.role)&&e.id!==this.palmon.id&&("S"===e.tier||"A"===e.tier)).slice(0,2).map(e=>({name:e.name,id:e.id,tier:e.tier,element:e.element,role:e.role,type:"role",description:`${e.role} role advantage. ${this.getRoleCounterExplanation(e)}`,threatLevel:this.calculateThreatLevel(e,"role"),clickable:!0}))}getSpecificCounters(e){const t=this.getSpecificCounterMappings()[this.palmon.name]||[];return e.filter(e=>t.includes(e.name)&&e.id!==this.palmon.id).map(e=>({name:e.name,id:e.id,tier:e.tier,element:e.element,role:e.role,type:"specific",description:`Direct counter matchup. ${this.getSpecificCounterExplanation(e)}`,threatLevel:this.calculateThreatLevel(e,"specific"),clickable:!0}))}getComplementaryRoles(e){return{Tank:["DPS","Support"],DPS:["Tank","Support"],Support:["Tank","DPS","Control"],Control:["Tank","DPS"]}[e]||[]}getCounterElements(e){return{Fire:["Water"],Water:["Electric"],Electric:["Earth"],Earth:["Fire"]}[e]||[]}getCounterRoles(e){return{Tank:["Control","DPS"],DPS:["Tank"],Support:["DPS","Control"],Control:["DPS"]}[e]||[]}getSpecificSynergyMappings(){return{Barkplug:["Statchew","Lucidina","Battereina"],Statchew:["Barkplug","Hoofrit","Terrastudo"],Escarffier:["Wyvierno","Incineraptor","Vulcanid"],Snowkami:["Ninjump","Bruiseberry","Lendanear"],Hoofrit:["Statchew","Maximito","Cerverdant"],Lucidina:["Barkplug","Battereina","Kilohopp"],Battereina:["Barkplug","Lucidina","Thunderclawd"],Ninjump:["Snowkami","Herculeaf","Ghillant"],Wyvierno:["Escarffier","Incineraptor"]}}getSpecificCounterMappings(){return{Barkplug:["Snowkami","Ninjump","Bruiseberry"],Statchew:["Escarffier","Wyvierno","Incineraptor"],Escarffier:["Snowkami","Bruiseberry","Dolphriend"],Snowkami:["Battereina","Thunderclawd","Voltbolt"],Hoofrit:["Escarffier","Wyvierno","Vulcanid"],Lucidina:["Statchew","Hoofrit","Terrastudo"],Battereina:["Statchew","Maximito","Axollium"],Ninjump:["Battereina","Lucidina","Kilohopp"],Wyvierno:["Snowkami","Ninjump","Lendanear"]}}calculateSynergyStrength(e,t){let n=3;return e.tier===this.palmon.tier&&(n+=1),"S"!==e.tier&&"S"!==this.palmon.tier||(n+=1),"specific"===t&&(n+=2),"element"===t&&(n+=1),Math.min(5,n)}calculateThreatLevel(e,t){let n=3;return"S"===e.tier&&"S"!==this.palmon.tier&&(n+=2),"A"!==e.tier||"C"!==this.palmon.tier&&"Economy"!==this.palmon.tier||(n+=1),"specific"===t&&(n+=2),"element"===t&&(n+=1),Math.min(5,n)}getElementSynergyExplanation(e){return{Fire:"Amplifies aggressive strategies and burst damage potential.",Water:"Provides balanced offensive and defensive synergies.",Earth:"Strengthens defensive formations and sustainability.",Electric:"Enhances speed and utility-based strategies."}[e.element]||"Provides elemental synergy benefits."}getRoleSynergyExplanation(e){const t={"Tank-DPS":"Tank provides protection while DPS delivers damage.","Tank-Support":"Tank absorbs damage while Support provides utility.","DPS-Support":"Support enables DPS to maximize damage output.","DPS-Control":"Control creates opportunities for DPS to strike.","Support-Control":"Combined utility and battlefield control.","Tank-Control":"Control supports Tank positioning and presence."},n=`${this.palmon.role}-${e.role}`,i=`${e.role}-${this.palmon.role}`;return t[n]||t[i]||"Provides complementary role benefits."}getSpecificSynergyExplanation(e){return"Unique ability interactions create powerful combination effects."}getElementCounterExplanation(e){return{Fire:"Fire abilities are effective against Earth defenses.",Water:"Water attacks counter Fire-based strategies.",Electric:"Electric speed overwhelms Water-based tactics.",Earth:"Earth stability counters Electric mobility."}[e.element]||"Has elemental advantage in this matchup."}getRoleCounterExplanation(e){return{Tank:"High durability counters burst damage strategies.",DPS:"High damage output can overwhelm defensive positions.",Support:"Utility and healing counter aggressive strategies.",Control:"Battlefield control disrupts enemy positioning."}[e.role]||"Role provides strategic advantage."}getSpecificCounterExplanation(e){return"Specific abilities and positioning create unfavorable matchups."}generatePartnerHTML(e){const t="economy"===e.tier?.toLowerCase()?"economy":e.tier?.toLowerCase()||"c",n=e.element?.toLowerCase()||"earth",i="★".repeat(e.synergyStrength||3);return`\n      <div class="partner-item ${e.clickable?"clickable":""}" ${e.clickable?`data-palmon-id="${e.id}"`:""}>\n        <div class="partner-header">\n          <div class="partner-portrait">\n            <div class="partner-portrait-placeholder">\n              <span class="partner-element-icon" data-element="${n}">\n                ${this.getElementIcon(e.element)}\n              </span>\n            </div>\n            <div class="partner-tier-badge">\n              <span class="badge badge-tier-${t}">${e.tier}</span>\n            </div>\n          </div>\n          <div class="partner-info">\n            <h4 class="partner-name">${e.name}</h4>\n            <div class="partner-meta">\n              <span class="partner-role">${this.getRoleIcon(e.role)} ${e.role}</span>\n              <div class="synergy-strength">\n                <span class="synergy-stars">${i}</span>\n                <span class="synergy-label">Synergy</span>\n              </div>\n            </div>\n          </div>\n          ${e.clickable?`\n            <div class="partner-actions">\n              <button class="btn btn-xs btn-ghost partner-view-btn" data-palmon-id="${e.id}">\n                <span class="btn-icon">👁️</span>\n              </button>\n              <button class="btn btn-xs btn-secondary partner-compare-btn" data-palmon-id="${e.id}">\n                <span class="btn-icon">⚖️</span>\n              </button>\n            </div>\n          `:""}\n        </div>\n        <div class="partner-description">\n          <p>${e.description}</p>\n          <div class="synergy-type-badge">\n            <span class="badge badge-${e.type||"general"}">${this.getSynergyTypeLabel(e.type)}</span>\n          </div>\n        </div>\n      </div>\n    `}generateCounterHTML(e){const t="economy"===e.tier?.toLowerCase()?"economy":e.tier?.toLowerCase()||"c",n=e.element?.toLowerCase()||"earth",i="⚠️".repeat(e.threatLevel||3);return`\n      <div class="counter-item ${e.clickable?"clickable":""}" ${e.clickable?`data-palmon-id="${e.id}"`:""}>\n        <div class="counter-header">\n          <div class="counter-portrait">\n            <div class="counter-portrait-placeholder">\n              <span class="counter-element-icon" data-element="${n}">\n                ${this.getElementIcon(e.element)}\n              </span>\n            </div>\n            <div class="counter-tier-badge">\n              <span class="badge badge-tier-${t}">${e.tier}</span>\n            </div>\n          </div>\n          <div class="counter-info">\n            <h4 class="counter-name">${e.name}</h4>\n            <div class="counter-meta">\n              <span class="counter-role">${this.getRoleIcon(e.role)} ${e.role}</span>\n              <div class="threat-level">\n                <span class="threat-stars">${i}</span>\n                <span class="threat-label">Threat</span>\n              </div>\n            </div>\n          </div>\n          ${e.clickable?`\n            <div class="counter-actions">\n              <button class="btn btn-xs btn-ghost counter-view-btn" data-palmon-id="${e.id}">\n                <span class="btn-icon">👁️</span>\n              </button>\n              <button class="btn btn-xs btn-secondary counter-compare-btn" data-palmon-id="${e.id}">\n                <span class="btn-icon">⚖️</span>\n              </button>\n            </div>\n          `:""}\n        </div>\n        <div class="counter-description">\n          <p>${e.description}</p>\n          <div class="counter-type-badge">\n            <span class="badge badge-${e.type||"general"}">${this.getCounterTypeLabel(e.type)}</span>\n          </div>\n        </div>\n      </div>\n    `}getSynergyTypeLabel(e){return{element:"Element Synergy",role:"Role Synergy",specific:"Unique Combo",general:"General Synergy"}[e]||"Synergy"}getCounterTypeLabel(e){return{element:"Element Counter",role:"Role Counter",specific:"Direct Counter",general:"General Counter"}[e]||"Counter"}generateElementSynergyHTML(){return`<p class="element-synergy-text">${{Fire:"Fire Palmon excel in aggressive compositions, providing high damage output and offensive pressure. They synergize well with other Fire types for elemental bonuses.",Water:"Water Palmon offer balanced capabilities with both offensive and defensive options. They provide flexibility in team compositions and adapt well to various strategies.",Earth:"Earth Palmon focus on defensive stability and support capabilities. They form the backbone of defensive compositions and provide excellent survivability.",Electric:"Electric Palmon specialize in speed and utility, offering quick strikes and support abilities. They excel in fast-paced, high-mobility strategies."}[this.palmon.element]||"Provides unique elemental advantages in team compositions."}</p>`}generateUsageGuide(){const e={Tank:{positioning:"Place in front row to absorb damage and protect backline allies. Focus on maintaining aggro and controlling enemy positioning.",timing:"Use defensive abilities early in combat to establish presence. Save emergency abilities for critical moments.",teamRole:"Primary damage absorber and frontline controller. Enables aggressive positioning for DPS allies.",tips:["Position to protect vulnerable allies","Use abilities to control enemy movement","Coordinate with healers for maximum survivability","Focus on disrupting enemy formations"]},DPS:{positioning:"Optimal placement depends on range - melee DPS in front, ranged in back. Focus on high-value targets.",timing:"Coordinate burst damage with team abilities. Save powerful skills for key moments in combat.",teamRole:"Primary damage dealer responsible for eliminating threats. Focus on target prioritization.",tips:["Target enemy supports and DPS first","Coordinate with tanks for protection","Time abilities for maximum impact","Maintain safe positioning while dealing damage"]},Support:{positioning:"Usually placed in back row for safety. Position to maximize ability coverage of allies.",timing:"Use abilities proactively to prevent damage rather than reactively. Maintain consistent support.",teamRole:"Enables team performance through buffs, healing, and utility. Critical for team sustainability.",tips:["Prioritize keeping key allies alive","Use abilities before they're desperately needed","Position safely but within support range","Coordinate with team for maximum effectiveness"]},Control:{positioning:"Flexible positioning based on ability range. Focus on controlling key battlefield areas.",timing:"Use control abilities to disrupt enemy strategies and create opportunities for allies.",teamRole:"Battlefield controller that creates advantages through positioning and timing manipulation.",tips:["Disrupt enemy formations and strategies","Create opportunities for ally abilities","Control key battlefield positions","Time abilities to maximize disruption"]}};return e[this.palmon.role]||e.DPS}attachEventListeners(){const e=this.modal.querySelector(".modal-close-btn");e&&e.addEventListener("click",()=>this.hide());const t=this.modal.querySelector(".modal-backdrop");t&&t.addEventListener("click",()=>this.hide());const n=e=>{"Escape"===e.key&&(this.hide(),document.removeEventListener("keydown",n))};document.addEventListener("keydown",n);const i=this.modal.querySelector("#add-to-team-btn");i&&i.addEventListener("click",()=>{this.addToTeam()});const a=this.modal.querySelector("#compare-btn");a&&a.addEventListener("click",()=>{this.openComparison()});const s=this.modal.querySelector("#share-btn");s&&s.addEventListener("click",()=>{this.sharePalmon()});const o=this.modal.querySelector("#view-tier-btn");o&&o.addEventListener("click",()=>{this.viewInTierList()}),this.attachSynergyEventListeners()}addToTeam(){const e=new CustomEvent("palmon-add-to-team",{detail:{palmon:this.palmon}});document.dispatchEvent(e);const t=window.palmonApp;t&&t.showNotification(`${this.palmon.name} added to team!`,"success"),this.hide()}openComparison(){const e=PalmonComparisonManager.getInstance();e.addPalmon(this.palmon),e.show()}sharePalmon(){const e=`${window.location.origin}${window.location.pathname}#palmon-${this.palmon.id}`;navigator.share?navigator.share({title:`${this.palmon.name} - Palmon Masters`,text:`Check out ${this.palmon.name}, a ${this.palmon.tier}-tier ${this.palmon.element} ${this.palmon.role} in Palmon: Survival Min|Max!`,url:e}):navigator.clipboard.writeText(e).then(()=>{const e=window.palmonApp;e&&e.showNotification("Share link copied to clipboard!","success")})}viewInTierList(){const e=window.palmonApp;e&&(e.navigateTo("tier-list"),setTimeout(()=>{const e=document.querySelector(`[data-palmon-id="${this.palmon.id}"]`);e&&(e.scrollIntoView({behavior:"smooth",block:"center"}),e.classList.add("highlighted"),setTimeout(()=>e.classList.remove("highlighted"),3e3))},500)),this.hide()}attachSynergyEventListeners(){this.modal.querySelectorAll(".partner-view-btn").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.dataset.palmonId;this.viewRelatedPalmon(n)})});this.modal.querySelectorAll(".partner-compare-btn").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.dataset.palmonId;this.compareWithRelatedPalmon(n)})});this.modal.querySelectorAll(".counter-view-btn").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.dataset.palmonId;this.viewRelatedPalmon(n)})});this.modal.querySelectorAll(".counter-compare-btn").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.dataset.palmonId;this.compareWithRelatedPalmon(n)})});this.modal.querySelectorAll(".partner-item.clickable").forEach(e=>{e.addEventListener("click",t=>{if(!t.target.closest(".partner-actions")){const t=e.dataset.palmonId;this.viewRelatedPalmon(t)}})});this.modal.querySelectorAll(".counter-item.clickable").forEach(e=>{e.addEventListener("click",t=>{if(!t.target.closest(".counter-actions")){const t=e.dataset.palmonId;this.viewRelatedPalmon(t)}})})}viewRelatedPalmon(e){const t=window.palmonApp;if(!t||!t.processedPalmonData)return;const n=t.processedPalmonData.find(t=>t.id===e);n&&(this.hide(),setTimeout(()=>{new PalmonDetailModal(n).show()},300))}compareWithRelatedPalmon(e){const t=window.palmonApp;if(!t||!t.processedPalmonData)return;const n=t.processedPalmonData.find(t=>t.id===e);if(n){const e=PalmonComparisonManager.getInstance();e.addPalmon(this.palmon),e.addPalmon(n),this.hide(),setTimeout(()=>{e.show()},300)}}}class PalmonComparisonManager{static instance=null;static getInstance(){return PalmonComparisonManager.instance||(PalmonComparisonManager.instance=new PalmonComparisonManager),PalmonComparisonManager.instance}constructor(){if(PalmonComparisonManager.instance)return PalmonComparisonManager.instance;this.comparedPalmon=[],this.maxComparisons=3,this.modal=null,this.isVisible=!1,PalmonComparisonManager.instance=this}addPalmon(e){-1===this.comparedPalmon.findIndex(t=>t.id===e.id)&&(this.comparedPalmon.length>=this.maxComparisons&&this.comparedPalmon.shift(),this.comparedPalmon.push(e),this.isVisible&&this.updateModal())}removePalmon(e){this.comparedPalmon=this.comparedPalmon.filter(t=>t.id!==e),0===this.comparedPalmon.length?this.hide():this.isVisible&&this.updateModal()}clearAll(){this.comparedPalmon=[],this.isVisible&&this.hide()}show(){if(0===this.comparedPalmon.length){const e=window.palmonApp;return void(e&&e.showNotification("No Palmon selected for comparison","warning"))}this.isVisible?this.updateModal():(this.createModal(),document.body.appendChild(this.modal),requestAnimationFrame(()=>{this.modal.classList.add("modal-visible"),this.isVisible=!0}),this.attachEventListeners(),document.body.style.overflow="hidden")}hide(){this.isVisible&&this.modal&&(this.modal.classList.remove("modal-visible"),setTimeout(()=>{this.modal&&this.modal.parentNode&&this.modal.parentNode.removeChild(this.modal),this.modal=null,this.isVisible=!1,document.body.style.overflow=""},300))}createModal(){this.modal=document.createElement("div"),this.modal.className="palmon-comparison-modal",this.modal.innerHTML=this.generateModalHTML()}updateModal(){if(!this.modal)return;const e=this.modal.querySelector(".modal-container");e&&(e.innerHTML=this.generateModalContent(),this.attachModalEventListeners())}generateModalHTML(){return`\n      <div class="modal-backdrop"></div>\n      <div class="modal-container">\n        ${this.generateModalContent()}\n      </div>\n    `}generateModalContent(){return`\n      <div class="comparison-header">\n        <div class="comparison-header-content">\n          <h1 class="comparison-title">\n            <span class="comparison-icon">⚖️</span>\n            Palmon Comparison\n          </h1>\n          <div class="comparison-meta">\n            <span class="comparison-count">${this.comparedPalmon.length} of ${this.maxComparisons} Palmon</span>\n          </div>\n        </div>\n        <div class="comparison-actions">\n          <button class="btn btn-ghost btn-sm" id="add-palmon-btn">\n            <span class="btn-icon">➕</span>\n            Add Palmon\n          </button>\n          <button class="btn btn-secondary btn-sm" id="clear-comparison-btn">\n            <span class="btn-icon">🗑️</span>\n            Clear All\n          </button>\n          <button class="modal-close-btn" title="Close">\n            <span class="close-icon">✕</span>\n          </button>\n        </div>\n      </div>\n\n      <div class="comparison-body">\n        <div class="comparison-grid">\n          ${this.generateComparisonTable()}\n        </div>\n      </div>\n\n      <div class="comparison-footer">\n        <div class="comparison-footer-actions">\n          <button class="btn btn-ghost" id="export-comparison-btn">\n            <span class="btn-icon">📊</span>\n            Export Comparison\n          </button>\n          <button class="btn btn-secondary" id="share-comparison-btn">\n            <span class="btn-icon">🔗</span>\n            Share Comparison\n          </button>\n        </div>\n      </div>\n    `}generateComparisonTable(){if(0===this.comparedPalmon.length)return'\n        <div class="comparison-empty">\n          <div class="empty-state">\n            <span class="empty-icon">⚖️</span>\n            <h3 class="empty-title">No Palmon to Compare</h3>\n            <p class="empty-description">Add Palmon to start comparing their stats and abilities</p>\n            <button class="btn btn-primary" id="add-first-palmon-btn">\n              <span class="btn-icon">➕</span>\n              Add Palmon\n            </button>\n          </div>\n        </div>\n      ';this.generateComparisonData();return`\n      <div class="comparison-table">\n        \x3c!-- Header Row with Palmon Cards --\x3e\n        <div class="comparison-row comparison-header-row">\n          <div class="comparison-cell comparison-label-cell">\n            <span class="comparison-section-title">Palmon</span>\n          </div>\n          ${this.comparedPalmon.map(e=>this.generatePalmonHeaderCell(e)).join("")}\n        </div>\n\n        \x3c!-- Basic Info Section --\x3e\n        <div class="comparison-section">\n          <div class="comparison-section-header">\n            <h3 class="section-title">\n              <span class="section-icon">📋</span>\n              Basic Information\n            </h3>\n          </div>\n          \n          ${this.generateComparisonRow("Tier",this.comparedPalmon.map(e=>({value:e.tier,display:`<span class="badge badge-tier-${"economy"===e.tier.toLowerCase()?"economy":e.tier.toLowerCase()}">${e.tier}</span>`,sortValue:this.getTierSortValue(e.tier)})))}\n          \n          ${this.generateComparisonRow("Element",this.comparedPalmon.map(e=>({value:e.element,display:`<span class="badge badge-${e.element.toLowerCase()}">${this.getElementIcon(e.element)} ${e.element}</span>`,sortValue:e.element})))}\n          \n          ${this.generateComparisonRow("Role",this.comparedPalmon.map(e=>({value:e.role,display:`<span class="role-display">${this.getRoleIcon(e.role)} ${e.role}</span>`,sortValue:e.role})))}\n        </div>\n\n        \x3c!-- Skills Section --\x3e\n        <div class="comparison-section">\n          <div class="comparison-section-header">\n            <h3 class="section-title">\n              <span class="section-icon">⚡</span>\n              Skills & Abilities\n            </h3>\n          </div>\n          \n          ${this.generateSkillComparisonRows()}\n        </div>\n\n        \x3c!-- Strategic Analysis Section --\x3e\n        <div class="comparison-section">\n          <div class="comparison-section-header">\n            <h3 class="section-title">\n              <span class="section-icon">📊</span>\n              Strategic Analysis\n            </h3>\n          </div>\n          \n          ${this.generateAnalysisComparisonRows()}\n        </div>\n\n        \x3c!-- Synergy Section --\x3e\n        <div class="comparison-section">\n          <div class="comparison-section-header">\n            <h3 class="section-title">\n              <span class="section-icon">🤝</span>\n              Synergies & Matchups\n            </h3>\n          </div>\n          \n          ${this.generateSynergyComparisonRows()}\n        </div>\n      </div>\n    `}generatePalmonHeaderCell(e){const t=e.tier.toLowerCase(),n=e.element.toLowerCase();return`\n      <div class="comparison-cell palmon-header-cell">\n        <div class="palmon-comparison-card">\n          <button class="palmon-remove-btn" data-palmon-id="${e.id}" title="Remove from comparison">\n            <span class="remove-icon">✕</span>\n          </button>\n          \n          <div class="palmon-portrait-comparison">\n            <div class="palmon-portrait-placeholder-comparison">\n              <span class="palmon-element-icon-comparison" data-element="${n}">\n                ${this.getElementIcon(e.element)}\n              </span>\n            </div>\n            <div class="palmon-tier-indicator-comparison">\n              <span class="badge badge-tier-${"economy"===t?"economy":t}">\n                ${e.tier}\n              </span>\n            </div>\n          </div>\n          \n          <div class="palmon-comparison-info">\n            <h3 class="palmon-comparison-name">${e.name}</h3>\n            <div class="palmon-comparison-meta">\n              <span class="palmon-comparison-id">ID: ${e.id}</span>\n            </div>\n          </div>\n          \n          <button class="btn btn-ghost btn-sm palmon-detail-btn" data-palmon-id="${e.id}">\n            <span class="btn-icon">👁️</span>\n            Details\n          </button>\n        </div>\n      </div>\n    `}generateComparisonRow(e,t){const n=this.getBestValueIndices(t),i=this.getWorstValueIndices(t);return`\n      <div class="comparison-row">\n        <div class="comparison-cell comparison-label-cell">\n          <span class="comparison-label">${e}</span>\n        </div>\n        ${t.map((e,t)=>{const a=n.includes(t),s=i.includes(t);return`\n            <div class="comparison-cell comparison-value-cell ${a?"best-value":s?"worst-value":""}">\n              <div class="comparison-value">${e.display}</div>\n              ${a?'<span class="value-indicator best-indicator">👑</span>':""}\n              ${s?'<span class="value-indicator worst-indicator">⚠️</span>':""}\n            </div>\n          `}).join("")}\n      </div>\n    `}generateSkillComparisonRows(){return[{key:"skill1",label:"Active Skill 1",icon:"🎯"},{key:"skill2",label:"Active Skill 2",icon:"💥"},{key:"passive",label:"Passive Skill",icon:"🔄"},{key:"evolve",label:"Evolution Skill",icon:"⭐"}].map(e=>{const t=this.comparedPalmon.map(t=>{const n=t.skills[e.key];return n&&n.name?{value:n,display:`\n            <div class="skill-comparison-item">\n              <div class="skill-comparison-header">\n                <span class="skill-icon">${e.icon}</span>\n                <span class="skill-name">${n.name}</span>\n              </div>\n              <div class="skill-description-short">\n                ${this.truncateText(n.description,100)}\n              </div>\n            </div>\n          `,sortValue:n.name?1:0}:{value:null,display:'<span class="skill-unavailable">Not Available</span>',sortValue:0}});return this.generateComparisonRow(e.label,t)}).join("")}generateAnalysisComparisonRows(){return[{key:"damage",label:"Damage Output",icon:"⚔️"},{key:"survivability",label:"Survivability",icon:"🛡️"},{key:"utility",label:"Utility",icon:"🔧"},{key:"synergy",label:"Synergy Potential",icon:"🤝"},{key:"economy",label:"Economy Value",icon:"💰"}].map(e=>{const t=this.comparedPalmon.map(t=>{const n=this.generateStrategicAnalysisForPalmon(t).ratings[e.key];return{value:n,display:`\n            <div class="rating-comparison-item">\n              <div class="rating-bar-small">\n                <div class="rating-fill-small ${this.getRatingClass(n)}" style="width: ${20*n}%"></div>\n              </div>\n              <span class="rating-value-small">${n}/5</span>\n            </div>\n          `,sortValue:n}});return this.generateComparisonRow(e.label,t)}).join("")}generateSynergyComparisonRows(){const e=this.comparedPalmon.map(e=>{const t=this.comparedPalmon.filter(t=>t.id!==e.id&&t.element===e.element).length,n=this.comparedPalmon.filter(t=>t.id!==e.id&&this.getRoleCompatibility(e.role,t.role)).length;return{value:t+n,display:`\n          <div class="synergy-comparison-item">\n            <div class="synergy-stat">\n              <span class="synergy-icon">🌟</span>\n              <span class="synergy-count">${t}</span>\n              <span class="synergy-label">Element</span>\n            </div>\n            <div class="synergy-stat">\n              <span class="synergy-icon">🎯</span>\n              <span class="synergy-count">${n}</span>\n              <span class="synergy-label">Role</span>\n            </div>\n          </div>\n        `,sortValue:t+n}});return this.generateComparisonRow("Team Synergy",e)}generateComparisonData(){return this.comparedPalmon.map(e=>({...e,analysis:this.generateStrategicAnalysisForPalmon(e)}))}generateStrategicAnalysisForPalmon(e){const t={S:{damage:5,survivability:5,utility:5,synergy:5,economy:3},A:{damage:4,survivability:4,utility:4,synergy:4,economy:4},B:{damage:3,survivability:3,utility:3,synergy:3,economy:4},C:{damage:2,survivability:2,utility:2,synergy:2,economy:4},Economy:{damage:2,survivability:2,utility:2,synergy:2,economy:5}},n=t[e.tier]||t.C,i={Tank:{survivability:1,damage:-1},DPS:{damage:1,survivability:-1},Support:{utility:1,synergy:1,damage:-1},Control:{utility:1,synergy:1,survivability:-1}}[e.role]||{},a={...n};return Object.keys(i).forEach(e=>{a[e]=Math.min(5,Math.max(1,a[e]+i[e]))}),{ratings:a}}getBestValueIndices(e){if(0===e.length)return[];const t=Math.max(...e.map(e=>e.sortValue||0));return e.map((e,n)=>(e.sortValue||0)===t?n:-1).filter(e=>-1!==e)}getWorstValueIndices(e){if(0===e.length)return[];const t=Math.min(...e.map(e=>e.sortValue||0));return e.map((e,n)=>(e.sortValue||0)===t?n:-1).filter(e=>-1!==e)}getTierSortValue(e){return{S:5,A:4,B:3,C:2,Economy:1}[e]||0}getRatingClass(e){return e>=4?"excellent":e>=3?"good":e>=2?"average":"poor"}getRoleCompatibility(e,t){return{Tank:["DPS","Support"],DPS:["Tank","Support"],Support:["Tank","DPS"],Control:["Tank","DPS"]}[e]?.includes(t)||!1}truncateText(e,t){return!e||e.length<=t?e||"":e.substring(0,t)+"..."}getElementIcon(e){return{Fire:"🔥",Water:"💧",Earth:"🌱",Electric:"⚡"}[e]||"❓"}getRoleIcon(e){return{Tank:"🛡️",DPS:"⚔️",Support:"💚",Control:"🎯"}[e]||"❓"}attachEventListeners(){const e=this.modal.querySelector(".modal-close-btn");e&&e.addEventListener("click",()=>this.hide());const t=this.modal.querySelector(".modal-backdrop");t&&t.addEventListener("click",()=>this.hide());const n=e=>{"Escape"===e.key&&(this.hide(),document.removeEventListener("keydown",n))};document.addEventListener("keydown",n),this.attachModalEventListeners()}attachModalEventListeners(){this.modal.querySelectorAll(".palmon-remove-btn").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.dataset.palmonId;this.removePalmon(n)})});this.modal.querySelectorAll(".palmon-detail-btn").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.dataset.palmonId,i=this.comparedPalmon.find(e=>e.id===n);if(i){new PalmonDetailModal(i).show()}})});const e=this.modal.querySelector("#clear-comparison-btn");e&&e.addEventListener("click",()=>{this.clearAll()});const t=this.modal.querySelector("#add-palmon-btn");t&&t.addEventListener("click",()=>{this.showPalmonSelector()});const n=this.modal.querySelector("#export-comparison-btn");n&&n.addEventListener("click",()=>{this.exportComparison()});const i=this.modal.querySelector("#share-comparison-btn");i&&i.addEventListener("click",()=>{this.shareComparison()})}showPalmonSelector(){const e=window.palmonApp;e&&e.showNotification("Navigate to tier list or team builder to add more Palmon to comparison","info")}exportComparison(){let e=`Palmon Comparison - ${(new Date).toLocaleDateString()}\n`;e+="=".repeat(50)+"\n\n",this.comparedPalmon.forEach((t,n)=>{e+=`${n+1}. ${t.name}\n`,e+=`   Tier: ${t.tier} | Element: ${t.element} | Role: ${t.role}\n`,e+=`   Skills: ${t.skills.skill1?.name||"N/A"}, ${t.skills.skill2?.name||"N/A"}\n\n`});const t=new Blob([e],{type:"text/plain"}),n=URL.createObjectURL(t),i=document.createElement("a");i.href=n,i.download=`palmon-comparison-${Date.now()}.txt`,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n);const a=window.palmonApp;a&&a.showNotification("Comparison exported successfully!","success")}shareComparison(){const e=this.comparedPalmon.map(e=>e.id).join(","),t=`${window.location.origin}${window.location.pathname}#compare-${e}`;navigator.share?navigator.share({title:"Palmon Comparison - Palmon Masters",text:`Compare ${this.comparedPalmon.map(e=>e.name).join(", ")} in Palmon: Survival Min|Max!`,url:t}):navigator.clipboard.writeText(t).then(()=>{const e=window.palmonApp;e&&e.showNotification("Comparison link copied to clipboard!","success")})}}class PalmonCard{constructor(e,t={}){this.palmon=e,this.options={compact:t.compact||!1,showDetails:!1!==t.showDetails,clickable:!1!==t.clickable,draggable:!1!==t.draggable,...t}}createElement(){const e=document.createElement("div");return e.className="palmon-card "+(this.options.compact?"palmon-card-compact":""),e.dataset.palmonId=this.palmon.id,e.dataset.tier=this.palmon.tier.toLowerCase(),e.dataset.element=this.palmon.element.toLowerCase(),e.dataset.role=this.palmon.role.toLowerCase(),this.options.draggable&&(e.draggable=!0,e.classList.add("palmon-card-draggable")),e.innerHTML=this.generateCardHTML(),this.options.clickable&&this.attachEventListeners(e),e}generateCardHTML(){const e=this.palmon.tier.toLowerCase(),t=this.palmon.element.toLowerCase();return`\n      <div class="palmon-card-header">\n        <div class="palmon-portrait">\n          <div class="palmon-portrait-placeholder">\n            <span class="palmon-element-icon" data-element="${t}">\n              ${this.getElementIcon(this.palmon.element)}\n            </span>\n          </div>\n          <div class="palmon-tier-indicator">\n            <span class="badge badge-tier-${"economy"===e?"economy":e}">\n              ${this.palmon.tier}\n            </span>\n          </div>\n        </div>\n        <div class="palmon-basic-info">\n          <h3 class="palmon-name">${this.palmon.name}</h3>\n          <div class="palmon-meta">\n            <span class="badge badge-${t}">${this.palmon.element}</span>\n            <span class="palmon-role">${this.palmon.role}</span>\n          </div>\n        </div>\n      </div>\n      ${this.options.showDetails?this.generateDetailsHTML():""}\n      <div class="palmon-card-overlay">\n        <div class="palmon-card-actions">\n          <button class="btn btn-sm btn-primary palmon-details-btn">\n            <span class="btn-icon">👁️</span>\n            Details\n          </button>\n          <div class="palmon-card-secondary-actions">\n            <button class="btn btn-sm btn-secondary palmon-add-btn">\n              <span class="btn-icon">➕</span>\n              Add\n            </button>\n            <button class="btn btn-sm btn-ghost palmon-compare-btn">\n              <span class="btn-icon">⚖️</span>\n              Compare\n            </button>\n          </div>\n        </div>\n      </div>\n    `}generateDetailsHTML(){return this.options.compact?"":`\n      <div class="palmon-skills-preview">\n        <div class="skill-preview">\n          <span class="skill-name">${this.palmon.skills.skill1.name}</span>\n        </div>\n        <div class="skill-preview">\n          <span class="skill-name">${this.palmon.skills.skill2.name}</span>\n        </div>\n        ${this.palmon.skills.passive?`\n          <div class="skill-preview passive">\n            <span class="skill-name">${this.palmon.skills.passive.name}</span>\n          </div>\n        `:""}\n      </div>\n    `}getElementIcon(e){return{Fire:"🔥",Water:"💧",Earth:"🌱",Electric:"⚡"}[e]||"❓"}attachEventListeners(e){e.addEventListener("mouseenter",()=>{e.classList.add("palmon-card-hover")}),e.addEventListener("mouseleave",()=>{e.classList.remove("palmon-card-hover")}),e.addEventListener("click",e=>{e.target.closest(".palmon-card-actions")||this.showDetailModal()});const t=e.querySelector(".palmon-details-btn");t&&t.addEventListener("click",e=>{e.stopPropagation(),this.showDetailModal()});const n=e.querySelector(".palmon-add-btn");n&&n.addEventListener("click",e=>{e.stopPropagation(),this.addToTeam()});const i=e.querySelector(".palmon-compare-btn");i&&i.addEventListener("click",e=>{e.stopPropagation(),this.addToComparison()})}showDetailModal(){new PalmonDetailModal(this.palmon).show()}addToTeam(){const e=new CustomEvent("palmon-add-to-team",{detail:{palmon:this.palmon}});document.dispatchEvent(e);const t=window.palmonApp;t&&t.showNotification(`${this.palmon.name} added to team!`,"success")}addToComparison(){PalmonComparisonManager.getInstance().addPalmon(this.palmon);const e=window.palmonApp;e&&e.showNotification(`${this.palmon.name} added to comparison!`,"success")}}class TierGridSystem{constructor(e,t){this.palmonData=e,this.container=t,this.tiers=["S","A","B","C","Economy"],this.draggedElement=null,this.draggedPalmon=null,this.currentFilters={element:"all",role:"all",tier:"all",search:""},this.currentSort="name",this.filteredData=[...e]}render(){this.container.innerHTML=this.generateTierGridHTML(),this.initializeFilterControls(),this.applyFiltersAndSort(),this.populateTierGrids(),this.initializeDragAndDrop()}generateTierGridHTML(){let e='<div class="tier-grid-system">';return e+='\n      <div class="tier-grid-controls">\n        <div class="tier-grid-header">\n          <h2 class="tier-grid-title">Interactive Tier List</h2>\n          <p class="tier-grid-subtitle">Drag and drop Palmon to reorganize tiers</p>\n        </div>\n        <div class="tier-grid-actions">\n          <button class="btn btn-secondary" id="reset-tiers">\n            <span class="btn-icon">🔄</span>\n            Reset Tiers\n          </button>\n          <button class="btn btn-primary" id="save-tiers">\n            <span class="btn-icon">💾</span>\n            Save Changes\n          </button>\n        </div>\n      </div>\n    ',e+=this.generateFilterControlsHTML(),this.tiers.forEach(t=>{const n="economy"===t.toLowerCase()?"economy":t.toLowerCase();e+=`\n        <div class="tier-row" data-tier="${t}">\n          <div class="tier-label">\n            <div class="tier-label-content">\n              <span class="badge badge-tier-${n} tier-badge-large">\n                ${t}\n              </span>\n              <div class="tier-info">\n                <span class="tier-name">${this.getTierName(t)}</span>\n                <span class="tier-description">${this.getTierDescription(t)}</span>\n              </div>\n            </div>\n          </div>\n          <div class="tier-drop-zone" data-tier="${t}">\n            <div class="tier-palmon-container" id="tier-container-${t.toLowerCase()}">\n              <div class="tier-empty-message">\n                <span class="empty-icon">📦</span>\n                <span class="empty-text">Drop Palmon here</span>\n              </div>\n            </div>\n          </div>\n        </div>\n      `}),e+="</div>",e}generateFilterControlsHTML(){return`\n      <div class="tier-filter-panel">\n        <div class="filter-section">\n          <h3 class="filter-title">\n            <span class="filter-icon">🔍</span>\n            Filters & Search\n          </h3>\n          \n          <div class="filter-controls">\n            \x3c!-- Search Input --\x3e\n            <div class="filter-group">\n              <label class="filter-label">Search Palmon</label>\n              <div class="search-input-container">\n                <input type="text" \n                       class="filter-search-input" \n                       id="tier-search" \n                       placeholder="Search by name..."\n                       value="${this.currentFilters.search}">\n                <button class="search-clear-btn" id="clear-search" title="Clear search">\n                  <span class="btn-icon">✕</span>\n                </button>\n              </div>\n            </div>\n\n            \x3c!-- Element Filter --\x3e\n            <div class="filter-group">\n              <label class="filter-label">Element</label>\n              <select class="filter-select" id="element-filter">\n                <option value="all" ${"all"===this.currentFilters.element?"selected":""}>All Elements</option>\n                <option value="fire" ${"fire"===this.currentFilters.element?"selected":""}>🔥 Fire</option>\n                <option value="water" ${"water"===this.currentFilters.element?"selected":""}>💧 Water</option>\n                <option value="earth" ${"earth"===this.currentFilters.element?"selected":""}>🌱 Earth</option>\n                <option value="electric" ${"electric"===this.currentFilters.element?"selected":""}>⚡ Electric</option>\n              </select>\n            </div>\n\n            \x3c!-- Role Filter --\x3e\n            <div class="filter-group">\n              <label class="filter-label">Role</label>\n              <select class="filter-select" id="role-filter">\n                <option value="all" ${"all"===this.currentFilters.role?"selected":""}>All Roles</option>\n                <option value="tank" ${"tank"===this.currentFilters.role?"selected":""}>🛡️ Tank</option>\n                <option value="dps" ${"dps"===this.currentFilters.role?"selected":""}>⚔️ DPS</option>\n                <option value="support" ${"support"===this.currentFilters.role?"selected":""}>💚 Support</option>\n                <option value="control" ${"control"===this.currentFilters.role?"selected":""}>🎯 Control</option>\n              </select>\n            </div>\n\n            \x3c!-- Tier Filter --\x3e\n            <div class="filter-group">\n              <label class="filter-label">Show Tiers</label>\n              <select class="filter-select" id="tier-filter">\n                <option value="all" ${"all"===this.currentFilters.tier?"selected":""}>All Tiers</option>\n                <option value="s" ${"s"===this.currentFilters.tier?"selected":""}>S-Tier Only</option>\n                <option value="a" ${"a"===this.currentFilters.tier?"selected":""}>A-Tier Only</option>\n                <option value="b" ${"b"===this.currentFilters.tier?"selected":""}>B-Tier Only</option>\n                <option value="c" ${"c"===this.currentFilters.tier?"selected":""}>C-Tier Only</option>\n                <option value="economy" ${"economy"===this.currentFilters.tier?"selected":""}>Economy Only</option>\n              </select>\n            </div>\n\n            \x3c!-- Sort Options --\x3e\n            <div class="filter-group">\n              <label class="filter-label">Sort By</label>\n              <select class="filter-select" id="sort-select">\n                <option value="name" ${"name"===this.currentSort?"selected":""}>Name (A-Z)</option>\n                <option value="name-desc" ${"name-desc"===this.currentSort?"selected":""}>Name (Z-A)</option>\n                <option value="tier" ${"tier"===this.currentSort?"selected":""}>Tier (S-Economy)</option>\n                <option value="tier-desc" ${"tier-desc"===this.currentSort?"selected":""}>Tier (Economy-S)</option>\n                <option value="element" ${"element"===this.currentSort?"selected":""}>Element</option>\n                <option value="role" ${"role"===this.currentSort?"selected":""}>Role</option>\n              </select>\n            </div>\n\n            \x3c!-- Filter Actions --\x3e\n            <div class="filter-actions">\n              <button class="btn btn-ghost btn-sm" id="clear-filters">\n                <span class="btn-icon">🗑️</span>\n                Clear All\n              </button>\n              <button class="btn btn-secondary btn-sm" id="toggle-filters">\n                <span class="btn-icon">📊</span>\n                <span class="toggle-text">Hide Filters</span>\n              </button>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Filter Results Summary --\x3e\n        <div class="filter-results">\n          <div class="results-summary" id="filter-results-summary">\n            Showing <span class="results-count" id="results-count">${this.filteredData.length}</span> \n            of <span class="total-count">${this.palmonData.length}</span> Palmon\n          </div>\n          <div class="active-filters" id="active-filters"></div>\n        </div>\n      </div>\n    `}getTierName(e){return{S:"Supreme",A:"Excellent",B:"Good",C:"Average",Economy:"Budget"}[e]||e}getTierDescription(e){return{S:"Meta-defining powerhouses",A:"Strong competitive choices",B:"Solid and reliable",C:"Situational picks",Economy:"Early game focused"}[e]||""}populateTierGrids(){this.tiers.forEach(e=>{const t=this.filteredData.filter(t=>t.tier===e),n=document.getElementById(`tier-container-${e.toLowerCase()}`),i=document.querySelector(`.tier-row[data-tier="${e}"]`);n&&(n.innerHTML="",t.length>0?(i&&(i.style.display="flex"),t.forEach(e=>{const t=new PalmonCard(e,{compact:!0,showDetails:!1,clickable:!0,draggable:!0}).createElement();t.draggable=!0,n.appendChild(t)})):i&&(this.hasActiveFilters()?i.style.display="none":(i.style.display="flex",n.innerHTML='\n                <div class="tier-empty-message">\n                  <span class="empty-icon">📦</span>\n                  <span class="empty-text">Drop Palmon here</span>\n                </div>\n              ')))}),this.initializeControls()}initializeControls(){const e=document.getElementById("reset-tiers"),t=document.getElementById("save-tiers");e&&e.addEventListener("click",()=>{this.resetTiers()}),t&&t.addEventListener("click",()=>{this.saveTiers()})}initializeDragAndDrop(){this.container.querySelectorAll(".palmon-card").forEach(e=>{this.addDragListeners(e)});this.container.querySelectorAll(".tier-drop-zone").forEach(e=>{this.addDropListeners(e)})}addDragListeners(e){e.addEventListener("dragstart",t=>{this.draggedElement=e,this.draggedPalmon=this.getPalmonFromCard(e),e.classList.add("dragging"),t.dataTransfer.setData("text/plain",e.dataset.palmonId),t.dataTransfer.effectAllowed="move",setTimeout(()=>{e.style.opacity="0.5"},0)}),e.addEventListener("dragend",t=>{e.classList.remove("dragging"),e.style.opacity="1",this.draggedElement=null,this.draggedPalmon=null,this.container.querySelectorAll(".tier-drop-zone").forEach(e=>{e.classList.remove("drag-over")})})}addDropListeners(e){e.addEventListener("dragover",t=>{t.preventDefault(),t.dataTransfer.dropEffect="move",e.classList.add("drag-over")}),e.addEventListener("dragleave",t=>{e.contains(t.relatedTarget)||e.classList.remove("drag-over")}),e.addEventListener("drop",t=>{if(t.preventDefault(),e.classList.remove("drag-over"),this.draggedElement&&this.draggedPalmon){const t=e.dataset.tier,n=this.draggedPalmon.tier;t!==n&&this.movePalmonToTier(this.draggedElement,this.draggedPalmon,t,n)}})}movePalmonToTier(e,t,n,i){t.tier=n,e.dataset.tier=n.toLowerCase();const a=document.getElementById(`tier-container-${n.toLowerCase()}`),s=e.parentElement;if(a){const o=a.querySelector(".tier-empty-message");if(o&&(o.style.display="none"),a.appendChild(e),s&&1===s.children.length){const e=s.querySelector(".tier-empty-message");e&&(e.style.display="flex")}const r=new CustomEvent("palmon-tier-changed",{detail:{palmon:t,oldTier:i,newTier:n}});document.dispatchEvent(r),e.classList.add("tier-changed"),setTimeout(()=>{e.classList.remove("tier-changed")},1e3)}}getPalmonFromCard(e){const t=e.dataset.palmonId;return this.palmonData.find(e=>e.id===t)}resetTiers(){const e=window.palmonApp;e&&e.showNotification&&e.showNotification("Tier reset functionality will be implemented with data persistence","info")}saveTiers(){const e={};this.tiers.forEach(t=>{const n=document.getElementById(`tier-container-${t.toLowerCase()}`).querySelectorAll(".palmon-card");e[t]=Array.from(n).map(e=>e.dataset.palmonId)}),localStorage.setItem("palmon-tier-data",JSON.stringify(e));const t=window.palmonApp;t&&t.showNotification&&t.showNotification("Tier configuration saved successfully!","success")}initializeFilterControls(){const e=document.getElementById("tier-search");e&&e.addEventListener("input",e=>{this.currentFilters.search=e.target.value.toLowerCase(),this.applyFiltersAndSort(),this.populateTierGrids(),this.initializeDragAndDrop()});const t=document.getElementById("clear-search");t&&t.addEventListener("click",()=>{e.value="",this.currentFilters.search="",this.applyFiltersAndSort(),this.populateTierGrids(),this.initializeDragAndDrop()});const n=document.getElementById("element-filter"),i=document.getElementById("role-filter"),a=document.getElementById("tier-filter"),s=document.getElementById("sort-select");n&&n.addEventListener("change",e=>{this.currentFilters.element=e.target.value,this.applyFiltersAndSort(),this.populateTierGrids(),this.initializeDragAndDrop()}),i&&i.addEventListener("change",e=>{this.currentFilters.role=e.target.value,this.applyFiltersAndSort(),this.populateTierGrids(),this.initializeDragAndDrop()}),a&&a.addEventListener("change",e=>{this.currentFilters.tier=e.target.value,this.applyFiltersAndSort(),this.populateTierGrids(),this.initializeDragAndDrop()}),s&&s.addEventListener("change",e=>{this.currentSort=e.target.value,this.applyFiltersAndSort(),this.populateTierGrids(),this.initializeDragAndDrop()});const o=document.getElementById("clear-filters");o&&o.addEventListener("click",()=>{this.clearAllFilters()});const r=document.getElementById("toggle-filters");r&&r.addEventListener("click",()=>{this.toggleFilterPanel()})}applyFiltersAndSort(){let e=[...this.palmonData];this.currentFilters.search&&(e=e.filter(e=>e.name.toLowerCase().includes(this.currentFilters.search))),"all"!==this.currentFilters.element&&(e=e.filter(e=>e.element.toLowerCase()===this.currentFilters.element)),"all"!==this.currentFilters.role&&(e=e.filter(e=>e.role.toLowerCase()===this.currentFilters.role)),"all"!==this.currentFilters.tier&&(e=e.filter(e=>e.tier.toLowerCase()===this.currentFilters.tier)),e=this.sortPalmonData(e),this.filteredData=e,this.updateFilterResults(),this.updateActiveFilters()}sortPalmonData(e){const t={S:0,A:1,B:2,C:3,Economy:4};return e.sort((e,n)=>{switch(this.currentSort){case"name":return e.name.localeCompare(n.name);case"name-desc":return n.name.localeCompare(e.name);case"tier":return t[e.tier]-t[n.tier];case"tier-desc":return t[n.tier]-t[e.tier];case"element":return e.element.localeCompare(n.element);case"role":return e.role.localeCompare(n.role);default:return 0}})}updateFilterResults(){const e=document.getElementById("results-count");e&&(e.textContent=this.filteredData.length)}updateActiveFilters(){const e=document.getElementById("active-filters");if(!e)return;const t=[];if(this.currentFilters.search&&t.push({type:"search",label:`Search: "${this.currentFilters.search}"`,value:this.currentFilters.search}),"all"!==this.currentFilters.element){const e={fire:"🔥",water:"💧",earth:"🌱",electric:"⚡"};t.push({type:"element",label:`${e[this.currentFilters.element]} ${this.currentFilters.element.charAt(0).toUpperCase()+this.currentFilters.element.slice(1)}`,value:this.currentFilters.element})}if("all"!==this.currentFilters.role){const e={tank:"🛡️",dps:"⚔️",support:"💚",control:"🎯"};t.push({type:"role",label:`${e[this.currentFilters.role]} ${this.currentFilters.role.toUpperCase()}`,value:this.currentFilters.role})}if("all"!==this.currentFilters.tier&&t.push({type:"tier",label:`${this.currentFilters.tier.toUpperCase()}-Tier`,value:this.currentFilters.tier}),0===t.length)return void(e.innerHTML="");const n=t.map(e=>`\n      <div class="active-filter-tag" data-type="${e.type}" data-value="${e.value}">\n        <span class="filter-tag-label">${e.label}</span>\n        <button class="filter-tag-remove" title="Remove filter">✕</button>\n      </div>\n    `).join("");e.innerHTML=`\n      <div class="active-filters-header">Active Filters:</div>\n      <div class="active-filters-list">${n}</div>\n    `,e.querySelectorAll(".filter-tag-remove").forEach(e=>{e.addEventListener("click",e=>{const t=e.target.closest(".active-filter-tag").dataset.type;this.removeFilter(t)})})}removeFilter(e){switch(e){case"search":this.currentFilters.search="";const e=document.getElementById("tier-search");e&&(e.value="");break;case"element":this.currentFilters.element="all";const t=document.getElementById("element-filter");t&&(t.value="all");break;case"role":this.currentFilters.role="all";const n=document.getElementById("role-filter");n&&(n.value="all");break;case"tier":this.currentFilters.tier="all";const i=document.getElementById("tier-filter");i&&(i.value="all")}this.applyFiltersAndSort(),this.populateTierGrids(),this.initializeDragAndDrop()}clearAllFilters(){this.currentFilters={element:"all",role:"all",tier:"all",search:""};const e=document.getElementById("tier-search"),t=document.getElementById("element-filter"),n=document.getElementById("role-filter"),i=document.getElementById("tier-filter");e&&(e.value=""),t&&(t.value="all"),n&&(n.value="all"),i&&(i.value="all"),this.applyFiltersAndSort(),this.populateTierGrids(),this.initializeDragAndDrop()}toggleFilterPanel(){const e=document.querySelector(".tier-filter-panel"),t=document.getElementById("toggle-filters").querySelector(".toggle-text");e.classList.contains("collapsed")?(e.classList.remove("collapsed"),t.textContent="Hide Filters"):(e.classList.add("collapsed"),t.textContent="Show Filters")}hasActiveFilters(){return""!==this.currentFilters.search||"all"!==this.currentFilters.element||"all"!==this.currentFilters.role||"all"!==this.currentFilters.tier}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.palmonApp=new PalmonApp}):window.palmonApp=new PalmonApp;class TeamBuilder{constructor(e){this.palmonData=e,this.currentTeam={frontRow:[null,null,null],backRow:[null,null,null]},this.draggedPalmon=null,this.dragPreview=null,this.init()}init(){this.setupTeamSlots(),this.setupTeamActions(),this.setupDragAndDrop(),this.populateTemporaryLibrary()}setupTeamSlots(){document.querySelectorAll(".team-slot").forEach(e=>{e.addEventListener("dragover",e=>this.handleDragOver(e)),e.addEventListener("dragenter",e=>this.handleDragEnter(e)),e.addEventListener("dragleave",e=>this.handleDragLeave(e)),e.addEventListener("drop",e=>this.handleDrop(e));const t=e.querySelector(".slot-clear");t&&t.addEventListener("click",t=>{t.stopPropagation(),this.clearSlot(e)})})}setupTeamActions(){const e=document.getElementById("clear-team"),t=document.getElementById("random-team");e&&e.addEventListener("click",()=>this.clearTeam()),t&&t.addEventListener("click",()=>this.generateRandomTeam())}setupDragAndDrop(){document.addEventListener("dragstart",e=>this.handleDragStart(e)),document.addEventListener("dragend",e=>this.handleDragEnd(e))}handleDragStart(e){const t=e.target.closest(".palmon-card");if(!t)return;const n=t.dataset.palmonId,i=this.palmonData.find(e=>e.id===n);i&&(this.draggedPalmon=i,this.createDragPreview(i,e.clientX,e.clientY),t.classList.add("dragging"),e.dataTransfer.setData("text/plain",n),e.dataTransfer.effectAllowed="move")}handleDragEnd(e){const t=e.target.closest(".palmon-card");t&&t.classList.remove("dragging"),this.dragPreview&&(this.dragPreview.remove(),this.dragPreview=null),document.querySelectorAll(".team-slot.drag-over").forEach(e=>{e.classList.remove("drag-over")}),this.draggedPalmon=null}handleDragOver(e){this.draggedPalmon&&(e.preventDefault(),e.dataTransfer.dropEffect="move",this.dragPreview&&(this.dragPreview.style.left=e.clientX+"px",this.dragPreview.style.top=e.clientY+"px"))}handleDragEnter(e){if(!this.draggedPalmon)return;e.preventDefault();e.currentTarget.classList.add("drag-over")}handleDragLeave(e){if(!this.draggedPalmon)return;const t=e.currentTarget;t.contains(e.relatedTarget)||t.classList.remove("drag-over")}handleDrop(e){if(!this.draggedPalmon)return;e.preventDefault();const t=e.currentTarget;t.classList.remove("drag-over");const n=t.dataset.slot,i=t.dataset.row;this.addPalmonToSlot(this.draggedPalmon,t,i,n)}createDragPreview(e,t,n){this.dragPreview=document.createElement("div"),this.dragPreview.className="drag-preview",this.dragPreview.style.left=t+"px",this.dragPreview.style.top=n+"px";const i=this.createMiniPalmonCard(e);this.dragPreview.appendChild(i),document.body.appendChild(this.dragPreview)}addPalmonToSlot(e,t,n,i){if(this.isPalmonInTeam(e))return void this.showNotification("This Palmon is already in your team!","warning");const a=parseInt(i.split("-")[1])-1;"front"===n?this.currentTeam.frontRow[a]=e:this.currentTeam.backRow[a]=e,this.updateSlotVisual(t,e),this.showNotification(`${e.name} added to ${n} row!`,"success"),this.updateTeamAnalysis()}updateSlotVisual(e,t){const n=e.querySelector(".slot-content"),i=e.querySelector(".slot-clear");n.innerHTML="";const a=this.createMiniPalmonCard(t);n.appendChild(a),i&&(i.style.display="flex"),e.classList.add("occupied")}createMiniPalmonCard(e){const t=document.createElement("div"),n=e.element.toLowerCase(),i=e.tier.toLowerCase();return t.className=`palmon-card-mini element-${n} tier-${i}`,t.innerHTML=`\n      <div class="palmon-portrait-mini">\n        <span class="palmon-element-icon">${this.getElementIcon(e.element)}</span>\n      </div>\n      <div class="palmon-name-mini">${e.name}</div>\n      <div class="palmon-tier-mini">${e.tier}</div>\n      <div class="palmon-element-mini">${this.getElementIcon(e.element)}</div>\n    `,t}getElementIcon(e){return{Fire:"🔥",Water:"💧",Earth:"🌱",Electric:"⚡"}[e]||"❓"}clearSlot(e){const t=e.dataset.slot,n=e.dataset.row,i=parseInt(t.split("-")[1])-1;"front"===n?this.currentTeam.frontRow[i]=null:this.currentTeam.backRow[i]=null,this.resetSlotVisual(e),this.updateTeamAnalysis()}resetSlotVisual(e){const t=e.querySelector(".slot-content"),n=e.querySelector(".slot-clear"),i=e.dataset.row;t.innerHTML=`\n      <div class="slot-placeholder">\n        <span class="slot-icon">${"front"===i?"⚔️":"🛡️"}</span>\n        <span class="slot-text">Drop Palmon Here</span>\n      </div>\n    `,n&&(n.style.display="none"),e.classList.remove("occupied")}clearTeam(){this.currentTeam={frontRow:[null,null,null],backRow:[null,null,null]},document.querySelectorAll(".team-slot").forEach(e=>{this.resetSlotVisual(e)}),this.updateTeamAnalysis(),this.showNotification("Team cleared!","info")}generateRandomTeam(){if(!this.palmonData||0===this.palmonData.length)return void this.showNotification("No Palmon data available!","error");this.clearTeam();const e=[...this.palmonData];document.querySelectorAll(".team-slot").forEach(t=>{if(0===e.length)return;const n=Math.floor(Math.random()*e.length),i=e.splice(n,1)[0],a=t.dataset.row,s=t.dataset.slot;this.addPalmonToSlot(i,t,a,s)}),this.showNotification("Random team generated!","success")}isPalmonInTeam(e){return[...this.currentTeam.frontRow,...this.currentTeam.backRow].some(t=>t&&t.id===e.id)}updateTeamAnalysis(){console.log("Team updated:",this.currentTeam)}showNotification(e,t="info"){const n=document.createElement("div");n.className=`notification notification-${t}`,n.textContent=e,document.body.appendChild(n),setTimeout(()=>{n.classList.add("show")},100),setTimeout(()=>{n.classList.remove("show"),setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},300)},3e3)}getTeamData(){return this.currentTeam}setTeamData(e){this.currentTeam=e,this.renderTeam()}renderTeam(){document.querySelectorAll(".team-slot").forEach(e=>{const t=e.dataset.row,n=e.dataset.slot,i=parseInt(n.split("-")[1])-1,a="front"===t?this.currentTeam.frontRow[i]:this.currentTeam.backRow[i];a?this.updateSlotVisual(e,a):this.resetSlotVisual(e)}),this.updateTeamAnalysis()}populateTemporaryLibrary(){const e=document.getElementById("temp-palmon-library");if(!e||!this.palmonData)return;const t=this.palmonData.slice(0,12);e.innerHTML="",t.forEach(t=>{const n=new PalmonCard(t,{compact:!0,showDetails:!1,draggable:!0}).createElement();e.appendChild(n)})}}PalmonApp.prototype.initializeTeamBuilder=function(){this.processedPalmonData&&(this.teamBuilder=new TeamBuilder(this.processedPalmonData))};const originalInitializeComponents=PalmonApp.prototype.initializeComponents;PalmonApp.prototype.initializeComponents=function(){originalInitializeComponents.call(this),this.initializeTeamBuilder()};class MetaAnalyzer{constructor(e){this.palmonData=e||[],this.historicalData=this.generateHistoricalData(),this.usageStats=this.calculateUsageStats(),this.winRates=this.generateWinRates(),this.metaTrends=this.calculateMetaTrends()}generateHistoricalData(){const e=["Jan","Feb","Mar","Apr","May","Jun"],t=["S","A","B","C","Economy"],n=["Fire","Water","Earth","Electric"];return{tierDistribution:e.map(e=>({month:e,data:t.reduce((e,t)=>(e[t]=Math.floor(20*Math.random())+5,e),{})})),elementUsage:e.map(e=>({month:e,data:n.reduce((e,t)=>(e[t]=Math.floor(30*Math.random())+15,e),{})})),popularityTrends:this.palmonData.slice(0,10).map(t=>({name:t.name,data:e.map(()=>Math.floor(100*Math.random())+20)}))}}calculateUsageStats(){if(!this.palmonData.length)return{};const e={totalPalmon:this.palmonData.length,tierDistribution:{},elementDistribution:{},roleDistribution:{},mostUsed:[],leastUsed:[]};this.palmonData.forEach(t=>{e.tierDistribution[t.tier]=(e.tierDistribution[t.tier]||0)+1,e.elementDistribution[t.element]=(e.elementDistribution[t.element]||0)+1,e.roleDistribution[t.role]=(e.roleDistribution[t.role]||0)+1});const t=this.palmonData.map(e=>({...e,usageRate:this.calculateSimulatedUsage(e)}));return e.mostUsed=t.sort((e,t)=>t.usageRate-e.usageRate).slice(0,10),e.leastUsed=t.sort((e,t)=>e.usageRate-t.usageRate).slice(0,10),e}calculateSimulatedUsage(e){const t=100*({S:.8,A:.6,B:.4,C:.2,Economy:.1}[e.tier]||.3),n=20*(Math.random()-.5);return Math.max(5,Math.min(95,t+n))}generateWinRates(){return this.palmonData.map(e=>({...e,winRate:this.calculateSimulatedWinRate(e),pickRate:this.calculateSimulatedUsage(e),banRate:30*Math.random(),synergies:this.calculateSynergyScore(e)}))}calculateSimulatedWinRate(e){const t=100*({S:.65,A:.58,B:.52,C:.48,Economy:.42}[e.tier]||.5),n=10*(Math.random()-.5);return Math.max(35,Math.min(75,t+n))}calculateSynergyScore(e){const t=this.palmonData.filter(t=>t.element===e.element).length,n=this.palmonData.filter(t=>t.role===e.role).length;return Math.min(100,5*t+3*n+20*Math.random())}calculateMetaTrends(){(new Date).getMonth();const e={rising:[],falling:[],stable:[],emerging:[]};return this.palmonData.forEach(t=>{const n=20*(Math.random()-.5),i=n>5?"rising":n<-5?"falling":"stable";"C"===t.tier&&n>8?e.emerging.push({...t,trend:n}):e[i].push({...t,trend:n})}),Object.keys(e).forEach(t=>{e[t]=e[t].sort((e,t)=>Math.abs(t.trend)-Math.abs(e.trend)).slice(0,8)}),e}renderMetaDashboard(){const e=document.getElementById("meta-analysis-container");e&&(e.innerHTML=`\n      <div class="meta-dashboard">\n        \x3c!-- Dashboard Header --\x3e\n        <div class="dashboard-header">\n          <div class="dashboard-title-section">\n            <h2 class="dashboard-title">Meta Analysis Dashboard</h2>\n            <p class="dashboard-subtitle">Comprehensive statistics and trends for Palmon: Survival Min|Max</p>\n          </div>\n          <div class="dashboard-controls">\n            <select class="form-select" id="time-period-select">\n              <option value="current">Current Meta</option>\n              <option value="1month">Last Month</option>\n              <option value="3months">Last 3 Months</option>\n              <option value="6months">Last 6 Months</option>\n            </select>\n            <button class="btn btn-secondary" id="refresh-data">\n              <span class="btn-icon">🔄</span>\n              Refresh Data\n            </button>\n          </div>\n        </div>\n\n        \x3c!-- Key Metrics Cards --\x3e\n        <div class="metrics-grid">\n          ${this.renderMetricsCards()}\n        </div>\n\n        \x3c!-- Charts Section --\x3e\n        <div class="charts-section">\n          <div class="charts-grid">\n            \x3c!-- Tier Distribution Chart --\x3e\n            <div class="chart-container">\n              <div class="chart-header">\n                <h3 class="chart-title">Tier Distribution</h3>\n                <span class="chart-subtitle">Current meta breakdown</span>\n              </div>\n              <div class="chart-content">\n                ${this.renderTierDistributionChart()}\n              </div>\n            </div>\n\n            \x3c!-- Element Usage Chart --\x3e\n            <div class="chart-container">\n              <div class="chart-header">\n                <h3 class="chart-title">Element Usage</h3>\n                <span class="chart-subtitle">Popularity by element type</span>\n              </div>\n              <div class="chart-content">\n                ${this.renderElementUsageChart()}\n              </div>\n            </div>\n\n            \x3c!-- Win Rate vs Pick Rate --\x3e\n            <div class="chart-container chart-wide">\n              <div class="chart-header">\n                <h3 class="chart-title">Win Rate vs Pick Rate</h3>\n                <span class="chart-subtitle">Performance correlation analysis</span>\n              </div>\n              <div class="chart-content">\n                ${this.renderWinRateChart()}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Trends Section --\x3e\n        <div class="trends-section">\n          <div class="trends-grid">\n            \x3c!-- Rising Stars --\x3e\n            <div class="trend-category">\n              <div class="trend-header">\n                <h3 class="trend-title">\n                  <span class="trend-icon rising">📈</span>\n                  Rising Stars\n                </h3>\n                <span class="trend-count">${this.metaTrends.rising.length} Palmon</span>\n              </div>\n              <div class="trend-list">\n                ${this.renderTrendList(this.metaTrends.rising,"rising")}\n              </div>\n            </div>\n\n            \x3c!-- Falling --\x3e\n            <div class="trend-category">\n              <div class="trend-header">\n                <h3 class="trend-title">\n                  <span class="trend-icon falling">📉</span>\n                  Declining\n                </h3>\n                <span class="trend-count">${this.metaTrends.falling.length} Palmon</span>\n              </div>\n              <div class="trend-list">\n                ${this.renderTrendList(this.metaTrends.falling,"falling")}\n              </div>\n            </div>\n\n            \x3c!-- Emerging --\x3e\n            <div class="trend-category">\n              <div class="trend-header">\n                <h3 class="trend-title">\n                  <span class="trend-icon emerging">⭐</span>\n                  Emerging Picks\n                </h3>\n                <span class="trend-count">${this.metaTrends.emerging.length} Palmon</span>\n              </div>\n              <div class="trend-list">\n                ${this.renderTrendList(this.metaTrends.emerging,"emerging")}\n              </div>\n            </div>\n\n            \x3c!-- Stable --\x3e\n            <div class="trend-category">\n              <div class="trend-header">\n                <h3 class="trend-title">\n                  <span class="trend-icon stable">➡️</span>\n                  Meta Stable\n                </h3>\n                <span class="trend-count">${this.metaTrends.stable.length} Palmon</span>\n              </div>\n              <div class="trend-list">\n                ${this.renderTrendList(this.metaTrends.stable,"stable")}\n              </div>\n            </div>\n          </div>\n        </div>\n\n        \x3c!-- Top Performers Table --\x3e\n        <div class="performers-section">\n          <div class="performers-header">\n            <h3 class="performers-title">Top Performers</h3>\n            <div class="performers-tabs">\n              <button class="tab-btn active" data-tab="winrate">Win Rate</button>\n              <button class="tab-btn" data-tab="pickrate">Pick Rate</button>\n              <button class="tab-btn" data-tab="synergy">Synergy Score</button>\n            </div>\n          </div>\n          <div class="performers-content">\n            ${this.renderPerformersTable()}\n          </div>\n        </div>\n\n        \x3c!-- Historical Trends --\x3e\n        <div class="historical-section">\n          <div class="historical-header">\n            <h3 class="historical-title">Historical Trends</h3>\n            <p class="historical-subtitle">Meta evolution over the past 6 months</p>\n          </div>\n          <div class="historical-content">\n            ${this.renderHistoricalChart()}\n          </div>\n        </div>\n      </div>\n    `,this.attachMetaDashboardEvents())}renderMetricsCards(){const e=this.usageStats,t=e.totalPalmon||0,n=e.tierDistribution.S||0,i=Object.entries(e.elementDistribution).sort(([,e],[,t])=>t-e)[0]?.[0]||"Unknown",a=this.winRates.reduce((e,t)=>e+t.winRate,0)/this.winRates.length||0;return`\n      <div class="metric-card">\n        <div class="metric-icon">📊</div>\n        <div class="metric-content">\n          <div class="metric-value">${t}</div>\n          <div class="metric-label">Total Palmon</div>\n        </div>\n      </div>\n      <div class="metric-card">\n        <div class="metric-icon">⭐</div>\n        <div class="metric-content">\n          <div class="metric-value">${n}</div>\n          <div class="metric-label">S-Tier Palmon</div>\n        </div>\n      </div>\n      <div class="metric-card">\n        <div class="metric-icon">${this.getElementIcon(i)}</div>\n        <div class="metric-content">\n          <div class="metric-value">${i}</div>\n          <div class="metric-label">Top Element</div>\n        </div>\n      </div>\n      <div class="metric-card">\n        <div class="metric-icon">🏆</div>\n        <div class="metric-content">\n          <div class="metric-value">${a.toFixed(1)}%</div>\n          <div class="metric-label">Avg Win Rate</div>\n        </div>\n      </div>\n    `}renderTierDistributionChart(){const e=this.usageStats.tierDistribution,t=Object.values(e).reduce((e,t)=>e+t,0);return`\n      <div class="pie-chart">\n        ${Object.entries(e).map(([e,n])=>{const i=(n/t*100).toFixed(1);return`\n            <div class="pie-segment" data-tier="${e}">\n              <div class="segment-bar">\n                <div class="segment-fill tier-${e.toLowerCase()}" style="width: ${i}%"></div>\n              </div>\n              <div class="segment-info">\n                <span class="segment-label">${e}-Tier</span>\n                <span class="segment-value">${n} (${i}%)</span>\n              </div>\n            </div>\n          `}).join("")}\n      </div>\n    `}renderElementUsageChart(){const e=this.usageStats.elementDistribution,t=Object.values(e).reduce((e,t)=>e+t,0);return`\n      <div class="bar-chart">\n        ${Object.entries(e).map(([e,n])=>{const i=(n/t*100).toFixed(1);return`\n            <div class="bar-item">\n              <div class="bar-label">\n                <span class="element-icon">${this.getElementIcon(e)}</span>\n                <span class="element-name">${e}</span>\n              </div>\n              <div class="bar-container">\n                <div class="bar-fill element-${e.toLowerCase()}" style="width: ${i}%"></div>\n                <span class="bar-value">${n}</span>\n              </div>\n            </div>\n          `}).join("")}\n      </div>\n    `}renderWinRateChart(){return`\n      <div class="scatter-chart">\n        <div class="chart-grid">\n          ${this.winRates.sort((e,t)=>t.winRate-e.winRate).slice(0,15).map(e=>`\n            <div class="scatter-point" \n                 style="left: ${e.pickRate}%; bottom: ${e.winRate}%"\n                 data-palmon="${e.name}"\n                 title="${e.name}: ${e.winRate.toFixed(1)}% WR, ${e.pickRate.toFixed(1)}% PR">\n              <div class="point-dot tier-${e.tier.toLowerCase()}"></div>\n              <div class="point-label">${e.name}</div>\n            </div>\n          `).join("")}\n        </div>\n        <div class="chart-axes">\n          <div class="x-axis">\n            <span class="axis-label">Pick Rate (%)</span>\n          </div>\n          <div class="y-axis">\n            <span class="axis-label">Win Rate (%)</span>\n          </div>\n        </div>\n      </div>\n    `}renderTrendList(e,t){return e.length?e.map(e=>`\n      <div class="trend-item" data-palmon="${e.name}">\n        <div class="trend-palmon-info">\n          <div class="trend-palmon-name">${e.name}</div>\n          <div class="trend-palmon-meta">\n            <span class="badge badge-tier-${e.tier.toLowerCase()}">${e.tier}</span>\n            <span class="badge badge-${e.element.toLowerCase()}">${e.element}</span>\n          </div>\n        </div>\n        <div class="trend-value ${t}">\n          ${"rising"===t?"+":""}${e.trend.toFixed(1)}%\n        </div>\n      </div>\n    `).join(""):'<div class="trend-empty">No significant trends detected</div>'}renderPerformersTable(){return`\n      <div class="performers-table" id="performers-table">\n        <div class="table-header">\n          <div class="table-row header-row">\n            <div class="table-cell rank-cell">Rank</div>\n            <div class="table-cell palmon-cell">Palmon</div>\n            <div class="table-cell tier-cell">Tier</div>\n            <div class="table-cell stat-cell">Win Rate</div>\n            <div class="table-cell stat-cell">Pick Rate</div>\n            <div class="table-cell stat-cell">Synergy</div>\n          </div>\n        </div>\n        <div class="table-body">\n          ${[...this.winRates].sort((e,t)=>t.winRate-e.winRate).slice(0,10).map((e,t)=>`\n            <div class="table-row" data-palmon="${e.name}">\n              <div class="table-cell rank-cell">\n                <span class="rank-number">#${t+1}</span>\n              </div>\n              <div class="table-cell palmon-cell">\n                <div class="palmon-info">\n                  <span class="palmon-name">${e.name}</span>\n                  <span class="palmon-element">${this.getElementIcon(e.element)} ${e.element}</span>\n                </div>\n              </div>\n              <div class="table-cell tier-cell">\n                <span class="badge badge-tier-${e.tier.toLowerCase()}">${e.tier}</span>\n              </div>\n              <div class="table-cell stat-cell">\n                <span class="stat-value">${e.winRate.toFixed(1)}%</span>\n              </div>\n              <div class="table-cell stat-cell">\n                <span class="stat-value">${e.pickRate.toFixed(1)}%</span>\n              </div>\n              <div class="table-cell stat-cell">\n                <span class="stat-value">${e.synergies.toFixed(0)}</span>\n              </div>\n            </div>\n          `).join("")}\n        </div>\n      </div>\n    `}renderHistoricalChart(){const e=this.historicalData.tierDistribution.map(e=>e.month);return`\n      <div class="historical-chart">\n        <div class="chart-legend">\n          <div class="legend-item">\n            <div class="legend-color tier-s"></div>\n            <span class="legend-label">S-Tier</span>\n          </div>\n          <div class="legend-item">\n            <div class="legend-color tier-a"></div>\n            <span class="legend-label">A-Tier</span>\n          </div>\n          <div class="legend-item">\n            <div class="legend-color tier-b"></div>\n            <span class="legend-label">B-Tier</span>\n          </div>\n          <div class="legend-item">\n            <div class="legend-color tier-c"></div>\n            <span class="legend-label">C-Tier</span>\n          </div>\n        </div>\n        <div class="line-chart">\n          <div class="chart-lines">\n            ${["S","A","B","C"].map(t=>`\n              <div class="chart-line tier-${t.toLowerCase()}">\n                ${e.map((n,i)=>{const a=this.historicalData.tierDistribution[i].data[t]||0;return`<div class="line-point" style="left: ${i/(e.length-1)*100}%; top: ${100-a/25*100}%" data-value="${a}"></div>`}).join("")}\n              </div>\n            `).join("")}\n          </div>\n          <div class="chart-x-axis">\n            ${e.map(e=>`<span class="x-label">${e}</span>`).join("")}\n          </div>\n        </div>\n      </div>\n    `}getElementIcon(e){return{Fire:"🔥",Water:"💧",Earth:"🌱",Electric:"⚡"}[e]||"❓"}attachMetaDashboardEvents(){const e=document.getElementById("time-period-select");e&&e.addEventListener("change",e=>{this.updateDashboardForPeriod(e.target.value)});const t=document.getElementById("refresh-data");t&&t.addEventListener("click",()=>{this.refreshMetaData()});const n=document.querySelectorAll(".tab-btn");n.forEach(e=>{e.addEventListener("click",e=>{const t=e.target.dataset.tab;this.switchPerformersTab(t),n.forEach(e=>e.classList.remove("active")),e.target.classList.add("active")})});document.querySelectorAll(".trend-item").forEach(e=>{e.addEventListener("click",e=>{const t=e.currentTarget.dataset.palmon;this.showPalmonDetails(t)})});document.querySelectorAll(".table-row[data-palmon]").forEach(e=>{e.addEventListener("click",e=>{const t=e.currentTarget.dataset.palmon;this.showPalmonDetails(t)})})}updateDashboardForPeriod(e){console.log(`Updating dashboard for period: ${e}`),this.showNotification(`Updated data for ${e}`,"info")}refreshMetaData(){this.historicalData=this.generateHistoricalData(),this.usageStats=this.calculateUsageStats(),this.winRates=this.generateWinRates(),this.metaTrends=this.calculateMetaTrends(),this.renderMetaDashboard(),this.showNotification("Meta data refreshed successfully","success")}switchPerformersTab(e){const t=document.getElementById("performers-table");if(!t)return;let n;switch(e){case"pickrate":n=[...this.winRates].sort((e,t)=>t.pickRate-e.pickRate);break;case"synergy":n=[...this.winRates].sort((e,t)=>t.synergies-e.synergies);break;default:n=[...this.winRates].sort((e,t)=>t.winRate-e.winRate)}const i=t.querySelector(".table-body");if(i){i.innerHTML=n.slice(0,10).map((e,t)=>`\n        <div class="table-row" data-palmon="${e.name}">\n          <div class="table-cell rank-cell">\n            <span class="rank-number">#${t+1}</span>\n          </div>\n          <div class="table-cell palmon-cell">\n            <div class="palmon-info">\n              <span class="palmon-name">${e.name}</span>\n              <span class="palmon-element">${this.getElementIcon(e.element)} ${e.element}</span>\n            </div>\n          </div>\n          <div class="table-cell tier-cell">\n            <span class="badge badge-tier-${e.tier.toLowerCase()}">${e.tier}</span>\n          </div>\n          <div class="table-cell stat-cell">\n            <span class="stat-value">${e.winRate.toFixed(1)}%</span>\n          </div>\n          <div class="table-cell stat-cell">\n            <span class="stat-value">${e.pickRate.toFixed(1)}%</span>\n          </div>\n          <div class="table-cell stat-cell">\n            <span class="stat-value">${e.synergies.toFixed(0)}</span>\n          </div>\n        </div>\n      `).join("");i.querySelectorAll(".table-row[data-palmon]").forEach(e=>{e.addEventListener("click",e=>{const t=e.currentTarget.dataset.palmon;this.showPalmonDetails(t)})})}}showPalmonDetails(e){const t=this.palmonData.find(t=>t.name===e);if(t)if(void 0!==PalmonDetailModal){new PalmonDetailModal(t).show()}else this.showNotification(`Viewing details for ${e}`,"info")}showNotification(e,t="info"){const n=document.createElement("div");n.className=`notification notification-${t}`,n.textContent=e;const i={info:"var(--text-accent)",error:"var(--tier-s)",success:"var(--tier-economy)",warning:"var(--tier-a)"};n.style.cssText=`\n      position: fixed;\n      top: 20px;\n      right: 20px;\n      background: ${i[t]||i.info};\n      color: white;\n      padding: var(--spacing-md) var(--spacing-lg);\n      border-radius: var(--radius-md);\n      box-shadow: var(--shadow-lg);\n      z-index: var(--z-tooltip);\n      max-width: 300px;\n      font-size: var(--font-size-sm);\n      font-weight: var(--font-weight-medium);\n      animation: slideInRight 0.3s ease-out;\n    `,document.body.appendChild(n),setTimeout(()=>{n.style.animation="slideOutRight 0.3s ease-in",setTimeout(()=>{n.remove()},300)},5e3)}}class TutorialSystem{constructor(e){this.app=e,this.currentTour=null,this.currentStep=0,this.isActive=!1,this.tutorials=this.initializeTutorials(),this.tooltips=new Map,this.init()}init(){this.createTutorialUI(),this.setupEventListeners(),this.checkFirstVisit()}initializeTutorials(){return{"getting-started":{id:"getting-started",title:"Getting Started with Palmon Masters",description:"Learn the basics of navigating and using our strategy hub",steps:[{target:".nav-brand",title:"Welcome to Palmon Masters!",content:"This is your ultimate strategy hub for Palmon: Survival Min|Max. Let's take a quick tour to get you started.",position:"bottom"},{target:'[data-nav="tier-list"]',title:"Tier List",content:"Browse our comprehensive tier list to see how each Palmon ranks in the current meta. Click here to explore different tiers and filtering options.",position:"bottom"},{target:'[data-nav="team-builder"]',title:"Team Builder",content:"Create and optimize your team compositions with our drag-and-drop team builder. Perfect for experimenting with synergies.",position:"bottom"},{target:'[data-nav="meta-analysis"]',title:"Meta Analysis",content:"Dive deep into statistics, win rates, and meta trends to stay ahead of the competition.",position:"bottom"},{target:"#global-search",title:"Search Function",content:"Quickly find any Palmon using our search feature. Just start typing a name to get instant results.",position:"bottom"},{target:"#theme-toggle",title:"Theme Toggle",content:"Switch between dark and light themes to customize your viewing experience.",position:"bottom-left"}]},"team-building":{id:"team-building",title:"Team Building Basics",description:"Learn how to create effective team compositions",steps:[{target:".team-composition-section",title:"Team Composition Grid",content:"This is where you'll build your team. You have 6 slots total - 3 in the front row and 3 in the back row.",position:"top"},{target:".front-row",title:"Front Row Strategy",content:"Front row Palmon are typically your tanks and melee DPS. They'll take the brunt of enemy attacks.",position:"top"},{target:".back-row",title:"Back Row Strategy",content:"Back row is perfect for ranged DPS, supports, and utility Palmon. They're safer from enemy attacks.",position:"top"},{target:".palmon-selection-section",title:"Palmon Library",content:"Browse and select Palmon from your library. You can drag them directly onto team slots or use quick-add buttons.",position:"left"}]},"tier-list-guide":{id:"tier-list-guide",title:"Understanding Tier Lists",description:"Learn how to interpret and use our tier rankings",steps:[{target:".tier-list-container",title:"Tier Rankings Explained",content:"Palmon are ranked from S-Tier (strongest) to Economy Tier (budget-friendly). Each tier represents overall power level and meta relevance.",position:"top"},{target:".filter-panel",title:"Filtering Options",content:"Use filters to narrow down Palmon by element, role, or tier. This helps you find exactly what you're looking for.",position:"right"}]}}}createTutorialUI(){const e=document.createElement("div");e.id="tutorial-overlay",e.className="tutorial-overlay",e.innerHTML='\n      <div class="tutorial-spotlight"></div>\n      <div class="tutorial-popup">\n        <div class="tutorial-header">\n          <h3 class="tutorial-title"></h3>\n          <button class="tutorial-close" title="Close tutorial">×</button>\n        </div>\n        <div class="tutorial-content">\n          <p class="tutorial-text"></p>\n        </div>\n        <div class="tutorial-footer">\n          <div class="tutorial-progress">\n            <span class="tutorial-step-counter"></span>\n            <div class="tutorial-progress-bar">\n              <div class="tutorial-progress-fill"></div>\n            </div>\n          </div>\n          <div class="tutorial-actions">\n            <button class="btn btn-ghost tutorial-prev">Previous</button>\n            <button class="btn btn-primary tutorial-next">Next</button>\n            <button class="btn btn-secondary tutorial-finish" style="display: none;">Finish</button>\n          </div>\n        </div>\n      </div>\n    ',document.body.appendChild(e);const t=document.createElement("div");t.id="tutorial-launcher",t.className="tutorial-launcher",t.innerHTML='\n      <button class="tutorial-launcher-btn" title="Start Tutorial">\n        <span class="launcher-icon">🎓</span>\n        <span class="launcher-text">Help</span>\n      </button>\n      <div class="tutorial-menu">\n        <div class="tutorial-menu-header">\n          <h4>Tutorials & Guides</h4>\n        </div>\n        <div class="tutorial-menu-content">\n          <button class="tutorial-menu-item" data-tutorial="getting-started">\n            <span class="menu-item-icon">🚀</span>\n            <div class="menu-item-content">\n              <span class="menu-item-title">Getting Started</span>\n              <span class="menu-item-desc">Basic navigation and features</span>\n            </div>\n          </button>\n          <button class="tutorial-menu-item" data-tutorial="team-building">\n            <span class="menu-item-icon">⚔️</span>\n            <div class="menu-item-content">\n              <span class="menu-item-title">Team Building</span>\n              <span class="menu-item-desc">Learn composition strategies</span>\n            </div>\n          </button>\n          <button class="tutorial-menu-item" data-tutorial="tier-list-guide">\n            <span class="menu-item-icon">📊</span>\n            <div class="menu-item-content">\n              <span class="menu-item-title">Tier List Guide</span>\n              <span class="menu-item-desc">Understanding rankings</span>\n            </div>\n          </button>\n          <div class="tutorial-menu-divider"></div>\n          <button class="tutorial-menu-item" id="toggle-tooltips">\n            <span class="menu-item-icon">💡</span>\n            <div class="menu-item-content">\n              <span class="menu-item-title">Toggle Tooltips</span>\n              <span class="menu-item-desc">Show/hide contextual help</span>\n            </div>\n          </button>\n        </div>\n      </div>\n    ',document.body.appendChild(t)}setupEventListeners(){const e=document.querySelector(".tutorial-launcher-btn"),t=document.querySelector(".tutorial-menu");e&&e.addEventListener("click",e=>{e.stopPropagation(),t.classList.toggle("active")}),document.addEventListener("click",e=>{e.target.closest(".tutorial-launcher")||t.classList.remove("active")});document.querySelectorAll(".tutorial-menu-item[data-tutorial]").forEach(e=>{e.addEventListener("click",e=>{const n=e.currentTarget.dataset.tutorial;this.startTutorial(n),t.classList.remove("active")})});const n=document.getElementById("toggle-tooltips");n&&n.addEventListener("click",()=>{this.toggleTooltips(),t.classList.remove("active")});const i=document.getElementById("tutorial-overlay");i&&(i.querySelector(".tutorial-close").addEventListener("click",()=>{this.endTutorial()}),i.querySelector(".tutorial-prev").addEventListener("click",()=>{this.previousStep()}),i.querySelector(".tutorial-next").addEventListener("click",()=>{this.nextStep()}),i.querySelector(".tutorial-finish").addEventListener("click",()=>{this.endTutorial()}),i.addEventListener("click",e=>{e.target===i&&this.endTutorial()})),document.addEventListener("keydown",e=>{if(this.isActive)switch(e.key){case"Escape":this.endTutorial();break;case"ArrowRight":case" ":e.preventDefault(),this.nextStep();break;case"ArrowLeft":e.preventDefault(),this.previousStep()}})}checkFirstVisit(){localStorage.getItem("palmon-masters-visited")||(setTimeout(()=>{this.showWelcomeMessage()},2e3),localStorage.setItem("palmon-masters-visited","true"))}showWelcomeMessage(){const e=document.createElement("div");e.className="welcome-modal",e.innerHTML='\n      <div class="welcome-backdrop"></div>\n      <div class="welcome-container">\n        <div class="welcome-header">\n          <h2 class="welcome-title">Welcome to Palmon Masters! 🎉</h2>\n          <button class="welcome-close">×</button>\n        </div>\n        <div class="welcome-content">\n          <p class="welcome-text">\n            Your ultimate strategy hub for Palmon: Survival Min|Max is ready! \n            Would you like a quick tour to get started?\n          </p>\n          <div class="welcome-features">\n            <div class="welcome-feature">\n              <span class="feature-icon">📊</span>\n              <span class="feature-text">Interactive tier lists</span>\n            </div>\n            <div class="welcome-feature">\n              <span class="feature-icon">⚔️</span>\n              <span class="feature-text">Team builder tools</span>\n            </div>\n            <div class="welcome-feature">\n              <span class="feature-icon">📈</span>\n              <span class="feature-text">Meta analysis dashboard</span>\n            </div>\n          </div>\n        </div>\n        <div class="welcome-actions">\n          <button class="btn btn-ghost welcome-skip">Skip Tour</button>\n          <button class="btn btn-primary welcome-start-tour">Start Tour</button>\n        </div>\n      </div>\n    ',document.body.appendChild(e);const t=()=>{e.remove()};e.querySelector(".welcome-close").addEventListener("click",t),e.querySelector(".welcome-skip").addEventListener("click",t),e.querySelector(".welcome-start-tour").addEventListener("click",()=>{t(),this.startTutorial("getting-started")}),e.addEventListener("click",n=>{n.target===e&&t()})}startTutorial(e){const t=this.tutorials[e];if(!t)return;this.currentTour=t,this.currentStep=0,this.isActive=!0;document.getElementById("tutorial-overlay").classList.add("active"),this.showStep(0)}showStep(e){if(!this.currentTour||e>=this.currentTour.steps.length)return;const t=this.currentTour.steps[e],n=document.getElementById("tutorial-overlay"),i=n.querySelector(".tutorial-popup"),a=n.querySelector(".tutorial-spotlight");n.querySelector(".tutorial-title").textContent=t.title,n.querySelector(".tutorial-text").textContent=t.content;const s=n.querySelector(".tutorial-step-counter"),o=n.querySelector(".tutorial-progress-fill");s.textContent=`${e+1} of ${this.currentTour.steps.length}`,o.style.width=(e+1)/this.currentTour.steps.length*100+"%";const r=n.querySelector(".tutorial-prev"),l=n.querySelector(".tutorial-next"),c=n.querySelector(".tutorial-finish");r.style.display=e>0?"block":"none",e===this.currentTour.steps.length-1?(l.style.display="none",c.style.display="block"):(l.style.display="block",c.style.display="none"),this.positionTutorialElements(t,i,a)}positionTutorialElements(e,t,n){const i=document.querySelector(e.target);if(!i)return t.style.position="fixed",t.style.top="50%",t.style.left="50%",t.style.transform="translate(-50%, -50%)",void(n.style.display="none");const a=i.getBoundingClientRect(),s=t.getBoundingClientRect();let o,r;switch(n.style.display="block",n.style.left=a.left-10+"px",n.style.top=a.top-10+"px",n.style.width=`${a.width+20}px`,n.style.height=`${a.height+20}px`,e.position){case"top":o=a.left+a.width/2-s.width/2,r=a.top-s.height-20;break;case"bottom":default:o=a.left+a.width/2-s.width/2,r=a.bottom+20;break;case"left":o=a.left-s.width-20,r=a.top+a.height/2-s.height/2;break;case"right":o=a.right+20,r=a.top+a.height/2-s.height/2;break;case"bottom-left":o=a.left,r=a.bottom+20}const l=window.innerWidth,c=window.innerHeight;o=Math.max(20,Math.min(o,l-s.width-20)),r=Math.max(20,Math.min(r,c-s.height-20)),t.style.position="fixed",t.style.left=`${o}px`,t.style.top=`${r}px`,t.style.transform="none",i.scrollIntoView({behavior:"smooth",block:"center"})}nextStep(){this.currentStep<this.currentTour.steps.length-1&&(this.currentStep++,this.showStep(this.currentStep))}previousStep(){this.currentStep>0&&(this.currentStep--,this.showStep(this.currentStep))}endTutorial(){this.isActive=!1,this.currentTour=null,this.currentStep=0;document.getElementById("tutorial-overlay").classList.remove("active")}addTooltip(e,t,n={}){document.querySelectorAll(e).forEach(e=>{const i={element:e,content:t,position:n.position||"top",trigger:n.trigger||"hover",delay:n.delay||500};this.tooltips.set(e,i),this.attachTooltipEvents(i)})}attachTooltipEvents(e){const{element:t,trigger:n}=e;if("hover"===n){let n;t.addEventListener("mouseenter",()=>{n=setTimeout(()=>{this.showTooltip(e)},e.delay)}),t.addEventListener("mouseleave",()=>{clearTimeout(n),this.hideTooltip(e)})}else"click"===n&&t.addEventListener("click",t=>{t.preventDefault(),this.toggleTooltip(e)})}showTooltip(e){if(!this.tooltipsEnabled)return;const{element:t,content:n,position:i}=e;this.hideTooltip(e);const a=document.createElement("div");a.className="contextual-tooltip",a.innerHTML=n,document.body.appendChild(a);const s=t.getBoundingClientRect(),o=a.getBoundingClientRect();let r,l;switch(i){case"top":r=s.left+s.width/2-o.width/2,l=s.top-o.height-10;break;case"bottom":r=s.left+s.width/2-o.width/2,l=s.bottom+10;break;case"left":r=s.left-o.width-10,l=s.top+s.height/2-o.height/2;break;case"right":r=s.right+10,l=s.top+s.height/2-o.height/2}r=Math.max(10,Math.min(r,window.innerWidth-o.width-10)),l=Math.max(10,Math.min(l,window.innerHeight-o.height-10)),a.style.left=`${r}px`,a.style.top=`${l}px`,e.tooltipElement=a,requestAnimationFrame(()=>{a.classList.add("visible")})}hideTooltip(e){e.tooltipElement&&(e.tooltipElement.remove(),e.tooltipElement=null)}toggleTooltip(e){e.tooltipElement?this.hideTooltip(e):this.showTooltip(e)}toggleTooltips(){this.tooltipsEnabled=!this.tooltipsEnabled,localStorage.setItem("palmon-tooltips-enabled",this.tooltipsEnabled),this.tooltipsEnabled||this.tooltips.forEach(e=>{this.hideTooltip(e)}),this.app.showNotification("Tooltips "+(this.tooltipsEnabled?"enabled":"disabled"),"info")}initializeContextualTooltips(){this.tooltipsEnabled="false"!==localStorage.getItem("palmon-tooltips-enabled"),this.addTooltip(".nav-link","Navigate to this section",{position:"bottom"}),this.addTooltip(".badge","Click for more information about this tier/element",{position:"top"}),this.addTooltip(".team-slot","Drag Palmon here to add them to your team",{position:"top"}),this.addTooltip(".search-input","Search for Palmon by name, element, or role",{position:"bottom"}),this.addTooltip(".theme-toggle","Switch between light and dark themes",{position:"bottom-left"})}}class SharingExportSystem{constructor(e){this.app=e,this.canvas=null,this.init()}init(){this.createCanvas(),this.setupSharingButtons(),this.setupExportButtons()}createCanvas(){this.canvas=document.createElement("canvas"),this.canvas.style.display="none",document.body.appendChild(this.canvas)}setupSharingButtons(){this.addSharingToCards(),this.addSharingToTeamBuilder(),this.addSharingToTierList()}setupExportButtons(){this.addExportToTeamBuilder(),this.addExportToTierList()}addSharingToCards(){document.addEventListener("click",e=>{if(e.target.closest(".share-palmon-btn")){const t=e.target.closest(".palmon-card");if(t){const e=t.dataset.palmon;this.sharePalmon(e)}}})}addSharingToTeamBuilder(){const e=document.getElementById("team-builder");if(e){const t=document.createElement("button");t.className="btn btn-secondary",t.innerHTML='\n        <span class="btn-icon">🔗</span>\n        Share Team\n      ',t.addEventListener("click",()=>{this.shareTeam()});const n=e.querySelector(".team-actions");n&&n.appendChild(t)}}addSharingToTierList(){const e=document.getElementById("tier-list");if(e){const t=document.createElement("button");t.className="btn btn-ghost",t.innerHTML='\n        <span class="btn-icon">📊</span>\n        Share Tier List\n      ',t.addEventListener("click",()=>{this.shareTierList()});const n=e.querySelector("#tier-list-container");n&&n.appendChild(t)}}addExportToTeamBuilder(){const e=document.getElementById("team-builder");if(e){const t=document.createElement("button");t.className="btn btn-primary",t.innerHTML='\n        <span class="btn-icon">📷</span>\n        Export as Image\n      ',t.addEventListener("click",()=>{this.exportTeamAsImage()});const n=e.querySelector(".team-actions");n&&n.appendChild(t)}}addExportToTierList(){const e=document.getElementById("tier-list");if(e){const t=document.createElement("button");t.className="btn btn-primary",t.innerHTML='\n        <span class="btn-icon">💾</span>\n        Export Tier List\n      ',t.addEventListener("click",()=>{this.exportTierListAsImage()});const n=e.querySelector("#tier-list-container");n&&n.appendChild(t)}}async sharePalmon(e){const t=this.app.processedPalmonData?.find(t=>t.name===e);if(!t)return;const n={title:`${t.name} - Palmon Masters`,text:`Check out ${t.name}, a ${t.tier}-tier ${t.element} ${t.role} in Palmon: Survival Min|Max!`,url:`${window.location.origin}${window.location.pathname}#palmon=${encodeURIComponent(t.name)}`};try{navigator.share&&this.isMobile()?await navigator.share(n):this.showShareModal(n)}catch(e){console.error("Error sharing:",e),this.showShareModal(n)}}async shareTeam(){const e=this.getCurrentTeam();if(!e||0===e.length)return void this.app.showNotification("No team to share! Add some Palmon to your team first.","warning");const t={title:"My Palmon Team - Palmon Masters",text:`Check out my Palmon team: ${e.map(e=>e.name).join(", ")}`,url:`${window.location.origin}${window.location.pathname}#team=${this.encodeTeam(e)}`};try{navigator.share&&this.isMobile()?await navigator.share(t):this.showShareModal(t)}catch(e){console.error("Error sharing team:",e),this.showShareModal(t)}}async shareTierList(){const e={title:"Palmon Tier List - Palmon Masters",text:"Check out the latest Palmon: Survival Min|Max tier list and meta analysis!",url:`${window.location.origin}${window.location.pathname}#tier-list`};try{navigator.share&&this.isMobile()?await navigator.share(e):this.showShareModal(e)}catch(t){console.error("Error sharing tier list:",t),this.showShareModal(e)}}showShareModal(e){const t=document.createElement("div");t.className="share-modal",t.innerHTML=`\n      <div class="share-backdrop"></div>\n      <div class="share-container">\n        <div class="share-header">\n          <h3 class="share-title">Share</h3>\n          <button class="share-close">×</button>\n        </div>\n        <div class="share-content">\n          <div class="share-preview">\n            <h4 class="share-preview-title">${e.title}</h4>\n            <p class="share-preview-text">${e.text}</p>\n            <span class="share-preview-url">${e.url}</span>\n          </div>\n          <div class="share-options">\n            <button class="share-option" data-platform="twitter">\n              <span class="share-icon">🐦</span>\n              <span class="share-label">Twitter</span>\n            </button>\n            <button class="share-option" data-platform="facebook">\n              <span class="share-icon">📘</span>\n              <span class="share-label">Facebook</span>\n            </button>\n            <button class="share-option" data-platform="reddit">\n              <span class="share-icon">📱</span>\n              <span class="share-label">Reddit</span>\n            </button>\n            <button class="share-option" data-platform="discord">\n              <span class="share-icon">💬</span>\n              <span class="share-label">Discord</span>\n            </button>\n            <button class="share-option" data-platform="copy">\n              <span class="share-icon">📋</span>\n              <span class="share-label">Copy Link</span>\n            </button>\n          </div>\n        </div>\n      </div>\n    `,document.body.appendChild(t);const n=()=>t.remove();t.querySelector(".share-close").addEventListener("click",n),t.querySelector(".share-backdrop").addEventListener("click",n),t.querySelectorAll(".share-option").forEach(t=>{t.addEventListener("click",t=>{const i=t.currentTarget.dataset.platform;this.shareOnPlatform(i,e),n()})}),requestAnimationFrame(()=>{t.classList.add("visible")})}shareOnPlatform(e,t){const n=encodeURIComponent(t.text),i=encodeURIComponent(t.url),a=encodeURIComponent(t.title);let s;switch(e){case"twitter":s=`https://twitter.com/intent/tweet?text=${n}&url=${i}`;break;case"facebook":s=`https://www.facebook.com/sharer/sharer.php?u=${i}&quote=${n}`;break;case"reddit":s=`https://reddit.com/submit?url=${i}&title=${a}`;break;case"discord":return this.copyToClipboard(`${t.text} ${t.url}`),void this.app.showNotification("Link copied! Paste it in Discord.","success");case"copy":return this.copyToClipboard(t.url),void this.app.showNotification("Link copied to clipboard!","success")}s&&window.open(s,"_blank","width=600,height=400")}async exportTeamAsImage(){const e=this.getCurrentTeam();if(e&&0!==e.length)try{this.app.showNotification("Generating team image...","info");const t=await this.generateTeamImage(e);this.downloadImage(t,"palmon-team.png"),this.app.showNotification("Team image exported successfully!","success")}catch(e){console.error("Error exporting team:",e),this.app.showNotification("Failed to export team image.","error")}else this.app.showNotification("No team to export! Add some Palmon to your team first.","warning")}async exportTierListAsImage(){try{this.app.showNotification("Generating tier list image...","info");const e=await this.generateTierListImage();this.downloadImage(e,"palmon-tier-list.png"),this.app.showNotification("Tier list exported successfully!","success")}catch(e){console.error("Error exporting tier list:",e),this.app.showNotification("Failed to export tier list image.","error")}}async generateTeamImage(e){const t=this.canvas.getContext("2d"),n=800;this.canvas.width=n,this.canvas.height=600,t.fillStyle="#1a1a2e",t.fillRect(0,0,n,600),t.fillStyle="#feca57",t.font="bold 32px Arial",t.textAlign="center",t.fillText("My Palmon Team",400,50),t.fillStyle="#a2d2ff",t.font="16px Arial",t.fillText("Created with Palmon Masters",400,80);const i=120;return e.forEach((e,n)=>{const a=200+140*(n%3),s=n>=3?280:120;t.fillStyle="#16213e",t.fillRect(a,s,i,140);const o={S:"#ff4757",A:"#feca57",B:"#54a0ff",C:"#8395a7",Economy:"#2ed573"};t.strokeStyle=o[e.tier]||"#8395a7",t.lineWidth=3,t.strokeRect(a,s,i,140),t.fillStyle="#e0e0e0",t.font="bold 14px Arial",t.textAlign="center",t.fillText(e.name,a+60,s+30),t.fillStyle=o[e.tier]||"#8395a7",t.fillRect(a+5,s+5,30,20),t.fillStyle="#ffffff",t.font="bold 12px Arial",t.fillText(e.tier,a+20,s+18),t.fillStyle="#a2d2ff",t.font="12px Arial",t.fillText(`${e.element} ${e.role}`,a+60,s+140-20)}),t.fillStyle="#a2d2ff",t.font="bold 16px Arial",t.textAlign="left",t.fillText("Front Row",50,140),t.fillText("Back Row",50,300),t.fillStyle="#8395a7",t.font="12px Arial",t.textAlign="right",t.fillText("palmonmasters.com",780,580),new Promise(e=>{this.canvas.toBlob(e,"image/png")})}async generateTierListImage(){const e=this.canvas.getContext("2d"),t=1200;this.canvas.width=t,this.canvas.height=800,e.fillStyle="#1a1a2e",e.fillRect(0,0,t,800),e.fillStyle="#feca57",e.font="bold 36px Arial",e.textAlign="center",e.fillText("Palmon Tier List",600,50),e.fillStyle="#a2d2ff",e.font="16px Arial",e.fillText("Current Meta Rankings",600,80);const n={S:"#ff4757",A:"#feca57",B:"#54a0ff",C:"#8395a7",Economy:"#2ed573"};let i=120;const a=120;return["S","A","B","C","Economy"].forEach(t=>{const s=this.app.processedPalmonData?.filter(e=>e.tier===t)||[];e.fillStyle=n[t],e.fillRect(20,i,100,a),e.fillStyle="#ffffff",e.font="bold 32px Arial",e.textAlign="center",e.fillText(t,70,i+60+10),e.fillStyle="#16213e",e.fillRect(120,i,1060,a),e.fillStyle="#e0e0e0",e.font="14px Arial",e.textAlign="left";const o=s.slice(0,15).map(e=>e.name).join(", ");this.wrapText(e,o,1040).forEach((t,n)=>{e.fillText(t,140,i+30+20*n)}),i+=130}),e.fillStyle="#8395a7",e.font="12px Arial",e.textAlign="right",e.fillText("Generated by Palmon Masters",1180,780),new Promise(e=>{this.canvas.toBlob(e,"image/png")})}getCurrentTeam(){const e=document.querySelectorAll(".team-slot"),t=[];return e.forEach(e=>{const n=e.dataset.palmon;if(n){const e=this.app.processedPalmonData?.find(e=>e.name===n);e&&t.push(e)}}),t}encodeTeam(e){return btoa(JSON.stringify(e.map(e=>({name:e.name,tier:e.tier,element:e.element,role:e.role}))))}decodeTeam(e){try{return JSON.parse(atob(e))}catch(e){return console.error("Error decoding team:",e),null}}wrapText(e,t,n){const i=t.split(" "),a=[];let s=i[0];for(let t=1;t<i.length;t++){const o=i[t];e.measureText(s+" "+o).width<n?s+=" "+o:(a.push(s),s=o)}return a.push(s),a}async copyToClipboard(e){try{await navigator.clipboard.writeText(e)}catch(t){const n=document.createElement("textarea");n.value=e,document.body.appendChild(n),n.select(),document.execCommand("copy"),document.body.removeChild(n)}}downloadImage(e,t){const n=URL.createObjectURL(e),i=document.createElement("a");i.href=n,i.download=t,document.body.appendChild(i),i.click(),document.body.removeChild(i),URL.revokeObjectURL(n)}isMobile(){return/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)}generateEmbedCode(e,t){const n=window.location.origin+window.location.pathname;let i;switch(e){case"palmon":i=`${n}embed/palmon/${encodeURIComponent(t.name)}`;break;case"team":i=`${n}embed/team/${this.encodeTeam(t)}`;break;case"tier-list":i=`${n}embed/tier-list`;break;default:return null}return`<iframe src="${i}" width="400" height="300" frameborder="0" style="border-radius: 8px;"></iframe>`}showEmbedModal(e,t){const n=this.generateEmbedCode(e,t);if(!n)return;const i=document.createElement("div");i.className="embed-modal",i.innerHTML=`\n      <div class="embed-backdrop"></div>\n      <div class="embed-container">\n        <div class="embed-header">\n          <h3 class="embed-title">Embed Code</h3>\n          <button class="embed-close">×</button>\n        </div>\n        <div class="embed-content">\n          <p class="embed-description">Copy this code to embed on your website:</p>\n          <div class="embed-code-container">\n            <textarea class="embed-code" readonly>${n}</textarea>\n            <button class="btn btn-primary embed-copy">Copy Code</button>\n          </div>\n          <div class="embed-preview">\n            <h4>Preview:</h4>\n            <div class="embed-preview-container">\n              ${n}\n            </div>\n          </div>\n        </div>\n      </div>\n    `,document.body.appendChild(i);const a=()=>i.remove();i.querySelector(".embed-close").addEventListener("click",a),i.querySelector(".embed-backdrop").addEventListener("click",a),i.querySelector(".embed-copy").addEventListener("click",()=>{i.querySelector(".embed-code").select(),this.copyToClipboard(n),this.app.showNotification("Embed code copied!","success")}),requestAnimationFrame(()=>{i.classList.add("visible")})}}const palmonApp=new PalmonApp;class MobileEnhancer{constructor(){this.touchStartX=0,this.touchStartY=0,this.touchEndX=0,this.touchEndY=0,this.isTouch=!1,this.gestureThreshold=50,this.tapTimeout=null,this.doubleTapDelay=300,this.init()}init(){console.log("📱 Initializing mobile enhancements..."),this.detectTouchCapability(),this.initializeTouchInteractions(),this.initializeGestureSupport(),this.initializeMobileNavigation(),this.initializePWAFeatures(),this.initializeMobileOptimizations(),this.initializeTouchFeedback(),console.log("✅ Mobile enhancements initialized")}detectTouchCapability(){this.isTouch="ontouchstart"in window||navigator.maxTouchPoints>0,this.isTouch?(document.documentElement.classList.add("touch-device"),console.log("📱 Touch device detected")):document.documentElement.classList.add("no-touch");/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&document.documentElement.classList.add("mobile-device");/iPad|iPhone|iPod/.test(navigator.userAgent)&&document.documentElement.classList.add("ios-device");/Android/.test(navigator.userAgent)&&document.documentElement.classList.add("android-device")}initializeTouchInteractions(){this.isTouch&&(document.addEventListener("touchstart",this.handleTouchStart.bind(this),{passive:!0}),document.addEventListener("touchmove",this.handleTouchMove.bind(this),{passive:!1}),document.addEventListener("touchend",this.handleTouchEnd.bind(this),{passive:!0}),this.preventDefaultTouchBehaviors(),this.initializeTouchSpecificInteractions())}handleTouchStart(e){if(1===e.touches.length){this.touchStartX=e.touches[0].clientX,this.touchStartY=e.touches[0].clientY;const t=e.target.closest(".touch-interactive");t&&t.classList.add("touch-active")}}handleTouchMove(e){if(e.target.closest(".prevent-scroll")&&e.preventDefault(),1===e.touches.length){const t=e.touches[0].clientX,n=e.touches[0].clientY,i=Math.abs(t-this.touchStartX),a=Math.abs(n-this.touchStartY);if(i>10||a>10){const i=e.target.closest(".draggable");i&&this.handleDragMove(i,t,n)}}}handleTouchEnd(e){this.touchEndX=e.changedTouches[0].clientX,this.touchEndY=e.changedTouches[0].clientY;const t=e.target.closest(".touch-interactive");t&&t.classList.remove("touch-active"),this.handleGestures(),this.handleTapInteractions(e)}initializeGestureSupport(){this.isTouch&&(this.initializeSwipeGestures(),this.initializePinchGestures(),this.initializeLongPressGestures())}initializeSwipeGestures(){document.querySelectorAll(".swipe-enabled").forEach(e=>{let t,n,i;e.addEventListener("touchstart",e=>{t=e.touches[0].clientX,n=e.touches[0].clientY,i=Date.now()},{passive:!0}),e.addEventListener("touchend",a=>{const s=a.changedTouches[0].clientX,o=a.changedTouches[0].clientY,r=Date.now(),l=s-t,c=o-n,d=r-i;if(d<500&&Math.abs(l)>this.gestureThreshold){const t=l>0?"right":"left";this.handleSwipe(e,t,l)}else if(d<500&&Math.abs(c)>this.gestureThreshold){const t=c>0?"down":"up";this.handleSwipe(e,t,c)}},{passive:!0})})}handleSwipe(e,t,n){console.log(`👆 Swipe ${t} detected on`,e);const i=new CustomEvent("swipe",{detail:{direction:t,distance:n,element:e}});e.dispatchEvent(i),e.classList.contains("tier-list-container")?this.handleTierListSwipe(e,t):e.classList.contains("modal-container")&&this.handleModalSwipe(e,t)}handleTierListSwipe(e,t){"left"===t?this.scrollTierList(e,"next"):"right"===t&&this.scrollTierList(e,"prev")}handleModalSwipe(e,t){if("down"===t){const t=e.querySelector(".modal-close-btn");t&&t.click()}}scrollTierList(e,t){const n=.8*e.clientWidth,i=e.scrollLeft,a="next"===t?i+n:i-n;e.scrollTo({left:a,behavior:"smooth"})}initializePinchGestures(){let e=0;document.addEventListener("touchstart",t=>{2===t.touches.length&&(e=this.getDistance(t.touches[0],t.touches[1]))},{passive:!0}),document.addEventListener("touchmove",t=>{if(2===t.touches.length){t.preventDefault();const n=this.getDistance(t.touches[0],t.touches[1])/e,i=t.target.closest(".pinch-zoomable");i&&this.handlePinchZoom(i,n)}},{passive:!1})}getDistance(e,t){const n=e.clientX-t.clientX,i=e.clientY-t.clientY;return Math.sqrt(n*n+i*i)}handlePinchZoom(e,t){const n=`${e.style.transform||""} scale(${t})`;e.style.transform=n;const i=new CustomEvent("pinch",{detail:{scale:t,element:e}});e.dispatchEvent(i)}initializeLongPressGestures(){let e,t;document.addEventListener("touchstart",n=>{t=n.target.closest(".long-press-enabled"),t&&(e=setTimeout(()=>{this.handleLongPress(t,n)},500))},{passive:!0}),document.addEventListener("touchmove",()=>{e&&(clearTimeout(e),e=null)},{passive:!0}),document.addEventListener("touchend",()=>{e&&(clearTimeout(e),e=null)},{passive:!0})}handleLongPress(e,t){console.log("👆 Long press detected on",e),e.classList.add("long-pressed"),setTimeout(()=>{e.classList.remove("long-pressed")},200);const n=new CustomEvent("longpress",{detail:{element:e,originalEvent:t}});e.dispatchEvent(n),e.classList.contains("palmon-card")&&this.handlePalmonCardLongPress(e)}handlePalmonCardLongPress(e){const t=this.createContextMenu(e);this.showContextMenu(t,e)}createContextMenu(e){const t=document.createElement("div");return t.className="context-menu mobile-context-menu",t.innerHTML='\n      <div class="context-menu-item" data-action="view-details">\n        <span class="context-icon">👁️</span>\n        <span class="context-text">View Details</span>\n      </div>\n      <div class="context-menu-item" data-action="add-to-team">\n        <span class="context-icon">➕</span>\n        <span class="context-text">Add to Team</span>\n      </div>\n      <div class="context-menu-item" data-action="compare">\n        <span class="context-icon">⚖️</span>\n        <span class="context-text">Compare</span>\n      </div>\n      <div class="context-menu-item" data-action="share">\n        <span class="context-icon">🔗</span>\n        <span class="context-text">Share</span>\n      </div>\n    ',t.addEventListener("click",n=>{const i=n.target.closest(".context-menu-item");if(i){const n=i.dataset.action;this.handleContextMenuAction(n,e),this.hideContextMenu(t)}}),t}showContextMenu(e,t){document.body.appendChild(e);const n=t.getBoundingClientRect();e.style.position="fixed",e.style.top=`${n.bottom+10}px`,e.style.left=`${n.left}px`,e.style.zIndex="1000",requestAnimationFrame(()=>{e.classList.add("visible")}),setTimeout(()=>{document.addEventListener("click",t=>{e.contains(t.target)||this.hideContextMenu(e)},{once:!0})},100)}hideContextMenu(e){e.classList.remove("visible"),setTimeout(()=>{e.parentNode&&e.parentNode.removeChild(e)},200)}handleContextMenuAction(e,t){switch(console.log(`Context menu action: ${e}`,t),e){case"view-details":t.click();break;case"add-to-team":this.addToTeam(t);break;case"compare":this.addToComparison(t);break;case"share":this.sharePalmon(t)}}initializeMobileNavigation(){this.initializeBottomNavigation(),this.initializeSwipeNavigation(),this.initializePullToRefresh()}initializeBottomNavigation(){const e=document.createElement("nav");e.className="bottom-navigation mobile-only",e.innerHTML='\n      <div class="bottom-nav-container">\n        <button class="bottom-nav-item active" data-nav="home">\n          <span class="bottom-nav-icon">🏠</span>\n          <span class="bottom-nav-label">Home</span>\n        </button>\n        <button class="bottom-nav-item" data-nav="tier-list">\n          <span class="bottom-nav-icon">📊</span>\n          <span class="bottom-nav-label">Tiers</span>\n        </button>\n        <button class="bottom-nav-item" data-nav="team-builder">\n          <span class="bottom-nav-icon">⚔️</span>\n          <span class="bottom-nav-label">Teams</span>\n        </button>\n        <button class="bottom-nav-item" data-nav="guides">\n          <span class="bottom-nav-icon">📚</span>\n          <span class="bottom-nav-label">Guides</span>\n        </button>\n      </div>\n    ',document.body.appendChild(e),e.addEventListener("click",e=>{const t=e.target.closest(".bottom-nav-item");if(t){const e=t.dataset.nav;this.navigateToSection(e),this.updateBottomNavigation(t)}})}updateBottomNavigation(e){document.querySelectorAll(".bottom-nav-item").forEach(e=>e.classList.remove("active")),e.classList.add("active")}initializeSwipeNavigation(){const e=document.querySelector(".main-content");e&&(e.classList.add("swipe-enabled"),e.addEventListener("swipe",e=>{const{direction:t}=e.detail;this.handleMainContentSwipe(t)}))}handleMainContentSwipe(e){const t=["home","tier-list","team-builder","guides"],n=this.getCurrentSection(),i=t.indexOf(n);let a;"left"===e&&i<t.length-1?a=i+1:"right"===e&&i>0&&(a=i-1),void 0!==a&&this.navigateToSection(t[a])}getCurrentSection(){const e=document.querySelector(".page-section.active");return e?e.id:"home"}navigateToSection(e){window.location.hash=e,document.querySelectorAll(".page-section").forEach(e=>{e.classList.remove("active")});const t=document.getElementById(e);t&&t.classList.add("active");const n=document.querySelector(`[data-nav="${e}"]`);n&&this.updateBottomNavigation(n)}initializePullToRefresh(){let e=0,t=0,n=0,i=!1;const a=document.createElement("div");a.className="pull-to-refresh",a.innerHTML='\n      <div class="pull-to-refresh-content">\n        <div class="pull-to-refresh-icon">↓</div>\n        <div class="pull-to-refresh-text">Pull to refresh</div>\n      </div>\n    ',document.body.insertBefore(a,document.body.firstChild),document.addEventListener("touchstart",t=>{0===window.scrollY&&(e=t.touches[0].clientY,i=!0)},{passive:!0}),document.addEventListener("touchmove",s=>{i&&0===window.scrollY&&(t=s.touches[0].clientY,n=Math.max(0,t-e),n>0&&(s.preventDefault(),this.updatePullToRefresh(a,n,100)))},{passive:!1}),document.addEventListener("touchend",()=>{i&&(n>100?this.triggerRefresh(a):this.resetPullToRefresh(a),i=!1,n=0)},{passive:!0})}updatePullToRefresh(e,t,n){const i=Math.min(t/n,1),a=Math.min(.5*t,60);e.style.transform=`translateY(${a}px)`,e.style.opacity=i;const s=e.querySelector(".pull-to-refresh-icon"),o=e.querySelector(".pull-to-refresh-text");i>=1?(s.textContent="↻",o.textContent="Release to refresh",e.classList.add("ready")):(s.textContent="↓",o.textContent="Pull to refresh",e.classList.remove("ready"))}triggerRefresh(e){e.classList.add("refreshing"),e.querySelector(".pull-to-refresh-icon").textContent="⟳",e.querySelector(".pull-to-refresh-text").textContent="Refreshing...",setTimeout(()=>{this.resetPullToRefresh(e),this.showRefreshComplete()},2e3)}resetPullToRefresh(e){e.style.transform="translateY(-100%)",e.style.opacity="0",e.classList.remove("ready","refreshing"),setTimeout(()=>{e.style.transform="",e.style.opacity=""},300)}showRefreshComplete(){const e=document.createElement("div");e.className="refresh-notification",e.textContent="✅ Content refreshed",e.style.cssText="\n      position: fixed;\n      top: 20px;\n      left: 50%;\n      transform: translateX(-50%);\n      background: var(--tier-economy);\n      color: white;\n      padding: 10px 20px;\n      border-radius: 20px;\n      font-size: 14px;\n      z-index: 1000;\n      animation: slideDown 0.3s ease-out;\n    ",document.body.appendChild(e),setTimeout(()=>{e.remove()},2e3)}initializePWAFeatures(){this.initializeInstallPrompt(),this.initializeOfflineSupport(),this.initializeNotifications()}initializeInstallPrompt(){let e;window.addEventListener("beforeinstallprompt",t=>{console.log("📱 PWA install prompt available"),t.preventDefault(),e=t,this.showInstallButton(e)}),window.addEventListener("appinstalled",()=>{console.log("📱 PWA installed successfully"),this.hideInstallButton(),this.showInstallSuccess()})}showInstallButton(e){const t=document.createElement("button");t.className="install-app-btn btn btn-primary",t.innerHTML='\n      <span class="btn-icon">📱</span>\n      <span class="btn-text">Install App</span>\n    ',t.style.cssText="\n      position: fixed;\n      bottom: 80px;\n      right: 20px;\n      z-index: 1000;\n      box-shadow: var(--shadow-lg);\n    ",t.addEventListener("click",async()=>{if(e){e.prompt();const{outcome:n}=await e.userChoice;console.log(`PWA install outcome: ${n}`),e=null,t.remove()}}),document.body.appendChild(t)}hideInstallButton(){const e=document.querySelector(".install-app-btn");e&&e.remove()}showInstallSuccess(){const e=document.createElement("div");e.className="install-success-notification",e.innerHTML='\n      <div class="notification-content">\n        <span class="notification-icon">🎉</span>\n        <span class="notification-text">App installed successfully!</span>\n      </div>\n    ',e.style.cssText="\n      position: fixed;\n      top: 20px;\n      left: 50%;\n      transform: translateX(-50%);\n      background: var(--tier-economy);\n      color: white;\n      padding: 15px 25px;\n      border-radius: 25px;\n      font-size: 16px;\n      z-index: 1000;\n      box-shadow: var(--shadow-lg);\n      animation: slideDown 0.3s ease-out;\n    ",document.body.appendChild(e),setTimeout(()=>{e.remove()},3e3)}initializeOfflineSupport(){window.addEventListener("online",()=>{this.showConnectionStatus("online")}),window.addEventListener("offline",()=>{this.showConnectionStatus("offline")}),navigator.onLine||this.showConnectionStatus("offline")}showConnectionStatus(e){const t=document.querySelector(".connection-status");t&&t.remove();const n=document.createElement("div");n.className=`connection-status ${e}`,n.innerHTML=`\n      <div class="status-content">\n        <span class="status-icon">${"online"===e?"🌐":"📱"}</span>\n        <span class="status-text">${"online"===e?"Back online":"Offline mode"}</span>\n      </div>\n    `,n.style.cssText=`\n      position: fixed;\n      top: 20px;\n      left: 50%;\n      transform: translateX(-50%);\n      background: ${"online"===e?"var(--tier-economy)":"var(--tier-a)"};\n      color: white;\n      padding: 10px 20px;\n      border-radius: 20px;\n      font-size: 14px;\n      z-index: 1000;\n      animation: slideDown 0.3s ease-out;\n    `,document.body.appendChild(n),setTimeout(()=>{n.remove()},"online"===e?2e3:5e3)}initializeNotifications(){"Notification"in window&&"serviceWorker"in navigator&&"default"===Notification.permission&&this.showNotificationPermissionPrompt()}showNotificationPermissionPrompt(){const e=document.createElement("div");e.className="notification-permission-prompt",e.innerHTML='\n      <div class="prompt-content">\n        <div class="prompt-icon">🔔</div>\n        <div class="prompt-text">\n          <h3>Stay Updated</h3>\n          <p>Get notified about new Palmon updates and tier changes</p>\n        </div>\n        <div class="prompt-actions">\n          <button class="btn btn-ghost btn-sm" data-action="deny">Not now</button>\n          <button class="btn btn-primary btn-sm" data-action="allow">Allow</button>\n        </div>\n      </div>\n    ',e.style.cssText="\n      position: fixed;\n      bottom: 20px;\n      left: 20px;\n      right: 20px;\n      background: var(--secondary-bg);\n      border: 1px solid var(--border-color);\n      border-radius: var(--radius-lg);\n      padding: var(--spacing-lg);\n      z-index: 1000;\n      box-shadow: var(--shadow-lg);\n      animation: slideUp 0.3s ease-out;\n    ",e.addEventListener("click",async t=>{if("allow"===t.target.dataset.action){const e=await Notification.requestPermission();console.log("Notification permission:",e)}e.remove()}),document.body.appendChild(e),setTimeout(()=>{e.parentNode&&e.remove()},1e4)}initializeMobileOptimizations(){this.optimizeScrolling(),this.optimizeTouchTargets(),this.optimizeViewport()}optimizeScrolling(){document.documentElement.style.webkitOverflowScrolling="touch";document.querySelectorAll(".scrollable").forEach(e=>{e.style.webkitOverflowScrolling="touch",e.style.overflowScrolling="touch"})}optimizeTouchTargets(){document.querySelectorAll("button, a, input, .clickable").forEach(e=>{const t=e.getBoundingClientRect();(t.width<44||t.height<44)&&e.classList.add("touch-target-small")})}optimizeViewport(){window.addEventListener("orientationchange",()=>{setTimeout(()=>{this.handleOrientationChange()},100)}),window.addEventListener("resize",()=>{this.handleViewportResize()})}handleOrientationChange(){console.log("📱 Orientation changed");const e=90===window.orientation||-90===window.orientation;document.documentElement.classList.toggle("landscape",e),document.documentElement.classList.toggle("portrait",!e),window.dispatchEvent(new Event("resize"))}handleViewportResize(){const e=(window.visualViewport?window.visualViewport.height:window.innerHeight)<.75*window.screen.height;document.documentElement.classList.toggle("keyboard-open",e)}initializeTouchFeedback(){"vibrate"in navigator&&this.initializeHapticFeedback(),this.initializeVisualFeedback()}initializeHapticFeedback(){document.querySelectorAll(".haptic-feedback").forEach(e=>{e.addEventListener("touchstart",()=>{navigator.vibrate(10)},{passive:!0})})}initializeVisualFeedback(){document.addEventListener("touchstart",e=>{const t=e.target.closest(".ripple-effect");t&&this.createRippleEffect(t,e.touches[0])},{passive:!0})}createRippleEffect(e,t){const n=e.getBoundingClientRect(),i=document.createElement("div");i.className="ripple";const a=Math.max(n.width,n.height),s=t.clientX-n.left-a/2,o=t.clientY-n.top-a/2;i.style.cssText=`\n      position: absolute;\n      width: ${a}px;\n      height: ${a}px;\n      left: ${s}px;\n      top: ${o}px;\n      background: rgba(255, 255, 255, 0.3);\n      border-radius: 50%;\n      transform: scale(0);\n      animation: ripple 0.6s ease-out;\n      pointer-events: none;\n    `,e.style.position="relative",e.style.overflow="hidden",e.appendChild(i),setTimeout(()=>{i.remove()},600)}addToTeam(e){console.log("Adding to team:",e)}addToComparison(e){console.log("Adding to comparison:",e)}sharePalmon(e){if(navigator.share){const t=e.querySelector(".palmon-name")?.textContent||"Palmon";navigator.share({title:`${t} - Palmon Masters`,text:`Check out ${t} on Palmon Masters!`,url:window.location.href})}else{const e=window.location.href;navigator.clipboard.writeText(e).then(()=>{console.log("URL copied to clipboard")})}}handleDragMove(e,t,n){e.style.transform=`translate(${t-this.touchStartX}px, ${n-this.touchStartY}px)`}handleTapInteractions(e){const t=e.target.closest(".tap-interactive");t&&(this.tapTimeout?(clearTimeout(this.tapTimeout),this.tapTimeout=null,this.handleDoubleTap(t,e)):this.tapTimeout=setTimeout(()=>{this.handleSingleTap(t,e),this.tapTimeout=null},this.doubleTapDelay))}handleSingleTap(e,t){console.log("👆 Single tap on",e)}handleDoubleTap(e,t){console.log("👆 Double tap on",e),e.classList.contains("palmon-card")&&this.addToTeam(e)}handleGestures(){const e=this.touchEndX-this.touchStartX,t=this.touchEndY-this.touchStartY;if(!(Math.abs(e)<this.gestureThreshold&&Math.abs(t)<this.gestureThreshold))if(Math.abs(e)>Math.abs(t)){const t=e>0?"right":"left";console.log(`👆 Horizontal swipe: ${t}`)}else{const e=t>0?"down":"up";console.log(`👆 Vertical swipe: ${e}`)}}preventDefaultTouchBehaviors(){document.querySelectorAll(".no-zoom").forEach(e=>{e.addEventListener("touchend",e=>{e.preventDefault()})});document.querySelectorAll(".no-refresh").forEach(e=>{e.addEventListener("touchstart",e=>{1===e.touches.length&&0===window.scrollY&&e.preventDefault()})})}initializeTouchSpecificInteractions(){document.querySelectorAll(".hover-effect").forEach(e=>{e.classList.add("touch-interactive")}),this.convertHoverMenus()}convertHoverMenus(){document.querySelectorAll(".hover-menu").forEach(e=>{const t=e.querySelector(".menu-trigger");t&&t.addEventListener("touchstart",t=>{t.preventDefault(),e.classList.toggle("menu-open")})})}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.mobileEnhancer=new MobileEnhancer}):window.mobileEnhancer=new MobileEnhancer,"undefined"!=typeof module&&module.exports&&(module.exports={MobileEnhancer:MobileEnhancer});class PerformanceOptimizer{constructor(){this.config={lazyLoadThreshold:100,cacheExpiry:864e5,maxCacheSize:52428800,compressionLevel:.8,preloadCritical:!0,enableServiceWorker:!0},this.cache=new Map,this.imageObserver=null,this.loadingQueue=new Set,this.bandwidthMonitor=new BandwidthMonitor,this.init()}init(){console.log("🚀 Initializing Performance Optimizer for InfinityFree..."),this.initializeLazyLoading(),this.initializeImageOptimization(),this.initializeCaching(),this.initializeBandwidthOptimization(),this.initializePreloading(),this.config.enableServiceWorker&&"serviceWorker"in navigator&&this.registerServiceWorker(),this.setupPerformanceMonitoring(),console.log("✅ Performance Optimizer initialized")}initializeLazyLoading(){"IntersectionObserver"in window?(this.imageObserver=new IntersectionObserver(this.handleImageIntersection.bind(this),{rootMargin:`${this.config.lazyLoadThreshold}px`,threshold:.1}),this.observeLazyImages()):this.loadAllImages(),this.initializeContentLazyLoading()}observeLazyImages(){document.querySelectorAll("img[data-src], [data-background-image]").forEach(e=>{this.imageObserver.observe(e)})}handleImageIntersection(e){e.forEach(e=>{if(e.isIntersecting){const t=e.target;this.loadImage(t),this.imageObserver.unobserve(t)}})}loadImage(e){return new Promise((t,n)=>{const i=e.dataset.src||e.dataset.backgroundImage;if(!i)return void t();const a=this.getCachedImage(i);if(a)return this.applyImage(e,a),void t();const s=new Image;s.onload=()=>{const n=this.optimizeImage(s,i);this.cacheImage(i,n),this.applyImage(e,n),e.classList.add("image-loaded"),t()},s.onerror=()=>{console.warn("Failed to load image:",i),e.classList.add("image-error"),n(new Error(`Failed to load image: ${i}`))},s.src=i})}applyImage(e,t){"IMG"===e.tagName?(e.src=t,e.removeAttribute("data-src")):e.dataset.backgroundImage&&(e.style.backgroundImage=`url(${t})`,e.removeAttribute("data-background-image"))}initializeImageOptimization(){this.setupResponsiveImages(),this.detectWebPSupport(),this.setupImageCompression()}setupResponsiveImages(){document.querySelectorAll("img[data-sizes]").forEach(e=>{const t=JSON.parse(e.dataset.sizes||"{}"),n=window.innerWidth;let i=e.dataset.src;Object.entries(t).forEach(([e,t])=>{n>=parseInt(e)&&(i=t)}),e.dataset.src=i})}detectWebPSupport(){return new Promise(e=>{const t=new Image;t.onload=t.onerror=()=>{this.supportsWebP=2===t.height,e(this.supportsWebP)},t.src="data:image/webp;base64,UklGRjoAAABXRUJQVlA4IC4AAACyAgCdASoCAAIALmk0mk0iIiIiIgBoSygABc6WWgAA/veff/0PP8bA//LwYAAA"})}optimizeImage(e,t){const n=document.createElement("canvas"),i=n.getContext("2d"),a=Math.min(e.naturalWidth,2*window.innerWidth),s=Math.min(e.naturalHeight,2*window.innerHeight),o=Math.min(a/e.naturalWidth,s/e.naturalHeight);return n.width=e.naturalWidth*o,n.height=e.naturalHeight*o,i.drawImage(e,0,0,n.width,n.height),n.toDataURL("image/jpeg",this.config.compressionLevel)}setupImageCompression(){document.addEventListener("change",e=>{"file"===e.target.type&&e.target.accept?.includes("image")&&this.compressUploadedImages(e.target.files)})}compressUploadedImages(e){Array.from(e).forEach(e=>{e.type.startsWith("image/")&&this.compressImage(e).then(t=>{console.log(`Compressed ${e.name}: ${e.size} → ${t.size} bytes`)})})}compressImage(e){return new Promise(t=>{const n=document.createElement("canvas"),i=n.getContext("2d"),a=new Image;a.onload=()=>{const e=Math.min(1920/a.width,1920/a.height,1);n.width=a.width*e,n.height=a.height*e,i.drawImage(a,0,0,n.width,n.height),n.toBlob(t,"image/jpeg",this.config.compressionLevel)},a.src=URL.createObjectURL(e)})}initializeCaching(){this.initializeLocalStorageCache(),this.initializeIndexedDBCache(),this.setupCacheCleanup()}initializeLocalStorageCache(){try{const e="__cache_test__";localStorage.setItem(e,"test"),localStorage.removeItem(e),this.localStorageAvailable=!0,console.log("✅ localStorage caching enabled")}catch(e){this.localStorageAvailable=!1,console.warn("⚠️ localStorage not available, using memory cache only")}}initializeIndexedDBCache(){if(!("indexedDB"in window))return void console.warn("⚠️ IndexedDB not supported");const e=indexedDB.open("PalmonCache",1);e.onerror=()=>{console.warn("⚠️ IndexedDB initialization failed")},e.onsuccess=e=>{this.db=e.target.result,console.log("✅ IndexedDB caching enabled")},e.onupgradeneeded=e=>{const t=e.target.result;if(!t.objectStoreNames.contains("images")){t.createObjectStore("images",{keyPath:"url"}).createIndex("timestamp","timestamp",{unique:!1})}if(!t.objectStoreNames.contains("data")){t.createObjectStore("data",{keyPath:"key"}).createIndex("timestamp","timestamp",{unique:!1})}}}cacheImage(e,t){const n={url:e,data:t,timestamp:Date.now(),size:t.length};if(this.cache.set(e,n),this.db){this.db.transaction(["images"],"readwrite").objectStore("images").put(n)}}getCachedImage(e){const t=this.cache.get(e);return t&&!this.isCacheExpired(t)?t.data:this.db?new Promise(t=>{const n=this.db.transaction(["images"],"readonly").objectStore("images").get(e);n.onsuccess=()=>{const i=n.result;i&&!this.isCacheExpired(i)?(this.cache.set(e,i),t(i.data)):t(null)},n.onerror=()=>t(null)}):null}isCacheExpired(e){return Date.now()-e.timestamp>this.config.cacheExpiry}setupCacheCleanup(){setInterval(()=>{this.cleanupCache()},36e5),window.addEventListener("beforeunload",()=>{this.cleanupCache()})}cleanupCache(){const e=Date.now();for(const[e,t]of this.cache.entries())this.isCacheExpired(t)&&this.cache.delete(e);if(this.db){const t=this.db.transaction(["images","data"],"readwrite");["images","data"].forEach(n=>{const i=t.objectStore(n).index("timestamp"),a=IDBKeyRange.upperBound(e-this.config.cacheExpiry);i.openCursor(a).onsuccess=e=>{const t=e.target.result;t&&(t.delete(),t.continue())}})}console.log("🧹 Cache cleanup completed")}initializeBandwidthOptimization(){this.bandwidthMonitor.init(),this.adaptToConnectionSpeed(),this.setupDataSaverMode()}adaptToConnectionSpeed(){if("connection"in navigator){const e=navigator.connection;switch(e.effectiveType){case"slow-2g":case"2g":this.config.compressionLevel=.5,this.config.lazyLoadThreshold=50;break;case"3g":this.config.compressionLevel=.7,this.config.lazyLoadThreshold=75;break;default:this.config.compressionLevel=.8,this.config.lazyLoadThreshold=100}e.addEventListener("change",()=>{this.adaptToConnectionSpeed()})}}setupDataSaverMode(){("true"===localStorage.getItem("dataSaverMode")||navigator.connection&&navigator.connection.saveData)&&this.enableDataSaverMode(),this.addDataSaverToggle()}enableDataSaverMode(){console.log("📱 Data Saver mode enabled"),this.config.compressionLevel=.6,document.documentElement.style.setProperty("--transition-fast","0ms"),document.documentElement.style.setProperty("--transition-normal","0ms"),this.config.lazyLoadThreshold=25,document.body.classList.add("data-saver-mode")}addDataSaverToggle(){const e=document.createElement("button");e.className="data-saver-toggle btn btn-ghost btn-sm",e.innerHTML="📱 Data Saver",e.style.cssText="\n      position: fixed;\n      bottom: 20px;\n      right: 20px;\n      z-index: 1000;\n      opacity: 0.7;\n    ",e.addEventListener("click",()=>{document.body.classList.contains("data-saver-mode")?(this.disableDataSaverMode(),localStorage.setItem("dataSaverMode","false")):(this.enableDataSaverMode(),localStorage.setItem("dataSaverMode","true"))}),document.body.appendChild(e)}disableDataSaverMode(){console.log("📱 Data Saver mode disabled"),this.config.compressionLevel=.8,this.config.lazyLoadThreshold=100,document.documentElement.style.removeProperty("--transition-fast"),document.documentElement.style.removeProperty("--transition-normal"),document.body.classList.remove("data-saver-mode")}initializePreloading(){this.config.preloadCritical&&(this.preloadCriticalCSS(),this.preloadCriticalImages(),this.preloadCriticalData())}preloadCriticalCSS(){["css/style.css"].forEach(e=>{const t=document.createElement("link");t.rel="preload",t.as="style",t.href=e,document.head.appendChild(t)})}preloadCriticalImages(){["assets/logo.png","assets/hero-bg.jpg"].forEach(e=>{const t=document.createElement("link");t.rel="preload",t.as="image",t.href=e,document.head.appendChild(t)})}preloadCriticalData(){["palmon.json"].forEach(e=>{fetch(e).then(e=>e.json()).then(t=>{this.cacheData(e,t)}).catch(t=>{console.warn(`Failed to preload ${e}:`,t)})})}cacheData(e,t){const n={key:e,data:t,timestamp:Date.now(),size:JSON.stringify(t).length};if(this.cache.set(e,n),this.db){this.db.transaction(["data"],"readwrite").objectStore("data").put(n)}}registerServiceWorker(){navigator.serviceWorker.register("/sw.js").then(e=>{console.log("✅ Service Worker registered:",e),e.addEventListener("updatefound",()=>{const t=e.installing;t.addEventListener("statechange",()=>{"installed"===t.state&&navigator.serviceWorker.controller&&this.showUpdateNotification()})})}).catch(e=>{console.warn("⚠️ Service Worker registration failed:",e)})}showUpdateNotification(){const e=document.createElement("div");e.className="update-notification",e.innerHTML='\n      <div class="notification-content">\n        <span>🔄 New version available!</span>\n        <button class="btn btn-sm btn-primary" onclick="location.reload()">Update</button>\n      </div>\n    ',e.style.cssText="\n      position: fixed;\n      top: 20px;\n      left: 50%;\n      transform: translateX(-50%);\n      background: var(--secondary-bg);\n      border: 1px solid var(--border-color);\n      border-radius: var(--radius-md);\n      padding: var(--spacing-md);\n      box-shadow: var(--shadow-lg);\n      z-index: 1000;\n    ",document.body.appendChild(e),setTimeout(()=>{e.remove()},1e4)}setupPerformanceMonitoring(){this.monitorCoreWebVitals(),this.monitorResourceLoading(),this.monitorMemoryUsage()}monitorCoreWebVitals(){new PerformanceObserver(e=>{const t=e.getEntries(),n=t[t.length-1];console.log("LCP:",n.startTime)}).observe({entryTypes:["largest-contentful-paint"]}),new PerformanceObserver(e=>{e.getEntries().forEach(e=>{console.log("FID:",e.processingStart-e.startTime)})}).observe({entryTypes:["first-input"]});let e=0;new PerformanceObserver(t=>{t.getEntries().forEach(t=>{t.hadRecentInput||(e+=t.value)}),console.log("CLS:",e)}).observe({entryTypes:["layout-shift"]})}monitorResourceLoading(){window.addEventListener("load",()=>{const e=performance.getEntriesByType("resource").filter(e=>e.duration>1e3);e.length>0&&console.warn("Slow loading resources:",e)})}monitorMemoryUsage(){"memory"in performance&&setInterval(()=>{const e=performance.memory,t={used:Math.round(e.usedJSHeapSize/1024/1024),total:Math.round(e.totalJSHeapSize/1024/1024),limit:Math.round(e.jsHeapSizeLimit/1024/1024)};t.used/t.limit>.8&&(console.warn("High memory usage:",t),this.cleanupCache())},3e4)}initializeContentLazyLoading(){const e=document.querySelectorAll("[data-lazy-content]");if("IntersectionObserver"in window){const t=new IntersectionObserver(e=>{e.forEach(e=>{e.isIntersecting&&(this.loadLazyContent(e.target),t.unobserve(e.target))})},{rootMargin:"200px"});e.forEach(e=>{t.observe(e)})}else e.forEach(e=>{this.loadLazyContent(e)})}loadLazyContent(e){const t=e.dataset.lazyContent;switch(t){case"tier-list":this.loadTierListContent(e);break;case"team-builder":this.loadTeamBuilderContent(e);break;case"meta-analysis":this.loadMetaAnalysisContent(e);break;default:console.warn("Unknown lazy content type:",t)}}loadTierListContent(e){e.innerHTML='<div class="loading-spinner"></div>',setTimeout(()=>{e.innerHTML='\n        <div class="tier-list-preview">\n          <h3>Interactive Tier List</h3>\n          <p>Drag and drop Palmon to organize your personal tier list.</p>\n          <button class="btn btn-primary">Open Tier List</button>\n        </div>\n      ',e.classList.add("content-loaded")},500)}loadTeamBuilderContent(e){e.innerHTML='<div class="loading-spinner"></div>',setTimeout(()=>{e.innerHTML='\n        <div class="team-builder-preview">\n          <h3>Team Builder</h3>\n          <p>Create and optimize your Palmon team compositions.</p>\n          <button class="btn btn-primary">Build Team</button>\n        </div>\n      ',e.classList.add("content-loaded")},500)}loadMetaAnalysisContent(e){e.innerHTML='<div class="loading-spinner"></div>',setTimeout(()=>{e.innerHTML='\n        <div class="meta-analysis-preview">\n          <h3>Meta Analysis</h3>\n          <p>Explore current meta trends and statistics.</p>\n          <button class="btn btn-primary">View Analysis</button>\n        </div>\n      ',e.classList.add("content-loaded")},500)}loadAllImages(){document.querySelectorAll("img[data-src], [data-background-image]").forEach(e=>{this.loadImage(e)})}preloadImage(e){return this.loadImage({dataset:{src:e}})}clearCache(){if(this.cache.clear(),this.db){const e=this.db.transaction(["images","data"],"readwrite");e.objectStore("images").clear(),e.objectStore("data").clear()}console.log("🧹 Cache cleared")}getPerformanceMetrics(){return{cacheSize:this.cache.size,memoryUsage:performance.memory?{used:Math.round(performance.memory.usedJSHeapSize/1024/1024),total:Math.round(performance.memory.totalJSHeapSize/1024/1024)}:null,connectionType:navigator.connection?navigator.connection.effectiveType:"unknown"}}}class BandwidthMonitor{constructor(){this.measurements=[],this.isMonitoring=!1}init(){"connection"in navigator&&(this.connection=navigator.connection,this.logConnectionInfo(),this.connection.addEventListener("change",()=>{this.logConnectionInfo()})),this.startMonitoring()}logConnectionInfo(){this.connection&&console.log("📡 Connection Info:",{effectiveType:this.connection.effectiveType,downlink:this.connection.downlink,rtt:this.connection.rtt,saveData:this.connection.saveData})}startMonitoring(){this.isMonitoring||(this.isMonitoring=!0,setInterval(()=>{this.measureBandwidth()},6e4))}measureBandwidth(){const e=performance.now(),t=new Image;t.onload=()=>{const t=performance.now()-e,n=8192/(t/1e3);this.measurements.push({timestamp:Date.now(),speed:n,duration:t}),this.measurements.length>10&&this.measurements.shift()},t.src="data:image/gif;base64,R0lGODlhAQABAIAAAAAAAP///yH5BAEAAAAALAAAAAABAAEAAAIBRAA7"}getAverageSpeed(){if(0===this.measurements.length)return null;return this.measurements.reduce((e,t)=>e+t.speed,0)/this.measurements.length}isSlowConnection(){const e=this.getAverageSpeed();return null!==e&&e<1e6}}"loading"===document.readyState?document.addEventListener("DOMContentLoaded",()=>{window.performanceOptimizer=new PerformanceOptimizer}):window.performanceOptimizer=new PerformanceOptimizer,"undefined"!=typeof module&&module.exports&&(module.exports={PerformanceOptimizer:PerformanceOptimizer,BandwidthMonitor:BandwidthMonitor});class SearchEngine{constructor(e){this.dataUtils=e,this.searchIndex=null,this.fuzzyThreshold=.6,this.maxResults=50}initialize(e){this.searchIndex=e,this.buildAdvancedIndex()}buildAdvancedIndex(){this.searchIndex&&(this.trigramIndex=new Map,this.dataUtils.getAllPalmon().forEach(e=>{const t=this.getSearchableText(e);this.generateTrigrams(t).forEach(t=>{this.trigramIndex.has(t)||this.trigramIndex.set(t,new Set),this.trigramIndex.get(t).add(e)})}))}getSearchableText(e){return[e.name,e.element,e.tier,e.role,e.skills.skill1.name,e.skills.skill2.name,e.skills.passive.name,e.skills.skill1.description,e.skills.skill2.description,e.skills.passive.description,e.evolveSkill?.name||"",e.evolveSkill?.description||""].join(" ").toLowerCase()}generateTrigrams(e){const t=new Set;return e.replace(/[^\w\s]/g,"").toLowerCase().split(/\s+/).filter(e=>e.length>2).forEach(e=>{const n=`  ${e}  `;for(let e=0;e<n.length-2;e++)t.add(n.substring(e,e+3))}),Array.from(t)}search(e,t={}){if(!e||!e.trim())return this.dataUtils.getAllPalmon().map(e=>({palmon:e,score:0,matches:[]}));const n=e.toLowerCase().trim(),i=new Map;this.searchExactName(n,i),this.searchPartialName(n,i),this.searchSkillNames(n,i),this.searchDescriptions(n,i),!1!==t.fuzzy&&this.searchFuzzy(n,i);return Array.from(i.values()).sort((e,t)=>t.score-e.score).slice(0,this.maxResults)}searchExactName(e,t){this.dataUtils.getAllPalmon().forEach(n=>{n.name.toLowerCase()===e&&this.addResult(t,n,100,["name:exact"])})}searchPartialName(e,t){this.dataUtils.getAllPalmon().forEach(n=>{const i=n.name.toLowerCase();if(i.includes(e)){const a=e.length/i.length*80;this.addResult(t,n,a,["name:partial"])}})}searchSkillNames(e,t){this.dataUtils.getAllPalmon().forEach(n=>{[n.skills.skill1.name,n.skills.skill2.name,n.skills.passive.name,n.evolveSkill?.name||""].forEach((i,a)=>{if(i.toLowerCase().includes(e)){const e=60-5*a,i=0===a?"skill1":1===a?"skill2":2===a?"passive":"evolve";this.addResult(t,n,e,[`skill:${i}`])}})})}searchDescriptions(e,t){const n=e.split(/\s+/).filter(e=>e.length>2);this.dataUtils.getAllPalmon().forEach(e=>{[e.skills.skill1.description,e.skills.skill2.description,e.skills.passive.description,e.evolveSkill?.description||""].forEach((i,a)=>{const s=i.toLowerCase();let o=0;if(n.forEach(e=>{s.includes(e)&&o++}),o>0){const i=o/n.length*40,s=0===a?"skill1":1===a?"skill2":2===a?"passive":"evolve";this.addResult(t,e,i,[`description:${s}`])}})})}searchFuzzy(e,t){if(!this.trigramIndex||e.length<3)return;const n=this.generateTrigrams(e),i=new Map;n.forEach(e=>{this.trigramIndex.has(e)&&this.trigramIndex.get(e).forEach(e=>{i.set(e.id,(i.get(e.id)||0)+1)})}),i.forEach((e,i)=>{const a=this.dataUtils.getPalmonById(i);if(!a)return;const s=e/n.length;if(s>=this.fuzzyThreshold){const e=30*s;this.addResult(t,a,e,["fuzzy"])}})}addResult(e,t,n,i){if(e.has(t.id)){const a=e.get(t.id);a.score=Math.max(a.score,n),a.matches.push(...i)}else e.set(t.id,{palmon:t,score:n,matches:[...i]})}searchWithHighlighting(e,t={}){const n=this.search(e,t);if(!e||!e.trim())return n;const i=e.toLowerCase().split(/\s+/).filter(e=>e.length>1);return n.map(e=>({...e,highlighted:this.highlightMatches(e.palmon,i)}))}highlightMatches(e,t){const n={...e};return n.name=this.highlightText(e.name,t),n.skills={skill1:{...e.skills.skill1,name:this.highlightText(e.skills.skill1.name,t),description:this.highlightText(e.skills.skill1.description,t)},skill2:{...e.skills.skill2,name:this.highlightText(e.skills.skill2.name,t),description:this.highlightText(e.skills.skill2.description,t)},passive:{...e.skills.passive,name:this.highlightText(e.skills.passive.name,t),description:this.highlightText(e.skills.passive.description,t)}},e.evolveSkill&&(n.evolveSkill={...e.evolveSkill,name:this.highlightText(e.evolveSkill.name,t),description:this.highlightText(e.evolveSkill.description,t)}),n}highlightText(e,t){if(!e||!t.length)return e;let n=e;return t.forEach(e=>{const t=new RegExp(`(${this.escapeRegex(e)})`,"gi");n=n.replace(t,"<mark>$1</mark>")}),n}escapeRegex(e){return e.replace(/[.*+?^${}()|[\]\\]/g,"\\$&")}getSuggestions(e,t=10){if(!e||e.length<2)return[];const n=e.toLowerCase(),i=new Set;return this.dataUtils.getAllPalmon().forEach(e=>{e.name.toLowerCase().startsWith(n)&&i.add(e.name)}),this.dataUtils.getAllPalmon().forEach(e=>{[e.skills.skill1.name,e.skills.skill2.name,e.skills.passive.name].forEach(e=>{e.toLowerCase().startsWith(n)&&i.add(e)})}),Array.from(i).slice(0,t)}rebuildIndex(){this.buildAdvancedIndex()}getStatistics(){return{totalPalmon:this.dataUtils.getAllPalmon().length,indexSize:this.trigramIndex?this.trigramIndex.size:0,fuzzyThreshold:this.fuzzyThreshold,maxResults:this.maxResults}}}export default SearchEngine;import SearchEngine from"./search-engine.js";import FilterEngine from"../filters/filter-engine.js";class SearchFilterManager{constructor(e){this.dataUtils=e,this.searchEngine=new SearchEngine(e),this.filterEngine=new FilterEngine(e),this.lastResults=[],this.isInitialized=!1}initialize(e){this.searchEngine.initialize(e),this.isInitialized=!0}searchAndFilter(e={}){const{query:t="",filters:n={},sort:i={by:"relevance",order:"desc"},options:a={}}=e;let s=[],o=[],r=[];if(t&&t.trim()){o=this.searchEngine.searchWithHighlighting(t,a);const e=o.map(e=>e.palmon);this.applyFiltersFromObject(n),r=this.filterEngine.applyFilters(e),s=this.combineSearchAndFilterResults(o,r,i)}else this.applyFiltersFromObject(n),r=this.filterEngine.applyFilters(),s=this.sortResults(r,i);return this.lastResults=s,{results:s,metadata:{totalResults:s.length,hasSearchQuery:!(!t||!t.trim()),searchQuery:t,activeFilters:this.filterEngine.getActiveFilters(),sortBy:i.by,sortOrder:i.order,searchTime:Date.now(),suggestions:this.getSuggestions(t,s)}}}applyFiltersFromObject(e){this.filterEngine.clearAllFilters(),Object.entries(e).forEach(([e,t])=>{if(t&&"All"!==t){let n="custom";["element","tier","role"].includes(e)?n=e:e.startsWith("stat_")?(n="stat",e=e.replace("stat_","")):e.startsWith("skill_")&&(n="skill",e=e.replace("skill_","")),this.filterEngine.setFilter(n,e,t)}})}combineSearchAndFilterResults(e,t,n){const i=new Set(t.map(e=>e.id)),a=e.filter(e=>i.has(e.palmon.id)).map(e=>({...e,matchedFilters:!0}));return this.sortResults(a,n,!0)}sortResults(e,t,n=!1){const{by:i,order:a}=t;return e.sort((e,t)=>{let s=0;const o=e.palmon||e,r=t.palmon||t;switch(i){case"relevance":s=n?(t.score||0)-(e.score||0):o.name.localeCompare(r.name);break;case"name":default:s=o.name.localeCompare(r.name);break;case"tier":const a={S:5,A:4,B:3,C:2,Economy:1};s=(a[r.tier]||0)-(a[o.tier]||0);break;case"element":s=o.element.localeCompare(r.element);break;case"role":s=o.role.localeCompare(r.role);break;case"damage":case"utility":case"synergy":case"durability":case"economy":s=(r.stats[i]||0)-(o.stats[i]||0)}return"desc"===a?s:-s})}getSuggestions(e,t){const n={search:[],filters:{},related:[]};e&&e.length>=2&&(n.search=this.searchEngine.getSuggestions(e,5));const i=t.map(e=>e.palmon||e);if(n.filters={elements:this.filterEngine.getFilterSuggestions("element",i),tiers:this.filterEngine.getFilterSuggestions("tier",i),roles:this.filterEngine.getFilterSuggestions("role",i)},t.length>0&&t.length<5){const e=t[0].palmon||t[0];n.related=this.dataUtils.findSimilarPalmon(e,3)}return n}quickSearch(e,t=10){if(!e||!e.trim())return this.dataUtils.getAllPalmon().slice(0,t);return this.searchEngine.search(e,{fuzzy:!1}).slice(0,t)}getFilterOptions(){const e=this.dataUtils.getFilterOptions();return{elements:["All",...e.elements],tiers:["All",...e.tiers],roles:["All",...e.roles],stats:["damage","utility","synergy","durability","economy"],sortOptions:[{value:"relevance",label:"Relevance"},{value:"name",label:"Name"},{value:"tier",label:"Tier"},{value:"element",label:"Element"},{value:"role",label:"Role"},{value:"damage",label:"Damage"},{value:"utility",label:"Utility"},{value:"synergy",label:"Synergy"},{value:"durability",label:"Durability"},{value:"economy",label:"Economy"}]}}saveState(e){const t={name:e,filters:this.filterEngine.exportFilters(),timestamp:Date.now()};try{const n=this.getSavedStates();n[e]=t,localStorage.setItem("palmon_search_states",JSON.stringify(n))}catch(e){console.warn("Failed to save search state:",e)}}loadState(e){const t=this.getSavedStates()[e];t&&this.filterEngine.importFilters(t.filters)}getSavedStates(){try{const e=localStorage.getItem("palmon_search_states");return e?JSON.parse(e):{}}catch(e){return console.warn("Failed to load saved states:",e),{}}}reset(){this.filterEngine.clearAllFilters(),this.lastResults=[]}getPerformanceMetrics(){return{search:this.searchEngine.getStatistics(),filter:this.filterEngine.getPerformanceStats(),lastResultCount:this.lastResults.length,isInitialized:this.isInitialized}}updateDataSource(e,t){this.dataUtils=e,this.searchEngine=new SearchEngine(e),this.filterEngine=new FilterEngine(e),this.initialize(t),this.lastResults=[]}}export default SearchFilterManager;class PalmonSelectionPanel{constructor(e,t){this.dataUtils=e,this.teamManager=t,this.container=null,this.searchInput=null,this.filterControls={},this.sortControl=null,this.palmonGrid=null,this.selectedPalmon=new Set,this.currentFilters={search:"",element:"all",role:"all",tier:"all"},this.currentSort="name",this.sortDirection="asc",this.viewMode="grid",this.isVisible=!1}initialize(e){this.container=e,this.render(),this.attachEventListeners(),this.loadPalmonData()}render(){this.container&&(this.container.innerHTML='\n            <div class="palmon-selection-panel">\n                <div class="selection-panel-header">\n                    <div class="panel-title-section">\n                        <h3 class="panel-title">\n                            <span class="panel-icon">📚</span>\n                            Palmon Library\n                        </h3>\n                        <div class="panel-stats">\n                            <span class="stat-item">\n                                <span class="stat-value" id="total-palmon-count">0</span>\n                                <span class="stat-label">Total</span>\n                            </span>\n                            <span class="stat-item">\n                                <span class="stat-value" id="filtered-palmon-count">0</span>\n                                <span class="stat-label">Showing</span>\n                            </span>\n                        </div>\n                    </div>\n                    <div class="panel-controls">\n                        <button class="btn btn-ghost panel-toggle-btn" id="toggle-panel-btn" title="Toggle Panel">\n                            <span class="toggle-icon">📖</span>\n                        </button>\n                        <button class="btn btn-ghost view-mode-btn" id="view-mode-btn" title="Toggle View Mode">\n                            <span class="view-icon">⊞</span>\n                        </button>\n                    </div>\n                </div>\n\n                <div class="selection-panel-content" id="selection-panel-content">\n                    <div class="selection-filters">\n                        <div class="filter-row">\n                            <div class="search-container">\n                                <input \n                                    type="text" \n                                    id="palmon-search" \n                                    class="search-input" \n                                    placeholder="Search Palmon..."\n                                    autocomplete="off"\n                                >\n                                <button class="search-clear-btn" id="search-clear-btn" title="Clear Search">\n                                    <span class="clear-icon">✕</span>\n                                </button>\n                            </div>\n                            <div class="quick-filters">\n                                <button class="quick-filter-btn active" data-filter="all">All</button>\n                                <button class="quick-filter-btn" data-filter="s-tier">S-Tier</button>\n                                <button class="quick-filter-btn" data-filter="favorites">★</button>\n                            </div>\n                        </div>\n\n                        <div class="filter-row">\n                            <div class="filter-group">\n                                <label class="filter-label">Element</label>\n                                <select id="element-filter" class="filter-select">\n                                    <option value="all">All Elements</option>\n                                    <option value="fire">🔥 Fire</option>\n                                    <option value="water">💧 Water</option>\n                                    <option value="earth">🌱 Earth</option>\n                                    <option value="electric">⚡ Electric</option>\n                                </select>\n                            </div>\n\n                            <div class="filter-group">\n                                <label class="filter-label">Role</label>\n                                <select id="role-filter" class="filter-select">\n                                    <option value="all">All Roles</option>\n                                    <option value="tank">🛡️ Tank</option>\n                                    <option value="dps">⚔️ DPS</option>\n                                    <option value="support">💚 Support</option>\n                                    <option value="control">🎯 Control</option>\n                                </select>\n                            </div>\n\n                            <div class="filter-group">\n                                <label class="filter-label">Tier</label>\n                                <select id="tier-filter" class="filter-select">\n                                    <option value="all">All Tiers</option>\n                                    <option value="s">S-Tier</option>\n                                    <option value="a">A-Tier</option>\n                                    <option value="b">B-Tier</option>\n                                    <option value="c">C-Tier</option>\n                                    <option value="economy">Economy</option>\n                                </select>\n                            </div>\n\n                            <div class="filter-group">\n                                <label class="filter-label">Sort</label>\n                                <select id="sort-control" class="filter-select">\n                                    <option value="name">Name</option>\n                                    <option value="tier">Tier</option>\n                                    <option value="element">Element</option>\n                                    <option value="role">Role</option>\n                                </select>\n                                <button class="sort-direction-btn" id="sort-direction-btn" title="Toggle Sort Direction">\n                                    <span class="sort-icon">↑</span>\n                                </button>\n                            </div>\n                        </div>\n                    </div>\n\n                    <div class="palmon-grid-container">\n                        <div class="palmon-grid" id="palmon-grid">\n                            \x3c!-- Palmon cards will be rendered here --\x3e\n                        </div>\n                        <div class="grid-loading" id="grid-loading" style="display: none;">\n                            <div class="loading-spinner"></div>\n                            <span>Loading Palmon...</span>\n                        </div>\n                        <div class="no-results" id="no-results" style="display: none;">\n                            <div class="no-results-icon">🔍</div>\n                            <h4>No Palmon Found</h4>\n                            <p>Try adjusting your search or filter criteria</p>\n                            <button class="btn btn-secondary" id="clear-filters-btn">Clear All Filters</button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ',this.searchInput=this.container.querySelector("#palmon-search"),this.palmonGrid=this.container.querySelector("#palmon-grid"),this.filterControls={element:this.container.querySelector("#element-filter"),role:this.container.querySelector("#role-filter"),tier:this.container.querySelector("#tier-filter")},this.sortControl=this.container.querySelector("#sort-control"))}attachEventListeners(){if(!this.container)return;this.searchInput&&(this.searchInput.addEventListener("input",this.debounce(e=>{this.currentFilters.search=e.target.value.toLowerCase().trim(),this.applyFilters()},300)),this.searchInput.addEventListener("keydown",e=>{"Escape"===e.key&&this.clearSearch()}));const e=this.container.querySelector("#search-clear-btn");e&&e.addEventListener("click",()=>this.clearSearch()),Object.entries(this.filterControls).forEach(([e,t])=>{t&&t.addEventListener("change",t=>{this.currentFilters[e]=t.target.value,this.applyFilters()})}),this.sortControl&&this.sortControl.addEventListener("change",e=>{this.currentSort=e.target.value,this.applyFilters()});const t=this.container.querySelector("#sort-direction-btn");t&&t.addEventListener("click",()=>{this.sortDirection="asc"===this.sortDirection?"desc":"asc";const e=t.querySelector(".sort-icon");e&&(e.textContent="asc"===this.sortDirection?"↑":"↓"),this.applyFilters()});const n=this.container.querySelectorAll(".quick-filter-btn");n.forEach(e=>{e.addEventListener("click",e=>{n.forEach(e=>e.classList.remove("active")),e.target.classList.add("active");const t=e.target.dataset.filter;this.applyQuickFilter(t)})});const i=this.container.querySelector("#toggle-panel-btn");i&&i.addEventListener("click",()=>this.togglePanel());const a=this.container.querySelector("#view-mode-btn");a&&a.addEventListener("click",()=>this.toggleViewMode());const s=this.container.querySelector("#clear-filters-btn");s&&s.addEventListener("click",()=>this.clearAllFilters())}async loadPalmonData(){if(this.dataUtils){this.showLoading(!0);try{const e=this.dataUtils.getAllPalmon();this.updateStats(e.length,e.length),this.applyFilters()}catch(e){console.error("Failed to load Palmon data:",e),this.showError("Failed to load Palmon data")}finally{this.showLoading(!1)}}}applyFilters(){if(!this.dataUtils)return;const e=this.dataUtils.getAllPalmon();let t=[...e];this.currentFilters.search&&(t=t.filter(e=>e.name.toLowerCase().includes(this.currentFilters.search)||(e.skills.skill1?.name||"").toLowerCase().includes(this.currentFilters.search)||(e.skills.skill2?.name||"").toLowerCase().includes(this.currentFilters.search)||(e.skills.passive?.name||"").toLowerCase().includes(this.currentFilters.search))),"all"!==this.currentFilters.element&&(t=t.filter(e=>e.element.toLowerCase()===this.currentFilters.element)),"all"!==this.currentFilters.role&&(t=t.filter(e=>e.role.toLowerCase()===this.currentFilters.role)),"all"!==this.currentFilters.tier&&(t=t.filter(e=>e.tier.toLowerCase()===this.currentFilters.tier)),t=this.sortPalmon(t),this.updateStats(e.length,t.length),this.renderPalmonGrid(t)}applyQuickFilter(e){switch(e){case"all":this.clearAllFilters();break;case"s-tier":this.currentFilters.tier="s",this.filterControls.tier.value="s",this.applyFilters();break;case"favorites":console.log("Favorites filter not yet implemented")}}sortPalmon(e){return e.sort((e,t)=>{let n,i;switch(this.currentSort){case"name":default:n=e.name,i=t.name;break;case"tier":const a={S:0,A:1,B:2,C:3,Economy:4};n=a[e.tier]||5,i=a[t.tier]||5;break;case"element":n=e.element,i=t.element;break;case"role":n=e.role,i=t.role}"string"==typeof n&&"string"==typeof i&&(n=n.toLowerCase(),i=i.toLowerCase());let a=0;return n<i&&(a=-1),n>i&&(a=1),"desc"===this.sortDirection?-a:a})}renderPalmonGrid(e){if(!this.palmonGrid)return;const t=this.container.querySelector("#no-results");if(0===e.length)return this.palmonGrid.style.display="none",void(t&&(t.style.display="flex"));this.palmonGrid.style.display="grid",t&&(t.style.display="none"),this.palmonGrid.innerHTML="",e.forEach(e=>{const t=this.createPalmonMiniCard(e);this.palmonGrid.appendChild(t)}),this.palmonGrid.className=`palmon-grid ${this.viewMode}-view`}createPalmonMiniCard(e){const t=document.createElement("div");t.className="palmon-mini-card",t.dataset.palmonId=e.id,t.draggable=!0;const n=e.tier.toLowerCase(),i=e.element.toLowerCase();return t.innerHTML=`\n            <div class="mini-card-content">\n                <div class="mini-card-portrait">\n                    <div class="portrait-placeholder">\n                        <span class="element-icon" data-element="${i}">\n                            ${this.getElementIcon(e.element)}\n                        </span>\n                    </div>\n                    <div class="tier-indicator">\n                        <span class="tier-badge tier-${n}">${e.tier}</span>\n                    </div>\n                </div>\n                \n                <div class="mini-card-info">\n                    <h4 class="palmon-name">${e.name}</h4>\n                    <div class="palmon-meta">\n                        <span class="role-badge role-${e.role.toLowerCase()}">\n                            ${this.getRoleIcon(e.role)} ${e.role}\n                        </span>\n                    </div>\n                </div>\n                \n                <div class="mini-card-actions">\n                    <button class="quick-add-btn" title="Quick Add to Team" data-action="quick-add">\n                        <span class="add-icon">+</span>\n                    </button>\n                    <button class="details-btn" title="View Details" data-action="details">\n                        <span class="details-icon">ℹ</span>\n                    </button>\n                </div>\n            </div>\n        `,this.attachCardEventListeners(t,e),t}attachCardEventListeners(e,t){e.addEventListener("dragstart",n=>{n.dataTransfer.setData("text/plain",JSON.stringify({type:"palmon",palmon:t})),e.classList.add("dragging")}),e.addEventListener("dragend",()=>{e.classList.remove("dragging")});const n=e.querySelector(".quick-add-btn"),i=e.querySelector(".details-btn");n&&n.addEventListener("click",e=>{e.stopPropagation(),this.quickAddToTeam(t)}),i&&i.addEventListener("click",e=>{e.stopPropagation(),this.showPalmonDetails(t)}),e.addEventListener("click",()=>{this.selectPalmon(t,e)}),e.addEventListener("mouseenter",()=>{this.showQuickPreview(t,e)}),e.addEventListener("mouseleave",()=>{this.hideQuickPreview()})}quickAddToTeam(e){if(!this.teamManager)return;if(!this.teamManager.getActiveTeam()){const e=this.teamManager.createTeam("New Team");console.log("Created new team:",e.name)}const t=this.teamManager.getActiveTeam(),n=t.getEmptySlots();if(0===n.length)return void this.showNotification("Team is full! Remove a Palmon first.","warning");const i=n[0];t.addPalmon(e,i.row,i.position)?(this.showNotification(`${e.name} added to team!`,"success"),this.dispatchTeamUpdateEvent()):this.showNotification("Failed to add Palmon to team","error")}showPalmonDetails(e){console.log("Showing details for:",e.name);const t=`${e.name} (${e.tier}-Tier ${e.element} ${e.role})`;this.showNotification(t,"info")}selectPalmon(e,t){this.selectedPalmon.has(e.id)?(this.selectedPalmon.delete(e.id),t.classList.remove("selected")):(this.selectedPalmon.add(e.id),t.classList.add("selected")),this.updateSelectionActions()}showQuickPreview(e,t){let n=document.querySelector(".palmon-quick-preview");n||(n=document.createElement("div"),n.className="palmon-quick-preview",document.body.appendChild(n)),n.innerHTML=`\n            <div class="preview-header">\n                <h4>${e.name}</h4>\n                <span class="preview-tier tier-${e.tier.toLowerCase()}">${e.tier}</span>\n            </div>\n            <div class="preview-skills">\n                <div class="skill-preview">\n                    <strong>${e.skills.skill1?.name||"Unknown"}</strong>\n                    <p>${this.truncateText(e.skills.skill1?.description||"",60)}</p>\n                </div>\n            </div>\n        `;const i=t.getBoundingClientRect();n.style.left=`${i.right+10}px`,n.style.top=`${i.top}px`,n.style.display="block"}hideQuickPreview(){const e=document.querySelector(".palmon-quick-preview");e&&(e.style.display="none")}updateSelectionActions(){const e=this.selectedPalmon.size;console.log(`${e} Palmon selected`)}clearSearch(){this.searchInput&&(this.searchInput.value="",this.currentFilters.search="",this.applyFilters())}clearAllFilters(){this.currentFilters={search:"",element:"all",role:"all",tier:"all"},this.searchInput&&(this.searchInput.value=""),Object.entries(this.filterControls).forEach(([e,t])=>{t&&(t.value="all")});this.container.querySelectorAll(".quick-filter-btn").forEach(e=>e.classList.remove("active"));const e=this.container.querySelector('[data-filter="all"]');e&&e.classList.add("active"),this.applyFilters()}togglePanel(){this.isVisible=!this.isVisible;const e=this.container.querySelector("#selection-panel-content"),t=this.container.querySelector("#toggle-panel-btn");if(e&&(e.style.display=this.isVisible?"block":"none"),t){const e=t.querySelector(".toggle-icon");e&&(e.textContent=this.isVisible?"📖":"📕")}}toggleViewMode(){this.viewMode="grid"===this.viewMode?"list":"grid";const e=this.container.querySelector("#view-mode-btn");if(e){const t=e.querySelector(".view-icon");t&&(t.textContent="grid"===this.viewMode?"⊞":"☰")}this.applyFilters()}updateStats(e,t){const n=this.container.querySelector("#total-palmon-count"),i=this.container.querySelector("#filtered-palmon-count");n&&(n.textContent=e),i&&(i.textContent=t)}showLoading(e){const t=this.container.querySelector("#grid-loading"),n=this.container.querySelector("#palmon-grid");t&&(t.style.display=e?"flex":"none"),n&&(n.style.display=e?"none":"grid")}showError(e){console.error("PalmonSelectionPanel Error:",e)}showNotification(e,t="info"){const n=document.createElement("div");n.className=`notification notification-${t}`,n.textContent=e,Object.assign(n.style,{position:"fixed",top:"20px",right:"20px",padding:"12px 16px",borderRadius:"6px",color:"white",fontSize:"14px",zIndex:"1000",backgroundColor:"success"===t?"#2ed573":"warning"===t?"#feca57":"error"===t?"#ff4757":"#54a0ff"}),document.body.appendChild(n),setTimeout(()=>{n.remove()},3e3)}dispatchTeamUpdateEvent(){const e=new CustomEvent("teamUpdated",{detail:{source:"palmon-selection-panel"}});document.dispatchEvent(e)}getElementIcon(e){return{Fire:"🔥",Water:"💧",Earth:"🌱",Electric:"⚡"}[e]||"❓"}getRoleIcon(e){return{Tank:"🛡️",DPS:"⚔️",Support:"💚",Control:"🎯"}[e]||"❓"}truncateText(e,t){return!e||e.length<=t?e:e.substring(0,t)+"..."}debounce(e,t){let n;return function(...i){clearTimeout(n),n=setTimeout(()=>{clearTimeout(n),e(...i)},t)}}getSelectedPalmon(){return Array.from(this.selectedPalmon)}clearSelection(){this.selectedPalmon.clear();this.container.querySelectorAll(".palmon-mini-card.selected").forEach(e=>e.classList.remove("selected")),this.updateSelectionActions()}refresh(){this.loadPalmonData()}destroy(){this.container&&(this.container.innerHTML=""),this.selectedPalmon.clear()}}export default PalmonSelectionPanel;class SynergyAnalyzer{constructor(e,t){this.teamManager=e,this.dataUtils=t,this.container=null,this.scoreDisplay=null,this.synergyList=null,this.suggestionsList=null,this.isVisible=!0}initialize(e){this.container=e,this.render(),this.attachEventListeners(),this.updateAnalysis()}render(){this.container&&(this.container.innerHTML='\n            <div class="synergy-analyzer">\n                <div class="analyzer-header">\n                    <div class="analyzer-title">\n                        <h3 class="title-text">\n                            <span class="title-icon">⚡</span>\n                            Team Analysis\n                        </h3>\n                        <button class="btn btn-ghost analyzer-toggle" id="analyzer-toggle" title="Toggle Analysis">\n                            <span class="toggle-icon">📊</span>\n                        </button>\n                    </div>\n                </div>\n\n                <div class="analyzer-content" id="analyzer-content">\n                    \x3c!-- Team Score Section --\x3e\n                    <div class="score-section">\n                        <div class="score-display" id="score-display">\n                            <div class="score-circle">\n                                <div class="score-value" id="score-value">0</div>\n                                <div class="score-label">Team Score</div>\n                            </div>\n                            <div class="score-breakdown" id="score-breakdown">\n                                <div class="breakdown-item">\n                                    <span class="breakdown-label">Base Stats</span>\n                                    <span class="breakdown-value" id="base-stats-score">0</span>\n                                </div>\n                                <div class="breakdown-item">\n                                    <span class="breakdown-label">Synergies</span>\n                                    <span class="breakdown-value" id="synergy-score">0</span>\n                                </div>\n                                <div class="breakdown-item">\n                                    <span class="breakdown-label">Composition</span>\n                                    <span class="breakdown-value" id="composition-score">0</span>\n                                </div>\n                                <div class="breakdown-item">\n                                    <span class="breakdown-label">Tier Bonus</span>\n                                    <span class="breakdown-value" id="tier-score">0</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Synergies Section --\x3e\n                    <div class="synergies-section">\n                        <h4 class="section-title">\n                            <span class="section-icon">🤝</span>\n                            Active Synergies\n                            <span class="synergy-count" id="synergy-count">0</span>\n                        </h4>\n                        <div class="synergies-list" id="synergies-list">\n                            <div class="no-synergies" id="no-synergies">\n                                <div class="no-synergies-icon">💫</div>\n                                <p>Add more Palmon to unlock synergies</p>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Team Stats Section --\x3e\n                    <div class="team-stats-section">\n                        <h4 class="section-title">\n                            <span class="section-icon">📈</span>\n                            Team Statistics\n                        </h4>\n                        <div class="stats-grid" id="stats-grid">\n                            <div class="stat-item">\n                                <div class="stat-bar">\n                                    <div class="stat-fill damage-fill" id="damage-fill" style="width: 0%"></div>\n                                </div>\n                                <div class="stat-info">\n                                    <span class="stat-label">Damage</span>\n                                    <span class="stat-value" id="damage-value">0</span>\n                                </div>\n                            </div>\n                            <div class="stat-item">\n                                <div class="stat-bar">\n                                    <div class="stat-fill utility-fill" id="utility-fill" style="width: 0%"></div>\n                                </div>\n                                <div class="stat-info">\n                                    <span class="stat-label">Utility</span>\n                                    <span class="stat-value" id="utility-value">0</span>\n                                </div>\n                            </div>\n                            <div class="stat-item">\n                                <div class="stat-bar">\n                                    <div class="stat-fill durability-fill" id="durability-fill" style="width: 0%"></div>\n                                </div>\n                                <div class="stat-info">\n                                    <span class="stat-label">Durability</span>\n                                    <span class="stat-value" id="durability-value">0</span>\n                                </div>\n                            </div>\n                            <div class="stat-item">\n                                <div class="stat-bar">\n                                    <div class="stat-fill synergy-fill" id="synergy-fill" style="width: 0%"></div>\n                                </div>\n                                <div class="stat-info">\n                                    <span class="stat-label">Synergy</span>\n                                    <span class="stat-value" id="synergy-stat-value">0</span>\n                                </div>\n                            </div>\n                        </div>\n                    </div>\n\n                    \x3c!-- Suggestions Section --\x3e\n                    <div class="suggestions-section">\n                        <h4 class="section-title">\n                            <span class="section-icon">💡</span>\n                            Suggestions\n                        </h4>\n                        <div class="suggestions-list" id="suggestions-list">\n                            <div class="no-suggestions" id="no-suggestions">\n                                <div class="no-suggestions-icon">🎯</div>\n                                <p>Your team looks good! Try different combinations for more synergies.</p>\n                            </div>\n                        </div>\n                    </div>\n                </div>\n            </div>\n        ',this.scoreDisplay=this.container.querySelector("#score-display"),this.synergyList=this.container.querySelector("#synergies-list"),this.suggestionsList=this.container.querySelector("#suggestions-list"))}attachEventListeners(){if(!this.container)return;const e=this.container.querySelector("#analyzer-toggle");e&&e.addEventListener("click",()=>this.toggleVisibility()),this.teamManager&&(this.teamManager.addEventListener("teamChanged",()=>this.updateAnalysis()),this.teamManager.addEventListener("palmonAdded",()=>this.updateAnalysis()),this.teamManager.addEventListener("palmonRemoved",()=>this.updateAnalysis()))}toggleVisibility(){this.isVisible=!this.isVisible;const e=this.container.querySelector("#analyzer-content"),t=this.container.querySelector(".toggle-icon");e&&(e.style.display=this.isVisible?"block":"none"),t&&(t.textContent=this.isVisible?"📊":"📈")}updateAnalysis(){if(!this.teamManager||!this.dataUtils)return;const e=this.teamManager.getActiveTeam();if(!e)return void this.displayEmptyState();const t=e.getAllPalmon(),n=e.synergyEngine;if(!n)return void console.warn("Synergy engine not available");const i=n.calculateTeamSynergies(t);this.updateScoreDisplay(i,t),this.updateSynergiesList(i),this.updateTeamStats(t),this.updateSuggestions(i)}updateScoreDisplay(e,t){const n=this.container.querySelector("#score-value"),i=this.container.querySelector("#base-stats-score"),a=this.container.querySelector("#synergy-score"),s=this.container.querySelector("#composition-score"),o=this.container.querySelector("#tier-score"),r=this.calculateBaseStatsScore(t),l=e.overallScore,c=this.calculateCompositionScore(t),d=this.calculateTierScore(t),m=Math.min(100,r+l+c+d);n&&this.animateValue(n,parseInt(n.textContent)||0,m),i&&this.animateValue(i,parseInt(i.textContent)||0,r),a&&this.animateValue(a,parseInt(a.textContent)||0,l),s&&this.animateValue(s,parseInt(s.textContent)||0,c),o&&this.animateValue(o,parseInt(o.textContent)||0,d);const h=this.container.querySelector(".score-circle");h&&(h.className=`score-circle ${this.getScoreClass(m)}`)}updateSynergiesList(e){if(!this.synergyList)return;const t=[...e.elementSynergies,...e.roleSynergies,...e.specificSynergies],n=this.container.querySelector("#synergy-count");n&&(n.textContent=t.length),0!==t.length?this.synergyList.innerHTML=t.map(e=>`\n            <div class="synergy-item ${e.type.toLowerCase()}-synergy">\n                <div class="synergy-header">\n                    <div class="synergy-name">\n                        <span class="synergy-type-icon">${this.getSynergyIcon(e.type)}</span>\n                        <span class="synergy-title">${e.name}</span>\n                        <span class="synergy-strength ${e.strength.toLowerCase()}">${e.strength}</span>\n                    </div>\n                    <div class="synergy-score">+${e.score}</div>\n                </div>\n                <div class="synergy-description">${e.description}</div>\n                <div class="synergy-bonus">${e.bonus}</div>\n                <div class="synergy-participants">\n                    ${e.participants.map(e=>`\n                        <span class="participant-tag">${e.name}</span>\n                    `).join("")}\n                </div>\n            </div>\n        `).join(""):this.synergyList.innerHTML='\n                <div class="no-synergies">\n                    <div class="no-synergies-icon">💫</div>\n                    <p>Add more Palmon to unlock synergies</p>\n                </div>\n            '}updateTeamStats(e){if(0===e.length)return void this.resetStatBars();const t=this.calculateTeamStats(e);Object.entries(t).forEach(([e,t])=>{const n=this.container.querySelector(`#${e}-fill`),i=this.container.querySelector(`#${e}-value`);if(n&&i){const e=Math.min(100,t/100*100);n.style.width=`${e}%`,this.animateValue(i,parseInt(i.textContent)||0,t)}})}updateSuggestions(e){if(!this.suggestionsList)return;const t=e.recommendations||[];0!==t.length?this.suggestionsList.innerHTML=t.map(e=>`\n            <div class="suggestion-item ${e.priority}-priority">\n                <div class="suggestion-icon">${this.getSuggestionIcon(e.type)}</div>\n                <div class="suggestion-content">\n                    <div class="suggestion-message">${e.message}</div>\n                    ${e.suggestedPalmon?`\n                        <div class="suggestion-palmon">\n                            ${e.suggestedPalmon.map(e=>`\n                                <span class="suggested-palmon-tag">${e}</span>\n                            `).join("")}\n                        </div>\n                    `:""}\n                </div>\n            </div>\n        `).join(""):this.suggestionsList.innerHTML='\n                <div class="no-suggestions">\n                    <div class="no-suggestions-icon">🎯</div>\n                    <p>Your team looks good! Try different combinations for more synergies.</p>\n                </div>\n            '}displayEmptyState(){this.scoreDisplay&&(this.scoreDisplay.querySelector("#score-value").textContent="0",this.resetScoreBreakdown()),this.synergyList&&(this.synergyList.innerHTML='\n                <div class="no-synergies">\n                    <div class="no-synergies-icon">💫</div>\n                    <p>Add Palmon to your team to see synergies</p>\n                </div>\n            '),this.suggestionsList&&(this.suggestionsList.innerHTML='\n                <div class="no-suggestions">\n                    <div class="no-suggestions-icon">🎯</div>\n                    <p>Build your team to get strategic suggestions</p>\n                </div>\n            '),this.resetStatBars()}calculateBaseStatsScore(e){if(0===e.length)return 0;const t=e.reduce((e,t)=>e+(t.stats?.utility||0)+(t.stats?.damage||0)+(t.stats?.durability||0),0);return Math.min(30,Math.round(t/(3*e.length)))}calculateCompositionScore(e){if(0===e.length)return 0;let t=0;const n=[...new Set(e.map(e=>e.role))];t+=Math.min(15,3*n.length);const i=[...new Set(e.map(e=>e.element))];return t+=Math.min(10,2*i.length),t+=Math.min(10,1.5*e.length),Math.round(t)}calculateTierScore(e){if(0===e.length)return 0;const t={S:10,A:8,B:6,C:4,Economy:2},n=e.reduce((e,n)=>e+(t[n.tier]||0),0);return Math.min(25,Math.round(n/e.length*2.5))}calculateTeamStats(e){if(0===e.length)return{damage:0,utility:0,durability:0,synergy:0};const t=e.reduce((e,t)=>(e.damage+=t.stats?.damage||0,e.utility+=t.stats?.utility||0,e.durability+=t.stats?.durability||0,e.synergy+=t.stats?.synergy||0,e),{damage:0,utility:0,durability:0,synergy:0});return Object.keys(t).forEach(n=>{t[n]=Math.round(t[n]/e.length)}),t}getSynergyIcon(e){return{Element:"🔥",Role:"⚔️",Specific:"✨"}[e]||"🤝"}getSuggestionIcon(e){return{element:"🔥",role:"⚔️",specific:"✨",general:"💡"}[e]||"💡"}getScoreClass(e){return e>=80?"excellent":e>=60?"good":e>=40?"average":"poor"}animateValue(e,t,n){if(!e||t===n)return;const i=performance.now(),a=n-t,s=n=>{const o=n-i,r=Math.min(o/500,1),l=1-Math.pow(1-r,3),c=Math.round(t+a*l);e.textContent=c,r<1&&requestAnimationFrame(s)};requestAnimationFrame(s)}resetScoreBreakdown(){["#base-stats-score","#synergy-score","#composition-score","#tier-score"].forEach(e=>{const t=this.container.querySelector(e);t&&(t.textContent="0")})}resetStatBars(){["damage","utility","durability","synergy"].forEach(e=>{const t=this.container.querySelector(`#${e}-fill`),n=this.container.querySelector(`#${e}-value`);t&&(t.style.width="0%"),n&&(n.textContent="0")})}getCurrentAnalysis(){if(!this.teamManager)return null;const e=this.teamManager.getActiveTeam();if(!e)return null;const t=e.getAllPalmon(),n=e.synergyEngine;return n?n.calculateTeamSynergies(t):null}exportAnalysis(){const e=this.getCurrentAnalysis();return e?{timestamp:(new Date).toISOString(),analysis:e,teamInfo:this.getTeamInfo()}:null}getTeamInfo(){if(!this.teamManager)return null;const e=this.teamManager.getActiveTeam();return e?{id:e.id,name:e.name,palmonCount:e.getAllPalmon().length,created:e.created,lastModified:e.lastModified}:null}}export default SynergyAnalyzer;class SynergyEngine{constructor(e){this.dataUtils=e,this.synergyRules=this.initializeSynergyRules(),this.elementBonuses=this.initializeElementBonuses(),this.roleBonuses=this.initializeRoleBonuses(),this.specificCombos=this.initializeSpecificCombos()}initializeSynergyRules(){return{elementThresholds:{2:{multiplier:1,label:"Basic"},3:{multiplier:1.5,label:"Strong"},4:{multiplier:2,label:"Powerful"}},roleThresholds:{2:{multiplier:1,label:"Basic"},3:{multiplier:1.3,label:"Balanced"},4:{multiplier:1.6,label:"Diverse"}},maxSynergyScore:100,baseTeamScore:50}}initializeElementBonuses(){return{Fire:{name:"Inferno",description:"Fire Palmon deal increased damage",bonuses:{2:{attack:15,description:"+15% Attack"},3:{attack:25,burn:10,description:"+25% Attack, +10% Burn Chance"},4:{attack:35,burn:20,aoe:15,description:"+35% Attack, +20% Burn Chance, +15% AoE Damage"}}},Water:{name:"Tidal Force",description:"Water Palmon gain increased survivability",bonuses:{2:{hp:20,description:"+20% HP"},3:{hp:35,healing:15,description:"+35% HP, +15% Healing"},4:{hp:50,healing:25,shield:20,description:"+50% HP, +25% Healing, +20% Shield Strength"}}},Earth:{name:"Stone Wall",description:"Earth Palmon provide defensive bonuses",bonuses:{2:{defense:15,description:"+15% Defense"},3:{defense:25,resistance:10,description:"+25% Defense, +10% Status Resistance"},4:{defense:35,resistance:20,reflect:15,description:"+35% Defense, +20% Status Resistance, +15% Damage Reflection"}}},Electric:{name:"Storm Surge",description:"Electric Palmon gain critical strike bonuses",bonuses:{2:{crit:10,description:"+10% Critical Rate"},3:{crit:20,speed:15,description:"+20% Critical Rate, +15% Speed"},4:{crit:30,speed:25,chain:20,description:"+30% Critical Rate, +25% Speed, +20% Chain Lightning Chance"}}}}}initializeRoleBonuses(){return{Tank:{name:"Fortress",description:"Tanks protect the team",effect:"Reduces damage taken by all allies",bonus:{teamDefense:10,aggro:25}},DPS:{name:"Assault",description:"DPS units focus fire",effect:"Increases damage when multiple DPS target same enemy",bonus:{focusFire:20,critChain:15}},Support:{name:"Harmony",description:"Support units enhance team performance",effect:"Provides buffs and healing to allies",bonus:{buffPower:25,healingBonus:20}},Control:{name:"Dominance",description:"Control units disable enemies",effect:"Increases crowd control duration and effectiveness",bonus:{ccDuration:30,ccResistance:15}}}}initializeSpecificCombos(){return[{name:"Elite Guard",palmon:["Barkplug","Statchew"],description:"Barkplug's defense reduction synergizes with Statchew's protection",bonus:{defenseReduction:25,teamProtection:20,score:25},requirements:"Both Palmon must be in the team"},{name:"Frost Control",palmon:["Snowkami","Lucidina"],description:"Freeze and dream effects create powerful crowd control",bonus:{ccDuration:40,ccChance:25,score:20},requirements:"Both Palmon must be in the team"},{name:"Electric Storm",palmon:["Barkplug","Thunderclawd","Mantleray"],description:"Triple electric synergy creates devastating chain lightning",bonus:{chainLightning:50,electricDamage:35,score:35},requirements:"All three Electric Palmon must be in the team"},{name:"Aquatic Dominance",palmon:["Ninjump","Dolphriend","Fingenue"],description:"Water mastery provides superior battlefield control",bonus:{waterDamage:30,mobility:25,score:30},requirements:"All three Water Palmon must be in the team"},{name:"Balanced Strike Force",roles:["Tank","DPS","Support","Control"],description:"Perfect role balance maximizes tactical flexibility",bonus:{tacticalFlexibility:40,adaptability:30,score:25},requirements:"One Palmon of each role must be in the team"},{name:"Elemental Mastery",elements:["Fire","Water","Earth","Electric"],description:"All elements represented provides ultimate versatility",bonus:{elementalVersatility:35,resistanceBonus:25,score:20},requirements:"At least one Palmon of each element must be in the team"}]}calculateTeamSynergies(e){if(!e||0===e.length)return this.getEmptySynergyResult();const t={elementSynergies:this.calculateElementSynergies(e),roleSynergies:this.calculateRoleSynergies(e),specificSynergies:this.calculateSpecificSynergies(e),overallScore:0,totalBonuses:{},recommendations:[]};return t.overallScore=this.calculateOverallSynergyScore(t),t.totalBonuses=this.aggregateBonuses(t),t.recommendations=this.generateSynergyRecommendations(e,t),t}calculateElementSynergies(e){const t=[],n=this.countByProperty(e,"element");return Object.entries(n).forEach(([n,i])=>{if(i>=2&&this.elementBonuses[n]){const a=this.elementBonuses[n],s=Math.min(i,4),o=a.bonuses[s];if(o){const r=this.synergyRules.elementThresholds[s];t.push({type:"Element",name:`${a.name} (${n})`,description:a.description,bonus:o.description,participants:e.filter(e=>e.element===n).map(e=>({id:e.id,name:e.name})),strength:r.label,multiplier:r.multiplier,score:this.calculateElementScore(i,n),effects:o})}}}),t}calculateRoleSynergies(e){const t=[],n=this.countByProperty(e,"role"),i=Object.keys(n);if(Object.entries(n).forEach(([n,i])=>{if(i>=2&&this.roleBonuses[n]){const a=this.roleBonuses[n];t.push({type:"Role",name:`${a.name} (${n})`,description:a.description,bonus:a.effect,participants:e.filter(e=>e.role===n).map(e=>({id:e.id,name:e.name})),strength:i>=3?"Strong":"Moderate",score:5*i,effects:a.bonus})}}),i.length>=3){const n=this.synergyRules.roleThresholds[i.length]||this.synergyRules.roleThresholds[4];t.push({type:"Role",name:"Tactical Diversity",description:"Multiple roles provide strategic flexibility",bonus:`${i.length} different roles enhance team adaptability`,participants:e.map(e=>({id:e.id,name:e.name})),strength:n.label,multiplier:n.multiplier,score:8*i.length,effects:{tacticalFlexibility:10*i.length}})}return t}calculateSpecificSynergies(e){const t=[],n=e.map(e=>e.name),i=e.map(e=>e.role),a=e.map(e=>e.element);return this.specificCombos.forEach(s=>{let o=!1,r=[];s.palmon?(o=s.palmon.every(e=>n.includes(e)),o&&(r=e.filter(e=>s.palmon.includes(e.name)))):s.roles?(o=s.roles.every(e=>i.includes(e)),o&&(r=e.filter(e=>s.roles.includes(e.role)))):s.elements&&(o=s.elements.every(e=>a.includes(e)),o&&(r=e.filter(e=>s.elements.includes(e.element)))),o&&t.push({type:"Specific",name:s.name,description:s.description,bonus:this.formatBonusDescription(s.bonus),participants:r.map(e=>({id:e.id,name:e.name})),strength:"Unique",score:s.bonus.score||20,effects:s.bonus,requirements:s.requirements})}),t}calculateOverallSynergyScore(e){let t=0;return e.elementSynergies.forEach(e=>{t+=e.score*(e.multiplier||1)}),e.roleSynergies.forEach(e=>{t+=e.score*(e.multiplier||1)}),e.specificSynergies.forEach(e=>{t+=e.score}),Math.min(t,this.synergyRules.maxSynergyScore)}aggregateBonuses(e){const t={},n=e=>{Object.entries(e).forEach(([e,n])=>{"number"==typeof n&&(t[e]=(t[e]||0)+n)})};return e.elementSynergies.forEach(e=>{e.effects&&n(e.effects)}),e.roleSynergies.forEach(e=>{e.effects&&n(e.effects)}),e.specificSynergies.forEach(e=>{e.effects&&n(e.effects)}),t}generateSynergyRecommendations(e,t){const n=[],i=this.countByProperty(e,"element"),a=this.countByProperty(e,"role");Object.entries(i).forEach(([e,t])=>{2===t&&n.push({type:"element",priority:"high",message:`Add one more ${e} Palmon to unlock stronger ${e} synergy`,suggestedElement:e,currentCount:t,targetCount:3})});const s=Object.keys(a),o=["Tank","DPS","Support","Control"].filter(e=>!s.includes(e));return o.length>0&&e.length<6&&n.push({type:"role",priority:"medium",message:`Consider adding a ${o[0]} for better role balance`,suggestedRole:o[0]}),this.specificCombos.forEach(t=>{if(t.palmon){const i=t.palmon.some(t=>e.some(e=>e.name===t)),a=t.palmon.every(t=>e.some(e=>e.name===t));if(i&&!a){const i=t.palmon.filter(t=>!e.some(e=>e.name===t));n.push({type:"specific",priority:"medium",message:`Add ${i.join(" and ")} to unlock "${t.name}" synergy`,suggestedPalmon:i,comboName:t.name})}}}),n.slice(0,5)}countByProperty(e,t){const n={};return e.forEach(e=>{const i=e[t];n[i]=(n[i]||0)+1}),n}calculateElementScore(e,t){const n=5*e,i=this.getElementMultiplier(t);return Math.round(10+n*i)}getElementMultiplier(e){return{Fire:1.2,Water:1.1,Earth:1,Electric:1.3}[e]||1}formatBonusDescription(e){const t=[];return Object.entries(e).forEach(([e,n])=>{if("score"!==e&&"number"==typeof n){const i=e.replace(/([A-Z])/g," $1").toLowerCase();t.push(`+${n}% ${i}`)}}),t.join(", ")||"Special bonus effects"}getEmptySynergyResult(){return{elementSynergies:[],roleSynergies:[],specificSynergies:[],overallScore:0,totalBonuses:{},recommendations:[]}}analyzeSynergyPotential(e,t){const n=this.calculateTeamSynergies(e),i=[...e,t],a=this.calculateTeamSynergies(i);return{currentScore:n.overallScore,newScore:a.overallScore,improvement:a.overallScore-n.overallScore,newSynergies:this.findNewSynergies(n,a),recommendation:this.getAdditionRecommendation(a.overallScore-n.overallScore)}}findNewSynergies(e,t){const n=new Set([...e.elementSynergies.map(e=>e.name),...e.roleSynergies.map(e=>e.name),...e.specificSynergies.map(e=>e.name)]);return[...t.elementSynergies,...t.roleSynergies,...t.specificSynergies].filter(e=>!n.has(e.name))}getAdditionRecommendation(e){return e>=20?"Excellent addition - significant synergy boost":e>=10?"Good addition - notable synergy improvement":e>=5?"Decent addition - minor synergy benefit":e>0?"Acceptable addition - small synergy gain":"Poor fit - no synergy improvement"}}export default SynergyEngine;class TeamComposition{constructor(e=null,t="New Team"){this.id=e||this.generateId(),this.name=t,this.frontRow=[null,null,null],this.backRow=[null,null,null],this.synergies=[],this.score=0,this.strategy="",this.created=new Date,this.lastModified=new Date,this.metadata={version:"1.0",isValid:!1,warnings:[]}}generateId(){return"team_"+Date.now()+"_"+Math.random().toString(36).substr(2,9)}addPalmon(e,t,n){if(!this.isValidPosition(t,n))return!1;return("front"===t?this.frontRow:this.backRow)[n]=e,this.lastModified=new Date,this.updateTeamAnalysis(),!0}removePalmon(e,t){if(!this.isValidPosition(e,t))return!1;return("front"===e?this.frontRow:this.backRow)[t]=null,this.lastModified=new Date,this.updateTeamAnalysis(),!0}movePalmon(e,t,n,i){if(!this.isValidPosition(e,t)||!this.isValidPosition(n,i))return!1;const a="front"===e?this.frontRow:this.backRow,s="front"===n?this.frontRow:this.backRow,o=a[t];if(!o)return!1;const r=s[i];return s[i]=o,a[t]=r,this.lastModified=new Date,this.updateTeamAnalysis(),!0}isValidPosition(e,t){return("front"===e||"back"===e)&&t>=0&&t<=2&&Number.isInteger(t)}getAllPalmon(){return[...this.frontRow,...this.backRow].filter(e=>null!==e)}getTeamByRows(){return{frontRow:[...this.frontRow],backRow:[...this.backRow]}}isFull(){return 6===this.getAllPalmon().length}isEmpty(){return 0===this.getAllPalmon().length}getEmptySlots(){const e=[];return this.frontRow.forEach((t,n)=>{null===t&&e.push({row:"front",position:n})}),this.backRow.forEach((t,n)=>{null===t&&e.push({row:"back",position:n})}),e}updateTeamAnalysis(){this.synergies=this.calculateSynergies(),this.score=this.calculateTeamScore(),this.metadata.isValid=this.validateTeam(),this.metadata.warnings=this.getTeamWarnings()}calculateSynergies(){const e=[],t=this.getAllPalmon();if(t.length<2)return e;const n=this.calculateElementSynergies(t);e.push(...n);const i=this.calculateRoleSynergies(t);e.push(...i);const a=this.calculateSpecificSynergies(t);return e.push(...a),e}calculateElementSynergies(e){const t=[],n={};return e.forEach(e=>{n[e.element]=(n[e.element]||0)+1}),Object.entries(n).forEach(([n,i])=>{if(i>=2){const a=this.getElementSynergyBonus(n,i);a&&t.push({type:"Element",name:`${n} Synergy`,description:`${i} ${n} Palmon provide ${a.description}`,bonus:a.effect,participants:e.filter(e=>e.element===n).map(e=>e.id),strength:i>=3?"Strong":"Moderate"})}}),t}getElementSynergyBonus(e,t){const n={Fire:{2:{description:"+15% Attack",effect:"attack_boost_15"},3:{description:"+25% Attack",effect:"attack_boost_25"}},Water:{2:{description:"+20% HP",effect:"hp_boost_20"},3:{description:"+35% HP",effect:"hp_boost_35"}},Earth:{2:{description:"+15% Defense",effect:"defense_boost_15"},3:{description:"+25% Defense",effect:"defense_boost_25"}},Electric:{2:{description:"+10% Critical Rate",effect:"crit_boost_10"},3:{description:"+20% Critical Rate",effect:"crit_boost_20"}}}[e];return n?n[Math.min(t,3)]||n[3]:null}calculateRoleSynergies(e){const t=[],n={};e.forEach(e=>{n[e.role]=(n[e.role]||0)+1});const i=Object.keys(n);return i.length>=3&&t.push({type:"Role",name:"Balanced Composition",description:"Diverse team roles provide tactical flexibility",bonus:"tactical_flexibility",participants:e.map(e=>e.id),strength:4===i.length?"Strong":"Moderate"}),n.Tank>=1&&n.DPS>=2&&t.push({type:"Role",name:"Tank Wall",description:"Tank protects DPS units for sustained damage",bonus:"tank_wall_protection",participants:e.filter(e=>"Tank"===e.role||"DPS"===e.role).map(e=>e.id),strength:"Moderate"}),t}calculateSpecificSynergies(e){const t=[],n=e.map(e=>e.name);return[{palmon:["Barkplug","Statchew"],name:"Elite Defense",description:"Barkplug reduces enemy defense while Statchew protects the team",bonus:"elite_defense_combo"},{palmon:["Snowkami","Lucidina"],name:"Crowd Control",description:"Freeze and dream effects create powerful crowd control",bonus:"crowd_control_combo"}].forEach(i=>{i.palmon.every(e=>n.includes(e))&&t.push({type:"Specific",name:i.name,description:i.description,bonus:i.bonus,participants:e.filter(e=>i.palmon.includes(e.name)).map(e=>e.id),strength:"Strong"})}),t}calculateTeamScore(){const e=this.getAllPalmon();if(0===e.length)return 0;let t=0;const n={damage:0,utility:0,synergy:0,durability:0,economy:0};e.forEach(e=>{Object.keys(n).forEach(t=>{n[t]+=e.stats[t]})}),Object.keys(n).forEach(t=>{n[t]=n[t]/e.length}),t+=(n.damage+n.utility+n.durability)/3*.4;const i=10*this.synergies.length;t+=Math.min(i,30);t+=this.calculateCompositionBonus(e);return t+=this.calculateTierBonus(e),Math.min(Math.round(t),100)}calculateCompositionBonus(e){if(e.length<3)return 0;const t=[...new Set(e.map(e=>e.role))],n=[...new Set(e.map(e=>e.element))];let i=0;return i+=Math.min(3*t.length,12),i+=Math.min(2*n.length,8),i}calculateTierBonus(e){const t={S:10,A:8,B:6,C:4,Economy:2},n=e.reduce((e,n)=>e+(t[n.tier]||0),0);return Math.min(n/e.length,10)}validateTeam(){const e=this.getAllPalmon(),t=e.map(e=>e.id),n=[...new Set(t)];return t.length===n.length&&0!==e.length}getTeamWarnings(){const e=[],t=this.getAllPalmon();if(0===t.length)return e.push("Team is empty"),e;const n=t.map(e=>e.id),i=[...new Set(n)];n.length!==i.length&&e.push("Team contains duplicate Palmon"),t.length<3&&e.push("Team has fewer than 3 Palmon - consider adding more for better synergies");const a=t.map(e=>e.role);1===new Set(a).size&&e.push("Team lacks role diversity - consider adding different roles"),!a.includes("Tank")&&t.length>=4&&e.push("Team lacks a Tank - consider adding one for better survivability");return 1===[...new Set(t.map(e=>e.element))].length&&t.length>=4&&e.push("Team lacks element diversity - consider mixing elements for better synergies"),e}getTeamSuggestions(){const e=[],t=this.getAllPalmon();if(0===this.getEmptySlots().length)return e;const n=new Set(t.map(e=>e.role)),i=["Tank","DPS","Support","Control"].filter(e=>!n.has(e));i.length>0&&e.push({type:"role",priority:"high",message:`Consider adding a ${i[0]} for better team balance`,suggestedRole:i[0]});const a={};t.forEach(e=>{a[e.element]=(a[e.element]||0)+1});const s=Object.entries(a).find(([e,t])=>2===t);return s&&e.push({type:"synergy",priority:"medium",message:`Add another ${s[0]} Palmon to unlock stronger synergy`,suggestedElement:s[0]}),e}export(){return{id:this.id,name:this.name,frontRow:this.frontRow.map(e=>e?{id:e.id,name:e.name}:null),backRow:this.backRow.map(e=>e?{id:e.id,name:e.name}:null),synergies:this.synergies,score:this.score,strategy:this.strategy,created:this.created.toISOString(),lastModified:this.lastModified.toISOString(),metadata:this.metadata}}import(e,t){try{return this.id=e.id,this.name=e.name,this.strategy=e.strategy||"",this.created=new Date(e.created),this.lastModified=new Date(e.lastModified),this.frontRow=e.frontRow.map(e=>e?t.getPalmonById(e.id):null),this.backRow=e.backRow.map(e=>e?t.getPalmonById(e.id):null),this.updateTeamAnalysis(),!0}catch(e){return console.error("Failed to import team:",e),!1}}clone(e=null){const t=new TeamComposition(null,e||`${this.name} (Copy)`);return t.frontRow=[...this.frontRow],t.backRow=[...this.backRow],t.strategy=this.strategy,t.updateTeamAnalysis(),t}}export default TeamComposition;import TeamComposition from"./team-composition.js";class TeamManager{constructor(e){this.dataUtils=e,this.teams=new Map,this.activeTeamId=null,this.maxTeams=50,this.storageKey="palmon_teams"}createTeam(e="New Team"){const t=new TeamComposition(null,e);return this.teams.set(t.id,t),this.activeTeamId=t.id,this.saveToStorage(),t}getTeam(e){return this.teams.get(e)||null}getActiveTeam(){return this.activeTeamId?this.teams.get(this.activeTeamId):null}setActiveTeam(e){return!!this.teams.has(e)&&(this.activeTeamId=e,this.saveToStorage(),!0)}getAllTeams(){return Array.from(this.teams.values())}deleteTeam(e){if(!this.teams.has(e))return!1;if(this.teams.delete(e),this.activeTeamId===e){const e=Array.from(this.teams.keys());this.activeTeamId=e.length>0?e[0]:null}return this.saveToStorage(),!0}renameTeam(e,t){const n=this.teams.get(e);return!!n&&(n.name=t,n.lastModified=new Date,this.saveToStorage(),!0)}cloneTeam(e,t=null){const n=this.teams.get(e);if(!n)return null;const i=n.clone(t);return this.teams.set(i.id,i),this.saveToStorage(),i}validateAllTeams(){const e={totalTeams:this.teams.size,validTeams:0,invalidTeams:0,warnings:0,details:[]};return this.teams.forEach((t,n)=>{const i=this.validateTeam(n);e.details.push({teamId:n,teamName:t.name,...i}),i.isValid?e.validTeams++:e.invalidTeams++,e.warnings+=i.warnings.length}),e}validateTeam(e){const t=this.teams.get(e);if(!t)return{isValid:!1,errors:["Team not found"],warnings:[]};const n=[],i=[...t.metadata.warnings];t.getAllPalmon().forEach(e=>{this.dataUtils.getPalmonById(e.id)||n.push(`Invalid Palmon reference: ${e.name} (${e.id})`)});const a=this.validateTeamComposition(t);return n.push(...a.errors),i.push(...a.warnings),{isValid:0===n.length,errors:n,warnings:i,score:t.score,synergyCount:t.synergies.length}}validateTeamComposition(e){const t=[],n=[],i=e.getAllPalmon(),a=i.map(e=>e.id),s=[...new Set(a)];a.length!==s.length&&t.push("Team contains duplicate Palmon"),i.length>6&&t.push("Team exceeds maximum of 6 Palmon"),i.length>0&&i.length<3&&n.push("Team has fewer than 3 Palmon - synergies may be limited");const o=i.map(e=>e.role),r=[...new Set(o)];i.length>=4&&1===r.length&&n.push("Team lacks role diversity");const l=i.map(e=>e.element),c=[...new Set(l)];return i.length>=4&&1===c.length&&n.push("Team lacks element diversity"),{errors:t,warnings:n}}getTeamStatistics(){const e={totalTeams:this.teams.size,averageTeamSize:0,averageScore:0,mostUsedElements:{},mostUsedRoles:{},mostUsedPalmon:{},synergyDistribution:{}};if(0===this.teams.size)return e;let t=0,n=0;return this.teams.forEach(i=>{const a=i.getAllPalmon();t+=a.length,n+=i.score,a.forEach(t=>{e.mostUsedElements[t.element]=(e.mostUsedElements[t.element]||0)+1,e.mostUsedRoles[t.role]=(e.mostUsedRoles[t.role]||0)+1,e.mostUsedPalmon[t.name]=(e.mostUsedPalmon[t.name]||0)+1});const s=i.synergies.length;e.synergyDistribution[s]=(e.synergyDistribution[s]||0)+1}),e.averageTeamSize=t/this.teams.size,e.averageScore=n/this.teams.size,e}findTeamsWithPalmon(e){const t=[];return this.teams.forEach(n=>{n.getAllPalmon().some(t=>t.id===e)&&t.push({team:n,positions:this.getPalmonPositionsInTeam(n,e)})}),t}getPalmonPositionsInTeam(e,t){const n=[];return e.frontRow.forEach((e,i)=>{e&&e.id===t&&n.push({row:"front",position:i})}),e.backRow.forEach((e,i)=>{e&&e.id===t&&n.push({row:"back",position:i})}),n}getTeamRecommendations(e=5){const t=[],n=this.getTeamStatistics(),i=Object.entries(n.mostUsedPalmon).sort(([,e],[,t])=>t-e).slice(0,6).map(([e])=>e);i.length>=3&&t.push({type:"popular",title:"Popular Combination",description:`Try a team with ${i.slice(0,3).join(", ")}`,suggestedPalmon:i.slice(0,3)});return Object.entries(n.mostUsedElements).sort(([,e],[,t])=>t-e).slice(0,2).forEach(([e])=>{t.push({type:"synergy",title:`${e} Synergy Team`,description:`Build a team focused on ${e} element synergies`,suggestedElement:e})}),t.slice(0,e)}saveToStorage(){try{const e={teams:Array.from(this.teams.entries()).map(([e,t])=>[e,t.export()]),activeTeamId:this.activeTeamId,lastSaved:Date.now(),version:"1.0"};localStorage.setItem(this.storageKey,JSON.stringify(e))}catch(e){console.warn("Failed to save teams to storage:",e)}}loadFromStorage(){try{const e=localStorage.getItem(this.storageKey);if(!e)return!1;const t=JSON.parse(e);return this.teams.clear(),t.teams.forEach(([e,t])=>{const n=new TeamComposition;n.import(t,this.dataUtils)&&this.teams.set(e,n)}),this.activeTeamId=t.activeTeamId,this.activeTeamId&&!this.teams.has(this.activeTeamId)&&(this.activeTeamId=null),!0}catch(e){return console.warn("Failed to load teams from storage:",e),!1}}exportAllTeams(){return{teams:Array.from(this.teams.values()).map(e=>e.export()),activeTeamId:this.activeTeamId,exported:(new Date).toISOString(),version:"1.0"}}importTeams(e,t=!1){const n={success:!1,imported:0,errors:[]};try{t||this.teams.clear(),e.teams.forEach((e,i)=>{const a=new TeamComposition;a.import(e,this.dataUtils)?(t&&this.teams.has(a.id)&&(a.id=a.generateId()),this.teams.set(a.id,a),n.imported++):n.errors.push(`Failed to import team at index ${i}`)}),!t&&e.activeTeamId&&this.teams.has(e.activeTeamId)&&(this.activeTeamId=e.activeTeamId),this.saveToStorage(),n.success=!0}catch(e){n.errors.push(`Import failed: ${e.message}`)}return n}clearAllTeams(){this.teams.clear(),this.activeTeamId=null,this.saveToStorage()}getStorageInfo(){try{const e=localStorage.getItem(this.storageKey);return{hasData:!!e,dataSize:e?e.length:0,teamCount:this.teams.size,maxTeams:this.maxTeams,storageKey:this.storageKey}}catch(e){return{hasData:!1,dataSize:0,teamCount:0,maxTeams:this.maxTeams,error:e.message}}}}export default TeamManager;import TeamSharingExport from"./team-sharing.js";class TeamSaveShareUI{constructor(e,t){this.teamManager=e,this.dataUtils=t,this.sharingExport=new TeamSharingExport(e,t),this.container=null,this.isInitialized=!1}initialize(e){this.isInitialized||(this.container=e,this.render(),this.attachEventListeners(),this.handleSharedTeamOnLoad(),this.isInitialized=!0)}render(){this.container&&(this.container.innerHTML=this.generateHTML(),this.updateTeamList())}generateHTML(){return'\n            <div class="team-save-share-panel">\n                <div class="panel-header">\n                    <h3 class="panel-title">\n                        <span class="panel-icon">💾</span>\n                        Team Management\n                    </h3>\n                </div>\n\n                <div class="panel-content">\n                    \x3c!-- Current Team Actions --\x3e\n                    <div class="current-team-section">\n                        <h4 class="section-title">Current Team</h4>\n                        <div class="current-team-info">\n                            <div class="team-name-display">\n                                <span id="current-team-name">No team selected</span>\n                                <button class="btn-icon" id="edit-team-name-btn" title="Edit team name">\n                                    <span>✏️</span>\n                                </button>\n                            </div>\n                            <div class="team-meta">\n                                <span id="current-team-score">Score: --</span>\n                                <span id="current-team-size">Size: 0/6</span>\n                            </div>\n                        </div>\n\n                        <div class="team-actions">\n                            <button class="btn btn-primary" id="save-team-btn">\n                                <span class="btn-icon">💾</span>\n                                Save Team\n                            </button>\n                            <button class="btn btn-secondary" id="new-team-btn">\n                                <span class="btn-icon">➕</span>\n                                New Team\n                            </button>\n                        </div>\n                    </div>\n\n                    \x3c!-- Saved Teams List --\x3e\n                    <div class="saved-teams-section">\n                        <div class="section-header">\n                            <h4 class="section-title">Saved Teams</h4>\n                            <span class="team-count" id="saved-teams-count">0 teams</span>\n                        </div>\n                        <div class="saved-teams-list" id="saved-teams-list">\n                            \x3c!-- Saved teams will be rendered here --\x3e\n                        </div>\n                    </div>\n\n                    \x3c!-- Share & Export Section --\x3e\n                    <div class="share-export-section">\n                        <h4 class="section-title">Share & Export</h4>\n                        <div class="share-actions">\n                            <button class="btn btn-ghost" id="share-url-btn">\n                                <span class="btn-icon">🔗</span>\n                                Share URL\n                            </button>\n                            <button class="btn btn-ghost" id="export-json-btn">\n                                <span class="btn-icon">📄</span>\n                                Export JSON\n                            </button>\n                            <button class="btn btn-ghost" id="export-text-btn">\n                                <span class="btn-icon">📝</span>\n                                Export Text\n                            </button>\n                            <button class="btn btn-ghost" id="export-image-btn">\n                                <span class="btn-icon">🖼️</span>\n                                Export Image\n                            </button>\n                        </div>\n                    </div>\n\n                    \x3c!-- Import Section --\x3e\n                    <div class="import-section">\n                        <h4 class="section-title">Import Team</h4>\n                        <div class="import-actions">\n                            <input type="file" id="import-file-input" accept=".json" style="display: none;">\n                            <button class="btn btn-ghost" id="import-file-btn">\n                                <span class="btn-icon">📁</span>\n                                Import from File\n                            </button>\n                            <button class="btn btn-ghost" id="import-url-btn">\n                                <span class="btn-icon">🔗</span>\n                                Import from URL\n                            </button>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            \x3c!-- Team Name Edit Modal --\x3e\n            <div class="modal" id="team-name-modal" style="display: none;">\n                <div class="modal-backdrop"></div>\n                <div class="modal-container">\n                    <div class="modal-header">\n                        <h3 class="modal-title">Edit Team Name</h3>\n                        <button class="modal-close-btn" id="close-name-modal">✕</button>\n                    </div>\n                    <div class="modal-body">\n                        <div class="form-group">\n                            <label for="team-name-input">Team Name:</label>\n                            <input type="text" id="team-name-input" class="form-input" maxlength="50" placeholder="Enter team name">\n                        </div>\n                    </div>\n                    <div class="modal-footer">\n                        <button class="btn btn-ghost" id="cancel-name-edit">Cancel</button>\n                        <button class="btn btn-primary" id="save-name-edit">Save</button>\n                    </div>\n                </div>\n            </div>\n\n            \x3c!-- Share URL Modal --\x3e\n            <div class="modal" id="share-url-modal" style="display: none;">\n                <div class="modal-backdrop"></div>\n                <div class="modal-container">\n                    <div class="modal-header">\n                        <h3 class="modal-title">Share Team URL</h3>\n                        <button class="modal-close-btn" id="close-share-modal">✕</button>\n                    </div>\n                    <div class="modal-body">\n                        <div class="form-group">\n                            <label for="share-url-input">Shareable URL:</label>\n                            <div class="url-input-group">\n                                <input type="text" id="share-url-input" class="form-input" readonly>\n                                <button class="btn btn-secondary" id="copy-url-btn">\n                                    <span class="btn-icon">📋</span>\n                                    Copy\n                                </button>\n                            </div>\n                        </div>\n                        <div class="share-info">\n                            <p>Share this URL with others to let them view and import your team composition.</p>\n                        </div>\n                    </div>\n                </div>\n            </div>\n\n            \x3c!-- Import URL Modal --\x3e\n            <div class="modal" id="import-url-modal" style="display: none;">\n                <div class="modal-backdrop"></div>\n                <div class="modal-container">\n                    <div class="modal-header">\n                        <h3 class="modal-title">Import Team from URL</h3>\n                        <button class="modal-close-btn" id="close-import-modal">✕</button>\n                    </div>\n                    <div class="modal-body">\n                        <div class="form-group">\n                            <label for="import-url-input">Team URL:</label>\n                            <input type="text" id="import-url-input" class="form-input" placeholder="Paste team URL here">\n                        </div>\n                    </div>\n                    <div class="modal-footer">\n                        <button class="btn btn-ghost" id="cancel-import">Cancel</button>\n                        <button class="btn btn-primary" id="import-team-btn">Import Team</button>\n                    </div>\n                </div>\n            </div>\n        '}attachEventListeners(){this.attachCurrentTeamListeners(),this.attachShareExportListeners(),this.attachImportListeners(),this.attachModalListeners()}attachCurrentTeamListeners(){const e=document.getElementById("save-team-btn"),t=document.getElementById("new-team-btn"),n=document.getElementById("edit-team-name-btn");e&&e.addEventListener("click",()=>this.saveCurrentTeam()),t&&t.addEventListener("click",()=>this.createNewTeam()),n&&n.addEventListener("click",()=>this.showEditNameModal())}attachShareExportListeners(){const e=document.getElementById("share-url-btn"),t=document.getElementById("export-json-btn"),n=document.getElementById("export-text-btn"),i=document.getElementById("export-image-btn");e&&e.addEventListener("click",()=>this.showShareUrlModal()),t&&t.addEventListener("click",()=>this.exportCurrentTeamJson()),n&&n.addEventListener("click",()=>this.exportCurrentTeamText()),i&&i.addEventListener("click",()=>this.exportCurrentTeamImage())}attachImportListeners(){const e=document.getElementById("import-file-btn"),t=document.getElementById("import-file-input"),n=document.getElementById("import-url-btn");e&&t&&(e.addEventListener("click",()=>t.click()),t.addEventListener("change",e=>this.handleFileImport(e))),n&&n.addEventListener("click",()=>this.showImportUrlModal())}attachModalListeners(){const e=document.getElementById("team-name-modal"),t=document.getElementById("close-name-modal"),n=document.getElementById("cancel-name-edit"),i=document.getElementById("save-name-edit");t&&t.addEventListener("click",()=>this.hideModal(e)),n&&n.addEventListener("click",()=>this.hideModal(e)),i&&i.addEventListener("click",()=>this.saveTeamName());const a=document.getElementById("share-url-modal"),s=document.getElementById("close-share-modal"),o=document.getElementById("copy-url-btn");s&&s.addEventListener("click",()=>this.hideModal(a)),o&&o.addEventListener("click",()=>this.copyShareUrl());const r=document.getElementById("import-url-modal"),l=document.getElementById("close-import-modal"),c=document.getElementById("cancel-import"),d=document.getElementById("import-team-btn");l&&l.addEventListener("click",()=>this.hideModal(r)),c&&c.addEventListener("click",()=>this.hideModal(r)),d&&d.addEventListener("click",()=>this.importTeamFromUrl()),document.addEventListener("click",e=>{if(e.target.classList.contains("modal-backdrop")){const t=e.target.closest(".modal");t&&this.hideModal(t)}})}updateCurrentTeamDisplay(){const e=this.teamManager.getActiveTeam(),t=document.getElementById("current-team-name"),n=document.getElementById("current-team-score"),i=document.getElementById("current-team-size");if(t&&(t.textContent=e?e.name:"No team selected"),n&&(n.textContent=e?`Score: ${e.score}/100`:"Score: --"),i){const t=e?e.getAllPalmon().length:0;i.textContent=`Size: ${t}/6`}}updateTeamList(){const e=document.getElementById("saved-teams-list"),t=document.getElementById("saved-teams-count");if(!e)return;const n=this.teamManager.getAllTeams(),i=this.teamManager.getActiveTeam();t&&(t.textContent=`${n.length} team${1!==n.length?"s":""}`),0!==n.length?(e.innerHTML=n.map(e=>this.generateTeamListItem(e,i)).join(""),this.attachTeamListListeners()):e.innerHTML='\n                <div class="empty-state">\n                    <span class="empty-icon">📝</span>\n                    <p>No saved teams yet</p>\n                    <p class="empty-hint">Create and save your first team!</p>\n                </div>\n            '}generateTeamListItem(e,t){const n=t&&t.id===e.id,i=e.getAllPalmon().length,a=e.lastModified.toLocaleDateString();return`\n            <div class="team-list-item ${n?"active":""}" data-team-id="${e.id}">\n                <div class="team-item-header">\n                    <div class="team-item-info">\n                        <h5 class="team-item-name">${e.name}</h5>\n                        <div class="team-item-meta">\n                            <span class="team-score">Score: ${e.score}</span>\n                            <span class="team-size">${i}/6</span>\n                            <span class="team-date">${a}</span>\n                        </div>\n                    </div>\n                    <div class="team-item-actions">\n                        <button class="btn-icon load-team-btn" data-team-id="${e.id}" title="Load team">\n                            <span>📂</span>\n                        </button>\n                        <button class="btn-icon clone-team-btn" data-team-id="${e.id}" title="Clone team">\n                            <span>📋</span>\n                        </button>\n                        <button class="btn-icon delete-team-btn" data-team-id="${e.id}" title="Delete team">\n                            <span>🗑️</span>\n                        </button>\n                    </div>\n                </div>\n                ${i>0?this.generateTeamPreview(e):""}\n            </div>\n        `}generateTeamPreview(e){const t=e.getAllPalmon();if(0===t.length)return"";const n=t.slice(0,4),i=Math.max(0,t.length-4);return`\n            <div class="team-preview">\n                <div class="preview-palmon">\n                    ${n.map(e=>`\n                        <div class="preview-palmon-card" title="${e.name}">\n                            <span class="preview-element-icon" data-element="${e.element.toLowerCase()}">\n                                ${this.getElementIcon(e.element)}\n                            </span>\n                            <span class="preview-palmon-name">${e.name}</span>\n                        </div>\n                    `).join("")}\n                    ${i>0?`<div class="preview-more">+${i}</div>`:""}\n                </div>\n            </div>\n        `}getElementIcon(e){return{Fire:"🔥",Water:"💧",Earth:"🌱",Electric:"⚡"}[e]||"❓"}attachTeamListListeners(){document.querySelectorAll(".load-team-btn").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.dataset.teamId;this.loadTeam(n)})}),document.querySelectorAll(".clone-team-btn").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.dataset.teamId;this.cloneTeam(n)})}),document.querySelectorAll(".delete-team-btn").forEach(e=>{e.addEventListener("click",t=>{t.stopPropagation();const n=e.dataset.teamId;this.deleteTeam(n)})})}saveCurrentTeam(){const e=this.teamManager.getActiveTeam();e?0!==e.getAllPalmon().length?(this.showNotification(`Team "${e.name}" saved successfully!`,"success"),this.updateTeamList()):this.showNotification("Cannot save empty team","warning"):this.showNotification("No active team to save","warning")}createNewTeam(){const e=this.teamManager.createTeam();this.updateCurrentTeamDisplay(),this.updateTeamList(),this.showNotification(`New team "${e.name}" created!`,"success"),this.dispatchTeamChangeEvent(e)}loadTeam(e){if(this.teamManager.setActiveTeam(e)){const t=this.teamManager.getTeam(e);this.updateCurrentTeamDisplay(),this.updateTeamList(),this.showNotification(`Loaded team "${t.name}"`,"success"),this.dispatchTeamChangeEvent(t)}else this.showNotification("Failed to load team","error")}cloneTeam(e){const t=this.teamManager.cloneTeam(e);t?(this.teamManager.setActiveTeam(t.id),this.updateCurrentTeamDisplay(),this.updateTeamList(),this.showNotification(`Team cloned as "${t.name}"`,"success"),this.dispatchTeamChangeEvent(t)):this.showNotification("Failed to clone team","error")}deleteTeam(e){const t=this.teamManager.getTeam(e);if(t&&confirm(`Are you sure you want to delete "${t.name}"?`))if(this.teamManager.deleteTeam(e)){this.updateCurrentTeamDisplay(),this.updateTeamList(),this.showNotification(`Team "${t.name}" deleted`,"success");const e=this.teamManager.getActiveTeam();this.dispatchTeamChangeEvent(e)}else this.showNotification("Failed to delete team","error")}showEditNameModal(){const e=this.teamManager.getActiveTeam();if(!e)return void this.showNotification("No active team to rename","warning");const t=document.getElementById("team-name-modal"),n=document.getElementById("team-name-input");n&&(n.value=e.name),this.showModal(t)}saveTeamName(){const e=this.teamManager.getActiveTeam(),t=document.getElementById("team-name-input"),n=document.getElementById("team-name-modal");if(!e||!t)return;const i=t.value.trim();i?this.teamManager.renameTeam(e.id,i)?(this.updateCurrentTeamDisplay(),this.updateTeamList(),this.hideModal(n),this.showNotification(`Team renamed to "${i}"`,"success")):this.showNotification("Failed to rename team","error"):this.showNotification("Team name cannot be empty","warning")}showShareUrlModal(){const e=this.teamManager.getActiveTeam();if(!e)return void this.showNotification("No active team to share","warning");if(0===e.getAllPalmon().length)return void this.showNotification("Cannot share empty team","warning");const t=this.sharingExport.generateShareableUrl(e.id);if(!t)return void this.showNotification("Failed to generate share URL","error");const n=document.getElementById("share-url-modal"),i=document.getElementById("share-url-input");i&&(i.value=t),this.showModal(n)}async copyShareUrl(){const e=document.getElementById("share-url-input");if(!e)return;await this.sharingExport.copyToClipboard(e.value)?this.showNotification("Share URL copied to clipboard!","success"):this.showNotification("Failed to copy URL","error")}exportCurrentTeamJson(){const e=this.teamManager.getActiveTeam();e?(this.sharingExport.downloadTeamJson(e.id),this.showNotification("Team exported as JSON file","success")):this.showNotification("No active team to export","warning")}exportCurrentTeamText(){const e=this.teamManager.getActiveTeam();e?(this.sharingExport.downloadTeamText(e.id),this.showNotification("Team exported as text file","success")):this.showNotification("No active team to export","warning")}async exportCurrentTeamImage(){const e=this.teamManager.getActiveTeam();if(e)try{await this.sharingExport.downloadTeamImage(e.id),this.showNotification("Team exported as image file","success")}catch(e){this.showNotification("Failed to export team image","error")}else this.showNotification("No active team to export","warning")}async handleFileImport(e){const t=e.target.files[0];if(t){try{const e=await t.text(),n=JSON.parse(e);if("palmon_team"===n.exportType&&n.team){const e=this.teamManager.createTeam(n.team.name+" (Imported)");e.import(n.team,this.dataUtils)?(this.teamManager.setActiveTeam(e.id),this.updateCurrentTeamDisplay(),this.updateTeamList(),this.showNotification(`Team "${e.name}" imported successfully!`,"success"),this.dispatchTeamChangeEvent(e)):this.showNotification("Failed to import team data","error")}else this.showNotification("Invalid team file format","error")}catch(e){this.showNotification("Failed to read team file","error")}e.target.value=""}}showImportUrlModal(){const e=document.getElementById("import-url-modal"),t=document.getElementById("import-url-input");t&&(t.value=""),this.showModal(e)}importTeamFromUrl(){const e=document.getElementById("import-url-input"),t=document.getElementById("import-url-modal");if(!e)return;const n=e.value.trim();if(n)try{const e=n.match(/team=([^&]+)/);if(!e)return void this.showNotification("Invalid team URL format","error");const i=this.sharingExport.loadTeamFromUrl(e[1]);i?(this.teamManager.setActiveTeam(i.id),this.updateCurrentTeamDisplay(),this.updateTeamList(),this.hideModal(t),this.showNotification(`Team "${i.name}" imported successfully!`,"success"),this.dispatchTeamChangeEvent(i)):this.showNotification("Failed to import team from URL","error")}catch(e){this.showNotification("Invalid team URL","error")}else this.showNotification("Please enter a team URL","warning")}handleSharedTeamOnLoad(){const e=this.sharingExport.handleSharedTeamUrl();e&&(this.teamManager.setActiveTeam(e.id),this.updateCurrentTeamDisplay(),this.updateTeamList(),this.showNotification(`Shared team "${e.name}" loaded!`,"success"),this.dispatchTeamChangeEvent(e))}showModal(e){e&&(e.style.display="block",document.body.style.overflow="hidden")}hideModal(e){e&&(e.style.display="none",document.body.style.overflow="")}dispatchTeamChangeEvent(e){const t=new CustomEvent("teamChanged",{detail:{team:e}});document.dispatchEvent(t)}showNotification(e,t="info"){const n=document.createElement("div");n.className=`notification notification-${t}`,n.textContent=e;const i={info:"#54a0ff",error:"#ff4757",success:"#2ed573",warning:"#feca57"};n.style.cssText=`\n            position: fixed;\n            top: 20px;\n            right: 20px;\n            background: ${i[t]||i.info};\n            color: white;\n            padding: 12px 16px;\n            border-radius: 8px;\n            box-shadow: 0 4px 12px rgba(0,0,0,0.3);\n            z-index: 10000;\n            max-width: 300px;\n            font-size: 14px;\n            font-weight: 500;\n            animation: slideInRight 0.3s ease-out;\n        `,document.body.appendChild(n),setTimeout(()=>{n.style.animation="slideOutRight 0.3s ease-in",setTimeout(()=>{n.parentNode&&n.parentNode.removeChild(n)},300)},4e3)}onTeamChange(){this.updateCurrentTeamDisplay(),this.updateTeamList()}}export default TeamSaveShareUI;class TeamSharingExport{constructor(e,t){this.teamManager=e,this.dataUtils=t,this.baseUrl=window.location.origin+window.location.pathname}generateShareableUrl(e){const t=this.teamManager.getTeam(e);if(!t)return null;try{const e=this.createShareData(t),n=this.encodeTeamData(e);return`${this.baseUrl}#team=${n}`}catch(e){return console.error("Failed to generate shareable URL:",e),null}}createShareData(e){return{n:e.name,f:e.frontRow.map(e=>e?e.id:null),b:e.backRow.map(e=>e?e.id:null),s:e.strategy,v:"1.0"}}encodeTeamData(e){try{const t=JSON.stringify(e);return btoa(t).replace(/[+/=]/g,e=>({"+":"-","/":"_","=":""}[e]))}catch(e){throw new Error("Failed to encode team data")}}decodeTeamData(e){try{const t=e.replace(/[-_]/g,e=>({"-":"+",_:"/"}[e])),n=t+"=".repeat((4-t.length%4)%4),i=atob(n);return JSON.parse(i)}catch(e){return console.error("Failed to decode team data:",e),null}}loadTeamFromUrl(e){const t=this.decodeTeamData(e);if(!t)return null;try{const e=this.teamManager.createTeam(t.n||"Shared Team");return t.f.forEach((t,n)=>{if(t){const i=this.dataUtils.getPalmonById(t);i&&e.addPalmon(i,"front",n)}}),t.b.forEach((t,n)=>{if(t){const i=this.dataUtils.getPalmonById(t);i&&e.addPalmon(i,"back",n)}}),e.strategy=t.s||"",e}catch(e){return console.error("Failed to load team from URL:",e),null}}exportTeamAsJson(e){const t=this.teamManager.getTeam(e);return t?{exportType:"palmon_team",version:"1.0",exportDate:(new Date).toISOString(),team:t.export(),metadata:{appVersion:"1.0",totalPalmon:t.getAllPalmon().length,teamScore:t.score,synergyCount:t.synergies.length}}:null}exportTeamAsText(e){const t=this.teamManager.getTeam(e);if(!t)return null;const n=[];return n.push(`=== ${t.name} ===`),n.push(`Score: ${t.score}/100`),n.push(`Created: ${t.created.toLocaleDateString()}`),n.push(""),n.push("FRONT ROW:"),t.frontRow.forEach((e,t)=>{e?n.push(`  ${t+1}. ${e.name} (${e.tier}-Tier ${e.element} ${e.role})`):n.push(`  ${t+1}. [Empty]`)}),n.push(""),n.push("BACK ROW:"),t.backRow.forEach((e,t)=>{e?n.push(`  ${t+4}. ${e.name} (${e.tier}-Tier ${e.element} ${e.role})`):n.push(`  ${t+4}. [Empty]`)}),t.synergies.length>0&&(n.push(""),n.push("SYNERGIES:"),t.synergies.forEach(e=>{n.push(`  • ${e.name}: ${e.description}`)})),t.strategy&&(n.push(""),n.push("STRATEGY:"),n.push(t.strategy)),n.push(""),n.push("Generated by Palmon Masters - https://palmon-masters.com"),n.join("\n")}async exportTeamAsImage(e){const t=this.teamManager.getTeam(e);if(!t)return null;try{const e=document.createElement("canvas"),n=e.getContext("2d");e.width=800,e.height=600,n.fillStyle="#1a1a2e",n.fillRect(0,0,e.width,e.height),n.fillStyle="#ffffff",n.font="bold 24px Arial",n.textAlign="center",n.fillText(t.name,e.width/2,40),n.font="18px Arial",n.fillText(`Score: ${t.score}/100`,e.width/2,70);const i=120,a=80,s=(e.width-3*i)/2,o=120,r=220;return this.drawTeamRow(n,t.frontRow,s,o,i,a,"FRONT ROW"),this.drawTeamRow(n,t.backRow,s,r,i,a,"BACK ROW"),t.synergies.length>0&&(n.fillStyle="#feca57",n.font="bold 16px Arial",n.textAlign="left",n.fillText("SYNERGIES:",50,350),n.fillStyle="#ffffff",n.font="14px Arial",t.synergies.slice(0,5).forEach((e,t)=>{n.fillText(`• ${e.name}`,50,380+25*t)})),n.fillStyle="#8395a7",n.font="12px Arial",n.textAlign="center",n.fillText("Generated by Palmon Masters",e.width/2,e.height-20),e.toDataURL("image/png")}catch(e){return console.error("Failed to export team as image:",e),null}}drawTeamRow(e,t,n,i,a,s,o){e.fillStyle="#a2d2ff",e.font="bold 14px Arial",e.textAlign="center",e.fillText(o,n+1.5*a,i-10),t.forEach((t,o)=>{const r=n+o*a;e.fillStyle=t?"#16213e":"#0f1419",e.fillRect(r,i,a-10,s),e.strokeStyle=t?"#feca57":"#2c3e50",e.lineWidth=2,e.strokeRect(r,i,a-10,s),t?(e.fillStyle="#ffffff",e.font="bold 12px Arial",e.textAlign="center",e.fillText(t.name,r+(a-10)/2,i+20),e.font="10px Arial",e.fillStyle=this.getTierColor(t.tier),e.fillText(`${t.tier}-Tier`,r+(a-10)/2,i+35),e.fillStyle=this.getElementColor(t.element),e.fillText(t.element,r+(a-10)/2,i+50),e.fillStyle="#8395a7",e.fillText(t.role,r+(a-10)/2,i+65)):(e.fillStyle="#5a6c7d",e.font="12px Arial",e.textAlign="center",e.fillText("[Empty]",r+(a-10)/2,i+s/2))})}getTierColor(e){return{S:"#ff4757",A:"#feca57",B:"#54a0ff",C:"#8395a7",Economy:"#2ed573"}[e]||"#8395a7"}getElementColor(e){return{Fire:"#e94560",Water:"#54a0ff",Earth:"#2ed573",Electric:"#feca57"}[e]||"#8395a7"}async copyToClipboard(e){try{if(navigator.clipboard&&window.isSecureContext)return await navigator.clipboard.writeText(e),!0;{const t=document.createElement("textarea");t.value=e,t.style.position="fixed",t.style.left="-999999px",t.style.top="-999999px",document.body.appendChild(t),t.focus(),t.select();const n=document.execCommand("copy");return t.remove(),n}}catch(e){return console.error("Failed to copy to clipboard:",e),!1}}downloadFile(e,t,n="text/plain"){try{const i=new Blob([e],{type:n}),a=URL.createObjectURL(i),s=document.createElement("a");s.href=a,s.download=t,s.style.display="none",document.body.appendChild(s),s.click(),document.body.removeChild(s),URL.revokeObjectURL(a)}catch(e){console.error("Failed to download file:",e)}}downloadTeamJson(e){const t=this.exportTeamAsJson(e);if(!t)return;const n=`${t.team.name.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_team.json`;this.downloadFile(JSON.stringify(t,null,2),n,"application/json")}downloadTeamText(e){const t=this.teamManager.getTeam(e);if(!t)return;const n=this.exportTeamAsText(e),i=`${t.name.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_team.txt`;this.downloadFile(n,i,"text/plain")}async downloadTeamImage(e){const t=this.teamManager.getTeam(e);if(t)try{const n=await this.exportTeamAsImage(e);if(!n)return;const i=await fetch(n),a=await i.blob(),s=URL.createObjectURL(a),o=document.createElement("a");o.href=s,o.download=`${t.name.replace(/[^a-z0-9]/gi,"_").toLowerCase()}_team.png`,o.style.display="none",document.body.appendChild(o),o.click(),document.body.removeChild(o),URL.revokeObjectURL(s)}catch(e){console.error("Failed to download team image:",e)}}getSharedTeamFromUrl(){const e=window.location.hash.match(/team=([^&]+)/);return e?e[1]:null}handleSharedTeamUrl(){const e=this.getSharedTeamFromUrl();if(!e)return null;const t=this.loadTeamFromUrl(e);return t?(window.history.replaceState(null,null,window.location.pathname),t):null}}export default TeamSharingExport;class DataUtils{constructor(){this.palmonData=null,this.processedPalmonData=null,this.tierData=this.initializeTierData(),this.searchIndex=null}initializeTierData(){return{Barkplug:{tier:"S",element:"Electric",role:"Support"},Statchew:{tier:"S",element:"Earth",role:"Tank"},Escarffier:{tier:"S",element:"Fire",role:"DPS"},Snowkami:{tier:"A",element:"Water",role:"DPS"},Hoofrit:{tier:"A",element:"Earth",role:"Tank"},Lucidina:{tier:"A",element:"Electric",role:"Support"},Battereina:{tier:"A",element:"Electric",role:"DPS"},Ninjump:{tier:"A",element:"Water",role:"DPS"},Wyvierno:{tier:"A",element:"Fire",role:"DPS"},Kilohopp:{tier:"B",element:"Electric",role:"Support"},Thunderclawd:{tier:"B",element:"Electric",role:"DPS"},Terrastudo:{tier:"B",element:"Earth",role:"Tank"},Incineraptor:{tier:"B",element:"Fire",role:"DPS"},Maximito:{tier:"B",element:"Earth",role:"Support"},Bruiseberry:{tier:"B",element:"Water",role:"Tank"},Lendanear:{tier:"B",element:"Water",role:"Support"},Rotorlotor:{tier:"B",element:"Electric",role:"DPS"},Cerverdant:{tier:"B",element:"Earth",role:"Support"},Vulcanid:{tier:"B",element:"Fire",role:"Support"},Herculeaf:{tier:"B",element:"Water",role:"DPS"},Voltbolt:{tier:"B",element:"Electric",role:"DPS"},Axollium:{tier:"B",element:"Earth",role:"DPS"},Meowdame:{tier:"C",element:"Electric",role:"Support"},Platyputz:{tier:"C",element:"Water",role:"Tank"},Baboom:{tier:"C",element:"Earth",role:"DPS"},Magmolin:{tier:"C",element:"Fire",role:"DPS"},Surveilynx:{tier:"C",element:"Earth",role:"Support"},Fingenue:{tier:"C",element:"Water",role:"Support"},Woozard:{tier:"C",element:"Earth",role:"Support"},Salamantis:{tier:"C",element:"Earth",role:"DPS"},Ghillant:{tier:"C",element:"Water",role:"DPS"},Dolphriend:{tier:"C",element:"Water",role:"Tank"},Abuzzinian:{tier:"C",element:"Electric",role:"Support"},Blazeal:{tier:"C",element:"Fire",role:"Tank"},Mantleray:{tier:"C",element:"Electric",role:"DPS"},Graffitty:{tier:"Economy",element:"Earth",role:"Support"},Squeezel:{tier:"Economy",element:"Water",role:"DPS"},Flouffant:{tier:"Economy",element:"Earth",role:"Support"},Spinchilla:{tier:"Economy",element:"Earth",role:"Support"},Emboa:{tier:"Economy",element:"Fire",role:"DPS"},Auktyke:{tier:"Economy",element:"Water",role:"Tank"}}}async loadPalmonData(){try{const e=await fetch("./palmon.json");if(!e.ok)throw new Error(`HTTP error! status: ${e.status}`);return this.palmonData=await e.json(),this.processedPalmonData=this.processPalmonData(this.palmonData),this.buildSearchIndex(),!0}catch(e){return console.error("Error loading Palmon data:",e),this.createSampleData(),!1}}createSampleData(){this.palmonData=[{"Hero Name":"Barkplug","Hero Key":"hero_barkplug","Hero ID":"001","Skill 1 Name":"Defense Down","Skill 1 Description":"Reduces enemy defense by 30%","Skill 2 Name":"Electric Surge","Skill 2 Description":"Deals electric damage to all enemies","Skill 3 (Passive) Name":"Support Aura","Skill 3 Description":"Boosts team damage by 15%"},{"Hero Name":"Statchew","Hero Key":"hero_statchew","Hero ID":"002","Skill 1 Name":"Taunt","Skill 1 Description":"Forces enemies to attack this Palmon","Skill 2 Name":"Earth Shield","Skill 2 Description":"Provides damage reduction to team","Skill 3 (Passive) Name":"Sturdy","Skill 3 Description":"Increased HP and defense"}],this.processedPalmonData=this.processPalmonData(this.palmonData),this.buildSearchIndex()}processPalmonData(e){return e.map(e=>{const t=e["Hero Name"],n=this.tierData[t]||{tier:"C",element:"Earth",role:"DPS"};return{id:e["Hero ID"],name:t,heroKey:e["Hero Key"],tier:n.tier,element:n.element,role:n.role,skills:{skill1:{name:e["Skill 1 Name"]||"Unknown Skill",description:e["Skill 1 Description"]||"No description available"},skill2:{name:e["Skill 2 Name"]||"Unknown Skill",description:e["Skill 2 Description"]||"No description available"},passive:{name:e["Skill 3 (Passive) Name"]||"Unknown Passive",description:e["Skill 3 Description"]||"No description available"},evolve:e["Evolve Skill Name"]?{name:e["Evolve Skill Name"],description:e["Evolve Skill Description"]||"No description available"}:null},stats:this.generateStats(n.tier,n.role),analysis:this.generateAnalysis(t,n)}})}generateStats(e,t){const n={S:{base:90,variance:10},A:{base:80,variance:10},B:{base:70,variance:10},C:{base:60,variance:10},Economy:{base:50,variance:10}},i={Tank:{damage:-10,utility:5,synergy:0,durability:15,economy:0},DPS:{damage:15,utility:-5,synergy:0,durability:-10,economy:0},Support:{damage:-5,utility:15,synergy:10,durability:0,economy:5},Control:{damage:0,utility:10,synergy:5,durability:0,economy:0}},a=n[e]||n.C,s=i[t]||i.DPS;return{damage:Math.max(0,Math.min(100,a.base+s.damage+(Math.random()*a.variance-a.variance/2))),utility:Math.max(0,Math.min(100,a.base+s.utility+(Math.random()*a.variance-a.variance/2))),synergy:Math.max(0,Math.min(100,a.base+s.synergy+(Math.random()*a.variance-a.variance/2))),durability:Math.max(0,Math.min(100,a.base+s.durability+(Math.random()*a.variance-a.variance/2))),economy:Math.max(0,Math.min(100,a.base+s.economy+(Math.random()*a.variance-a.variance/2)))}}generateAnalysis(e,t){const n={S:{strengths:["Exceptional performance","Meta defining","High versatility"],weaknesses:["High resource cost","Common target"],value:"Must-have for competitive play"},A:{strengths:["Strong performance","Good versatility","Reliable"],weaknesses:["Situational weaknesses","Outclassed by S-tier"],value:"Excellent choice for most teams"},B:{strengths:["Solid performance","Good in specific roles"],weaknesses:["Limited versatility","Niche applications"],value:"Good for specialized strategies"},C:{strengths:["Accessible","Some unique abilities"],weaknesses:["Below average stats","Limited impact"],value:"Situational use only"},Economy:{strengths:["Low cost","Early game viable"],weaknesses:["Poor late game scaling","Low stats"],value:"Budget option for new players"}},i=n[t.tier]||n.C;return{strengths:i.strengths,weaknesses:i.weaknesses,strategicValue:i.value,bestPartners:this.generatePartners(e,t),counters:this.generateCounters(e,t),usage:this.generateUsageNotes(t)}}generatePartners(e,t){const n=[];Object.entries(this.tierData).forEach(([i,a])=>{i!==e&&a.element===t.element&&n.length<3&&n.push(i)});const i={Tank:["DPS","Support"],DPS:["Tank","Support"],Support:["Tank","DPS"],Control:["Tank","DPS"]}[t.role]||["DPS"];return Object.entries(this.tierData).forEach(([t,a])=>{t!==e&&i.includes(a.role)&&!n.includes(t)&&n.length<5&&n.push(t)}),n}generateCounters(e,t){const n=[],i={Fire:"Water",Water:"Electric",Electric:"Earth",Earth:"Fire"}[t.element];return i&&Object.entries(this.tierData).forEach(([e,t])=>{t.element===i&&n.length<3&&n.push(e)}),n}generateUsageNotes(e){return{Tank:"Best positioned in front row to absorb damage and protect team.",DPS:"Position strategically to maximize damage output while staying protected.",Support:"Place in back row to provide team buffs and healing safely.",Control:"Use abilities to disrupt enemy formations and control battlefield."}[e.role]||"Use according to team strategy and enemy composition."}buildSearchIndex(){this.processedPalmonData&&(this.searchIndex=this.processedPalmonData.map(e=>({id:e.id,searchText:[e.name,e.element,e.role,e.tier,e.skills.skill1?.name||"",e.skills.skill2?.name||"",e.skills.passive?.name||"",e.skills.evolve?.name||""].join(" ").toLowerCase()})))}getAllPalmon(){return this.processedPalmonData||[]}getPalmonById(e){return this.processedPalmonData&&this.processedPalmonData.find(t=>t.id===e)||null}getPalmonByName(e){return this.processedPalmonData&&this.processedPalmonData.find(t=>t.name.toLowerCase()===e.toLowerCase())||null}searchPalmon(e){if(!e||!this.searchIndex||!this.processedPalmonData)return[];const t=e.toLowerCase().trim(),n=this.searchIndex.filter(e=>e.searchText.includes(t)).map(e=>e.id);return this.processedPalmonData.filter(e=>n.includes(e.id))}filterPalmon(e={}){let t=this.getAllPalmon();if(e.element&&"all"!==e.element&&(t=t.filter(t=>t.element.toLowerCase()===e.element.toLowerCase())),e.role&&"all"!==e.role&&(t=t.filter(t=>t.role.toLowerCase()===e.role.toLowerCase())),e.tier&&"all"!==e.tier&&(t=t.filter(t=>t.tier.toLowerCase()===e.tier.toLowerCase())),e.search){const n=this.searchPalmon(e.search),i=new Set(n.map(e=>e.id));t=t.filter(e=>i.has(e.id))}return t}getPalmonByTier(e){return this.getAllPalmon().filter(t=>t.tier.toLowerCase()===e.toLowerCase())}getPalmonByElement(e){return this.getAllPalmon().filter(t=>t.element.toLowerCase()===e.toLowerCase())}getPalmonByRole(e){return this.getAllPalmon().filter(t=>t.role.toLowerCase()===e.toLowerCase())}getStatistics(){const e=this.getAllPalmon(),t={total:e.length,byTier:{},byElement:{},byRole:{}};return e.forEach(e=>{t.byTier[e.tier]=(t.byTier[e.tier]||0)+1,t.byElement[e.element]=(t.byElement[e.element]||0)+1,t.byRole[e.role]=(t.byRole[e.role]||0)+1}),t}getRandomPalmon(e=1){const t=this.getAllPalmon();if(0===t.length)return[];return[...t].sort(()=>.5-Math.random()).slice(0,e)}validateData(){const e={isValid:!0,errors:[],warnings:[]};if(!this.processedPalmonData||0===this.processedPalmonData.length)return e.isValid=!1,e.errors.push("No Palmon data loaded"),e;this.processedPalmonData.forEach((t,n)=>{t.id||(e.errors.push(`Palmon at index ${n} missing ID`),e.isValid=!1),t.name||(e.errors.push(`Palmon at index ${n} missing name`),e.isValid=!1),t.tier||e.warnings.push(`Palmon ${t.name} missing tier information`)});const t=this.processedPalmonData.map(e=>e.id),n=[...new Set(t)];return t.length!==n.length&&e.warnings.push("Duplicate Palmon IDs found"),e}exportData(){return{palmonData:this.processedPalmonData,statistics:this.getStatistics(),exportedAt:(new Date).toISOString(),version:"1.0"}}isDataLoaded(){return!!(this.processedPalmonData&&this.processedPalmonData.length>0)}async refreshData(){return await this.loadPalmonData()}}export default DataUtils;class PalmonValidator{constructor(){this.validElements=["Fire","Water","Earth","Electric"],this.validTiers=["S","A","B","C","Economy"],this.validRoles=["Tank","DPS","Support","Control"],this.validSkillTypes=["Active","Passive","Evolve"]}validatePalmon(e){const t=[];if(["id","name","heroKey","element","tier","role","skills","stats"].forEach(n=>{e.hasOwnProperty(n)&&null!==e[n]&&void 0!==e[n]||t.push(`Missing required field: ${n}`)}),e.id&&"string"!=typeof e.id&&t.push("ID must be a string"),e.name&&"string"!=typeof e.name&&t.push("Name must be a string"),e.heroKey&&"string"!=typeof e.heroKey&&t.push("Hero key must be a string"),e.element&&!this.validElements.includes(e.element)&&t.push(`Invalid element: ${e.element}. Must be one of: ${this.validElements.join(", ")}`),e.tier&&!this.validTiers.includes(e.tier)&&t.push(`Invalid tier: ${e.tier}. Must be one of: ${this.validTiers.join(", ")}`),e.role&&!this.validRoles.includes(e.role)&&t.push(`Invalid role: ${e.role}. Must be one of: ${this.validRoles.join(", ")}`),e.skills){const n=this.validateSkills(e.skills);t.push(...n.errors)}if(e.stats){const n=this.validateStats(e.stats);t.push(...n.errors)}return{isValid:0===t.length,errors:t}}validateSkills(e){const t=[];if(["skill1","skill2","passive"].forEach(n=>{if(!e[n])return void t.push(`Missing required skill: ${n}`);const i=e[n],a=this.validateSkill(i,n);t.push(...a.errors)}),e.evolveSkill){const n=this.validateSkill(e.evolveSkill,"evolveSkill");t.push(...n.errors)}return{isValid:0===t.length,errors:t}}validateSkill(e,t){const n=[];return["name","description","type"].forEach(i=>{e.hasOwnProperty(i)&&null!==e[i]&&void 0!==e[i]||n.push(`${t}: Missing required field: ${i}`)}),e.name&&"string"!=typeof e.name&&n.push(`${t}: Name must be a string`),e.description&&"string"!=typeof e.description&&n.push(`${t}: Description must be a string`),e.type&&!this.validSkillTypes.includes(e.type)&&n.push(`${t}: Invalid skill type: ${e.type}. Must be one of: ${this.validSkillTypes.join(", ")}`),{isValid:0===n.length,errors:n}}validateStats(e){const t=[];return["utility","synergy","damage","durability","economy"].forEach(n=>{if(!e.hasOwnProperty(n))return void t.push(`Missing required stat: ${n}`);const i=e[n];"number"!=typeof i||isNaN(i)?t.push(`${n}: Must be a number`):(i<0||i>100)&&t.push(`${n}: Must be between 0 and 100`)}),{isValid:0===t.length,errors:t}}validatePalmonArray(e){if(!Array.isArray(e))return{isValid:!1,errors:["Input must be an array"],results:[]};const t=e.map((e,t)=>{const n=this.validatePalmon(e);return{index:t,palmonId:e.id||`unknown-${t}`,palmonName:e.name||`unknown-${t}`,...n}}),n=t.filter(e=>!e.isValid),i=n.flatMap(e=>e.errors.map(t=>`${e.palmonName} (${e.palmonId}): ${t}`));return{isValid:0===n.length,totalCount:e.length,validCount:t.length-n.length,invalidCount:n.length,errors:i,results:t}}validateProcessedData(e){const t=[];if(e.palmon&&Array.isArray(e.palmon)||t.push("Missing or invalid palmon array"),e.metadata&&"object"==typeof e.metadata||t.push("Missing or invalid metadata object"),e.metadata){const n=this.validateMetadata(e.metadata);t.push(...n.errors)}let n={isValid:!0,errors:[]};return e.palmon&&(n=this.validatePalmonArray(e.palmon),t.push(...n.errors)),{isValid:0===t.length,errors:t,palmonValidation:n}}validateMetadata(e){const t=[];return["totalCount","elements","tiers","lastUpdated"].forEach(n=>{e.hasOwnProperty(n)||t.push(`Metadata missing required field: ${n}`)}),e.totalCount&&"number"!=typeof e.totalCount&&t.push("Metadata totalCount must be a number"),e.elements&&!Array.isArray(e.elements)&&t.push("Metadata elements must be an array"),e.tiers&&!Array.isArray(e.tiers)&&t.push("Metadata tiers must be an array"),e.lastUpdated&&"string"!=typeof e.lastUpdated&&t.push("Metadata lastUpdated must be a string"),{isValid:0===t.length,errors:t}}sanitizePalmon(e){const t={id:String(e.id||""),name:String(e.name||"Unknown"),heroKey:String(e.heroKey||""),element:this.validElements.includes(e.element)?e.element:"Electric",tier:this.validTiers.includes(e.tier)?e.tier:"C",role:this.validRoles.includes(e.role)?e.role:"DPS",skills:this.sanitizeSkills(e.skills||{}),stats:this.sanitizeStats(e.stats||{})};return e.evolveSkill&&e.evolveSkill.name&&(t.evolveSkill=this.sanitizeSkill(e.evolveSkill)),t}sanitizeSkills(e){return{skill1:this.sanitizeSkill(e.skill1||{},"Active"),skill2:this.sanitizeSkill(e.skill2||{},"Active"),passive:this.sanitizeSkill(e.passive||{},"Passive")}}sanitizeSkill(e,t="Active"){return{name:String(e.name||"Unknown Skill"),description:String(e.description||"No description available"),type:this.validSkillTypes.includes(e.type)?e.type:t}}sanitizeStats(e){const t={};return["utility","synergy","damage","durability","economy"].forEach(n=>{let i=e[n];i="number"!=typeof i||isNaN(i)?50:Math.max(0,Math.min(100,i)),t[n]=i}),t}generateReport(e){let t="Validation Report\n";return t+="================\n\n",e.isValid?(t+="✅ Validation PASSED\n",e.totalCount&&(t+=`Total Palmon validated: ${e.totalCount}\n`)):(t+="❌ Validation FAILED\n",e.totalCount&&(t+=`Total Palmon: ${e.totalCount}\n`,t+=`Valid: ${e.validCount}\n`,t+=`Invalid: ${e.invalidCount}\n`),t+="\nErrors:\n",e.errors.forEach((e,n)=>{t+=`${n+1}. ${e}\n`})),t}}const validator=new PalmonValidator;export default validator;export{PalmonValidator};